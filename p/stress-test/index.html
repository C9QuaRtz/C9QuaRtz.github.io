<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="åˆè¯† Opus 4.5"><title>å‹åŠ›æµ‹è¯•</title><link rel=canonical href=https://c9quartz.github.io/p/stress-test/><link rel=stylesheet href=/scss/style.min.b0e76e98cdd4f7082d1fc36f7af7e0843a81201db2197c03ca426751dc923735.css><meta property='og:title' content="å‹åŠ›æµ‹è¯•"><meta property='og:description' content="åˆè¯† Opus 4.5"><meta property='og:url' content='https://c9quartz.github.io/p/stress-test/'><meta property='og:site_name' content="C9QuaRtz Hos7llo's Stack"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-12-09T17:42:39+08:00'><meta property='article:modified_time' content='2025-12-09T17:42:39+08:00'><meta property='og:image' content='https://c9quartz.github.io/p/stress-test/IMG_2651_596x832_bw.PNG'><meta name=twitter:title content="å‹åŠ›æµ‹è¯•"><meta name=twitter:description content="åˆè¯† Opus 4.5"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://c9quartz.github.io/p/stress-test/IMG_2651_596x832_bw.PNG'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_7c8bff317ec9f2e8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ’«</span></figure><div class=site-meta><h1 class=site-name><a href=/>C9QuaRtz Hos7llo's Stack</a></h1><h2 class=site-description>å¯çˆ±å³æ˜¯æ­£ä¹‰ï¼</h2></div></header><ol class=menu-social><li><a href=https://space.bilibili.com/620599492 target=_blank title=bilibili rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"/><path d="M8 3l2 3"/><path d="M16 3l-2 3"/><path d="M9 13v-2"/><path d="M15 11v2"/></svg></a></li><li><a href=https://github.com/C9QuaRtz target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://steamcommunity.com/profiles/76561198842028671 target=_blank title=Steam rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-steam"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.5 5a4.5 4.5.0 11-.653 8.953L11.5 16.962V17a3 3 0 01-2.824 3H8.5a3 3 0 01-2.94-2.402L3 16.5V13l3.51 1.755a2.989 2.989.0 012.834-.635l2.727-3.818A4.5 4.5.0 0116.5 5z"/><circle cx="16.5" cy="9.5" r="1" fill="currentColor"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/html_pg/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-file-type-html"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 001 1h4"/><path d="M5 12V5a2 2 0 012-2h7l5 5v4"/><path d="M2 21v-6"/><path d="M5 15v6"/><path d="M2 18h3"/><path d="M20 15v6h2"/><path d="M13 21v-6l2 3 2-3v6"/><path d="M7.5 15h3"/><path d="M9 15v6"/></svg>
<span>HTML Playground</span></a></li><li><a href=https://github.com/C9QuaRtz/C9QuaRtz.github.io target=_blank><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-logout-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 8V6a2 2 0 012-2h7a2 2 0 012 2v12a2 2 0 01-2 2h-7a2 2 0 01-2-2v-2"/><path d="M15 12H3l3-3"/><path d="M6 15l-3-3"/></svg>
<span>Backstage Github</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/stress-test/><img src=/p/stress-test/IMG_2651_596x832_bw_hu_81bc8a881f470861.PNG srcset="/p/stress-test/IMG_2651_596x832_bw_hu_81bc8a881f470861.PNG 800w, /p/stress-test/IMG_2651_596x832_bw_hu_f7dc706174ed2f82.PNG 1600w" width=800 height=1117 loading=lazy alt="Featured image of post å‹åŠ›æµ‹è¯•"></a></div><div class=article-details><header class=article-category><a href=/categories/gpt/ style=background-color:#146049;color:#fff>ChatGPT çš„å°å°éšç¬”</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/stress-test/>å‹åŠ›æµ‹è¯•</a></h2><h3 class=article-subtitle>åˆè¯† Opus 4.5</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-09T17:42:39+08:00>Dec 09, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 108 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=attributeerror-in-replay_requestpy><a href=#attributeerror-in-replay_requestpy class=header-anchor></a>AttributeError in replay_request.py</h1><p><em>Exported on 12/4/2025 at 21:25:44 GMT+8 from Cursor (2.1.46)</em></p><hr><p><strong>User</strong></p><p>é˜…è¯»è¿™ä¸ªharåŒ…ï¼Œå®Œæˆä¸€ä¸ªPythonç¨‹åºä»¥é‡æ”¾æ­¤è¯·æ±‚ã€‚</p><p>è¯·ç›´æ¥åœ¨Pythonä¸­å¤åˆ¶ç›¸å…³å­—æ®µï¼Œä¸è¦å¼•ç”¨è¯»å†™åŸæ–‡ä»¶</p><hr><p><strong>Cursor</strong></p><p>æŸ¥çœ‹ HAR æ–‡ä»¶å†…å®¹ï¼Œä»¥ä¾¿ç¼–å†™ Python é‡æ”¾è„šæœ¬ã€‚</p><p>åŸºäº HAR å†…å®¹ç¼–å†™ Python è„šæœ¬ï¼Œç›´æ¥åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ç›¸å…³å­—æ®µä»¥é‡æ”¾è¯·æ±‚ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>é‡æ”¾ HAR æ–‡ä»¶ä¸­çš„è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>requests_toolbelt.multipart.encoder</span> <span class=kn>import</span> <span class=n>MultipartEncoder</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replay_request</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;é‡æ”¾ HAR æ–‡ä»¶ä¸­è®°å½•çš„è¯·æ±‚&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è¯·æ±‚ URL</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;https://go.heytea.com/api/service-cps/user/diy&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># URL æŸ¥è¯¢å‚æ•°</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è¯·æ±‚å¤´</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Host&#34;</span><span class=p>:</span> <span class=s2>&#34;go.heytea.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Connection&#34;</span><span class=p>:</span> <span class=s2>&#34;keep-alive&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;X-client&#34;</span><span class=p>:</span> <span class=s2>&#34;weapp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;X-client-version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.318.0.p8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Authorization&#34;</span><span class=p>:</span> <span class=s2>&#34;Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxNDIzMDkwOTAiLCJ1c2VyX21haW5faWQiOjE2NjY1ODMxNiwiY2hhbm5lbCI6IlciLCJzb3VyY2UiOiJhcGkiLCJpc19ndWVzdCI6ZmFsc2UsImxhYmVsIjoiY2xpZW50OndlYXBwIiwiaWF0IjoxNzY0ODMzMDIyLCJuYmYiOjE3NjQ4MzMwMjIsImV4cCI6MTc2NDkxOTQyMiwiaXNzIjoiaGV5dGVhIn0.33TKm1_8NVttopiFGwpXEasOxmy9n9I0yixsa3goMQQ&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Accept-Encoding&#34;</span><span class=p>:</span> <span class=s2>&#34;gzip,compress,br,deflate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0 (iPhone; CPU iPhone OS 18_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/8.0.64(0x18004034) NetType/WIFI Language/zh_CN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Referer&#34;</span><span class=p>:</span> <span class=s2>&#34;https://servicewechat.com/wx696a42df4f2456d3/1255/page-frame.html&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ„å»º multipart/form-data è¯·æ±‚ä½“</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ³¨æ„ï¼šHAR æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…å«å®é™…çš„ multipart æ•°æ®å†…å®¹</span>
</span></span><span class=line><span class=cl>    <span class=c1># è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå¡«å……å­—æ®µ</span>
</span></span><span class=line><span class=cl>    <span class=c1># boundary ä»åŸå§‹è¯·æ±‚å¤´ä¸­æå–</span>
</span></span><span class=line><span class=cl>    <span class=n>boundary</span> <span class=o>=</span> <span class=s2>&#34;WABoundary+E24E9DF9599D28BAWA&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ç”±äº HAR æ–‡ä»¶ä¸­æ²¡æœ‰å®é™…çš„ postData.textï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªæ¨¡æ¿</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ‚¨éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ·»åŠ å­—æ®µ</span>
</span></span><span class=line><span class=cl>    <span class=n>multipart_data</span> <span class=o>=</span> <span class=n>MultipartEncoder</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>fields</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1># åœ¨è¿™é‡Œæ·»åŠ å®é™…çš„è¡¨å•å­—æ®µ</span>
</span></span><span class=line><span class=cl>            <span class=c1># ä¾‹å¦‚ï¼š&#39;file&#39;: (&#39;filename.jpg&#39;, file_data, &#39;image/jpeg&#39;),</span>
</span></span><span class=line><span class=cl>            <span class=c1># æˆ–è€…ï¼š&#39;key&#39;: &#39;value&#39;,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>boundary</span><span class=o>=</span><span class=n>boundary</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>multipart_data</span><span class=o>.</span><span class=n>content_type</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å‘é€è¯·æ±‚</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æ­£åœ¨å‘é€è¯·æ±‚åˆ°: </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æŸ¥è¯¢å‚æ•°: </span><span class=si>{</span><span class=n>params</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è¯·æ±‚æ–¹æ³•: POST&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>multipart_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å“åº”çŠ¶æ€ç : </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å“åº”å¤´:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å“åº”å†…å®¹:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è¯·æ±‚å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>replay_request</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>æ£€æŸ¥ä»£ç ä¸­çš„é—®é¢˜ï¼Œå¹¶ä¼˜åŒ–è„šæœ¬ï¼š</p><p>å·²åˆ›å»º Python è„šæœ¬ä»¥é‡æ”¾è¯·æ±‚ã€‚æ³¨æ„ï¼š</p><ol><li>HAR æ–‡ä»¶ä¸­æœªåŒ…å«å®é™…çš„ multipart/form-data æ•°æ®ï¼ˆåªæœ‰ Content-Type å’Œ boundaryï¼‰ï¼Œä½† Content-Length ä¸º 22557ï¼Œè¯´æ˜å­˜åœ¨è¯·æ±‚ä½“æ•°æ®ã€‚</li><li>è„šæœ¬å·²ç¡¬ç¼–ç æ‰€æœ‰è¯·æ±‚å¤´ã€URL å’ŒæŸ¥è¯¢å‚æ•°ã€‚</li><li>éœ€è¦åœ¨ <code>multipart_data</code> çš„ <code>fields</code> ä¸­æ·»åŠ å®é™…è¡¨å•å­—æ®µï¼ˆä¾‹å¦‚ä¸Šä¼ çš„æ–‡ä»¶æˆ–è¡¨å•æ•°æ®ï¼‰ã€‚</li></ol><p>å¦‚æœéœ€è¦ï¼Œæˆ‘å¯ä»¥ï¼š</p><ul><li>ä» HAR ä¸­æå–å®Œæ•´çš„ postDataï¼ˆå¦‚æœå­˜åœ¨ï¼‰</li><li>æä¾›ä¸€ä¸ªæ›´å…·ä½“çš„ multipart æ•°æ®ç¤ºä¾‹</li></ul><p>è¿è¡Œè„šæœ¬éœ€è¦å…ˆå®‰è£…ä¾èµ–ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install requests requests-toolbelt
</span></span></code></pre></td></tr></table></div></div><p>è¯¥è„šæœ¬åŒ…å«ä» HAR ä¸­æå–çš„æ‰€æœ‰è¯·æ±‚ä¿¡æ¯ï¼Œå¯ç›´æ¥è¿è¡Œã€‚å¦‚æœçŸ¥é“å…·ä½“çš„ multipart å­—æ®µå†…å®¹ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥å®Œå–„è„šæœ¬ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>requests</span> <span class=n>requests</span><span class=o>-</span><span class=n>toolbelt</span>
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>User</strong></p><p>@replay_request.py:51-52è¿è¡Œæ—¶æŠ¥é”™ï¼š AttributeError: &lsquo;_io.BufferedReader&rsquo; object has no attribute &rsquo;translate&rsquo;</p><hr><p><strong>Cursor</strong></p><p>é—®é¢˜åœ¨äº <code>MultipartEncoder</code> çš„æ–‡ä»¶å­—æ®µæ ¼å¼ä¸æ­£ç¡®ã€‚åº”ä½¿ç”¨ä¸‰å…ƒç»„ <code>(filename, file_object, content_type)</code>ï¼Œè€Œä¸æ˜¯äºŒå…ƒç»„ã€‚ä¿®å¤ä¸­ï¼š</p><p>ä¿®å¤æ–‡ä»¶å­—æ®µæ ¼å¼ï¼š<code>MultipartEncoder</code> éœ€è¦ä¸‰å…ƒç»„ <code>(filename, file_data, content_type)</code>ï¼Œä¸æ˜¯äºŒå…ƒç»„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>é‡æ”¾ HAR æ–‡ä»¶ä¸­çš„è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>requests_toolbelt.multipart.encoder</span> <span class=kn>import</span> <span class=n>MultipartEncoder</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>replay_request</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;é‡æ”¾ HAR æ–‡ä»¶ä¸­è®°å½•çš„è¯·æ±‚&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è¯·æ±‚ URL</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;https://go.heytea.com/api/service-cps/user/diy&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># URL æŸ¥è¯¢å‚æ•°</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è¯·æ±‚å¤´</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Host&#34;</span><span class=p>:</span> <span class=s2>&#34;go.heytea.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Connection&#34;</span><span class=p>:</span> <span class=s2>&#34;keep-alive&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;X-client&#34;</span><span class=p>:</span> <span class=s2>&#34;weapp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;X-client-version&#34;</span><span class=p>:</span> <span class=s2>&#34;3.318.0.p8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Authorization&#34;</span><span class=p>:</span> <span class=s2>&#34;Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxNDIzMDkwOTAiLCJ1c2VyX21haW5faWQiOjE2NjY1ODMxNiwiY2hhbm5lbCI6IlciLCJzb3VyY2UiOiJhcGkiLCJpc19ndWVzdCI6ZmFsc2UsImxhYmVsIjoiY2xpZW50OndlYXBwIiwiaWF0IjoxNzY0ODMzMDIyLCJuYmYiOjE3NjQ4MzMwMjIsImV4cCI6MTc2NDkxOTQyMiwiaXNzIjoiaGV5dGVhIn0.33TKm1_8NVttopiFGwpXEasOxmy9n9I0yixsa3goMQQ&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Accept-Encoding&#34;</span><span class=p>:</span> <span class=s2>&#34;gzip,compress,br,deflate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0 (iPhone; CPU iPhone OS 18_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/8.0.64(0x18004034) NetType/WIFI Language/zh_CN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Referer&#34;</span><span class=p>:</span> <span class=s2>&#34;https://servicewechat.com/wx696a42df4f2456d3/1255/page-frame.html&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ„å»º multipart/form-data è¯·æ±‚ä½“</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ³¨æ„ï¼šHAR æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…å«å®é™…çš„ multipart æ•°æ®å†…å®¹</span>
</span></span><span class=line><span class=cl>    <span class=c1># è¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå¡«å……å­—æ®µ</span>
</span></span><span class=line><span class=cl>    <span class=c1># boundary ä»åŸå§‹è¯·æ±‚å¤´ä¸­æå–</span>
</span></span><span class=line><span class=cl>    <span class=n>boundary</span> <span class=o>=</span> <span class=s2>&#34;WABoundary+E24E9DF9599D28BAWA&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è¯»å–æ–‡ä»¶å†…å®¹</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;test.png&#34;</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file_data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ„å»º multipart è¡¨å•æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=c1># MultipartEncoder è¦æ±‚æ–‡ä»¶å­—æ®µæ ¼å¼ä¸º (filename, file_data, content_type)</span>
</span></span><span class=line><span class=cl>    <span class=n>multipart_data</span> <span class=o>=</span> <span class=n>MultipartEncoder</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>fields</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;width&#34;</span><span class=p>:</span> <span class=s2>&#34;596&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;height&#34;</span><span class=p>:</span> <span class=s2>&#34;832&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;file&#34;</span><span class=p>:</span> <span class=p>(</span><span class=s2>&#34;test.png&#34;</span><span class=p>,</span> <span class=n>file_data</span><span class=p>,</span> <span class=s2>&#34;image/png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>boundary</span><span class=o>=</span><span class=n>boundary</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>multipart_data</span><span class=o>.</span><span class=n>content_type</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å‘é€è¯·æ±‚</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æ­£åœ¨å‘é€è¯·æ±‚åˆ°: </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æŸ¥è¯¢å‚æ•°: </span><span class=si>{</span><span class=n>params</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è¯·æ±‚æ–¹æ³•: POST&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>multipart_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å“åº”çŠ¶æ€ç : </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å“åº”å¤´:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å“åº”å†…å®¹:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è¯·æ±‚å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>replay_request</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>å·²ä¿®å¤ã€‚é—®é¢˜æ˜¯ <code>MultipartEncoder</code> çš„æ–‡ä»¶å­—æ®µéœ€è¦ä½¿ç”¨ä¸‰å…ƒç»„ <code>(filename, file_data, content_type)</code>ï¼Œè€Œä¸æ˜¯äºŒå…ƒç»„ã€‚</p><p>ä¸»è¦ä¿®æ”¹ï¼š</p><ol><li>å°†æ–‡ä»¶å­—æ®µä» <code>(open("test.png", "rb"), "image/png")</code> æ”¹ä¸º <code>("test.png", file_data, "image/png")</code></li><li>å…ˆè¯»å–æ–‡ä»¶å†…å®¹åˆ° <code>file_data</code>ï¼Œä½¿ç”¨ <code>with</code> è¯­å¥ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­</li><li>ä½¿ç”¨æ­£ç¡®çš„ä¸‰å…ƒç»„æ ¼å¼ï¼šæ–‡ä»¶åã€æ–‡ä»¶æ•°æ®ï¼ˆå­—èŠ‚ï¼‰ã€å†…å®¹ç±»å‹</li></ol><p>ç°åœ¨åº”å¯æ­£å¸¸è¿è¡Œã€‚è¯·é‡æ–°è¿è¡Œè„šæœ¬æµ‹è¯•ã€‚</p><hr><p><strong>User</strong></p><p>@replay_request.py:20 è¿™æ®µhashçœ‹èµ·æ¥åƒå“ªä¸€ç§ç®—æ³•ï¼Ÿ @heytea_diy_sign.py (77-78)</p><hr><p><strong>Cursor</strong></p><p>åˆ†æè¿™ä¸ª hash çš„ç‰¹å¾ï¼Œæ¨æ–­å…¶ç®—æ³•ç±»å‹ã€‚</p><p>åˆ†æè¯¥ hash çš„é•¿åº¦å’Œç‰¹å¾ï¼š</p><p>è¿›ä¸€æ­¥åˆ†æå¯èƒ½çš„ç»„åˆï¼š</p><p>æ ¹æ®åˆ†æï¼Œè¿™ä¸ª hash é•¿åº¦ä¸º 160 ä¸ªå­—ç¬¦ï¼ˆ640 æ¯”ç‰¹ï¼‰ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªç»„åˆå“ˆå¸Œã€‚</p><p>æœ€å¯èƒ½çš„ç»„åˆæ˜¯ï¼šSHA512 (128 å­—ç¬¦) + MD5 (32 å­—ç¬¦) = 160 å­—ç¬¦</p><p>åŸå› ï¼š</p><ol><li>é•¿åº¦åŒ¹é…ï¼šå‰ 128 å­—ç¬¦ï¼ˆå¯èƒ½æ˜¯ SHA512ï¼‰+ å 32 å­—ç¬¦ï¼ˆå¯èƒ½æ˜¯ MD5ï¼‰= 160 å­—ç¬¦</li><li>å¸¸è§åšæ³•ï¼šå¾®ä¿¡å°ç¨‹åºå¸¸ç”¨å¤šå“ˆå¸Œç»„åˆå¢å¼ºå®‰å…¨æ€§</li><li>å…¶ä»–å¯èƒ½ï¼š<ul><li>ä¸¤ä¸ª SHA256 (64+64) + éƒ¨åˆ†å“ˆå¸Œ (32)</li><li>è‡ªå®šä¹‰å“ˆå¸Œç®—æ³•</li></ul></li></ol><p>ç»“åˆè¯·æ±‚å‚æ•°ï¼ˆ<code>sign</code>ã€<code>t</code>ã€<code>hash</code>ã€<code>shopId</code>ï¼‰ï¼Œè¿™æ˜¯å…¸å‹çš„ API ç­¾åæœºåˆ¶ï¼Œé€šå¸¸åšæ³•æ˜¯ï¼š</p><ul><li>å°†è¯·æ±‚å‚æ•°æŒ‰è§„åˆ™æ’åºæ‹¼æ¥</li><li>å…ˆè®¡ç®— SHA512</li><li>å†å¯¹ç»“æœæˆ–åŸå§‹æ•°æ®è®¡ç®— MD5</li><li>å°†ä¸¤è€…æ‹¼æ¥ä½œä¸ºæœ€ç»ˆ hash</li></ul><p>è¦éªŒè¯ï¼Œå¯ä»¥å°è¯•ç”¨ SHA512+MD5 çš„ç»„åˆæ–¹å¼å¯¹è¯·æ±‚å‚æ•°è¿›è¡Œå“ˆå¸Œè®¡ç®—ã€‚</p><hr><p><strong>User</strong></p><p>è¯·å¦å†™ä¸€æ®µä»£ç ï¼Œç ”ç©¶è¿™æ®µhashä¸signã€tã€shopIDä¸å›¾ç‰‡æ–‡ä»¶tmp_32e6dbcc2678d4d40a297ca5490acc4d.pngä¹‹é—´çš„å…³ç³»</p><hr><p><strong>Cursor</strong></p><p>æˆ‘æ¥ç¼–å†™ä¸€ä¸ªåˆ†æè„šæœ¬ï¼Œç ”ç©¶è¿™äº›å‚æ•°ä¹‹é—´çš„å…³ç³»ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åˆ†æ hashã€signã€tã€shopId ä¸å›¾ç‰‡æ–‡ä»¶ä¹‹é—´çš„å…³ç³»
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å·²çŸ¥å‚æ•°</span>
</span></span><span class=line><span class=cl><span class=n>SIGN</span> <span class=o>=</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span>  <span class=c1># 32å­—ç¬¦ï¼ŒMD5æ ¼å¼</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=s2>&#34;1764833231217&#34;</span>  <span class=c1># æ—¶é—´æˆ³</span>
</span></span><span class=line><span class=cl><span class=n>HASH</span> <span class=o>=</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span>
</span></span><span class=line><span class=cl><span class=n>SHOP_ID</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FILENAME</span> <span class=o>=</span> <span class=s2>&#34;tmp_32e6dbcc2678d4d40a297ca5490acc4d.png&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»æ–‡ä»¶åä¸­æå–çš„hashéƒ¨åˆ†</span>
</span></span><span class=line><span class=cl><span class=n>FILENAME_HASH</span> <span class=o>=</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span>  <span class=c1># 32å­—ç¬¦ï¼ŒMD5æ ¼å¼</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ test.png ä½œä¸ºæµ‹è¯•å›¾ç‰‡</span>
</span></span><span class=line><span class=cl><span class=n>IMAGE_FILE</span> <span class=o>=</span> <span class=s2>&#34;test.png&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— MD5&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha1</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA1&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha256</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA256&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha512</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA512&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha512</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_section</span><span class=p>(</span><span class=n>title</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; </span><span class=si>{</span><span class=n>title</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_known_values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æå·²çŸ¥å€¼çš„ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å·²çŸ¥å€¼åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;sign: </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>SIGN</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ -&gt; MD5 æ ¼å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>t: </span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  çœ‹èµ·æ¥æ˜¯æ¯«ç§’çº§æ—¶é—´æˆ³&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>hash: </span><span class=si>{</span><span class=n>HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=si>}</span><span class=s2> bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‰ 128 å­—ç¬¦: </span><span class=si>{</span><span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å 32 å­—ç¬¦:  </span><span class=si>{</span><span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>shopId: </span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ–‡ä»¶å: </span><span class=si>{</span><span class=n>FILENAME</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶åä¸­çš„hashéƒ¨åˆ†: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>FILENAME_HASH</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ -&gt; MD5 æ ¼å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_filename_hash</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ–‡ä»¶åä¸­çš„ hash&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ–‡ä»¶å Hash åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è­¦å‘Š: </span><span class=si>{</span><span class=n>IMAGE_FILE</span><span class=si>}</span><span class=s2> ä¸å­˜åœ¨ï¼Œè·³è¿‡å›¾ç‰‡å†…å®¹åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>file_md5</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>file_sha1</span> <span class=o>=</span> <span class=n>sha1</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>file_sha256</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ MD5:    </span><span class=si>{</span><span class=n>file_md5</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ SHA1:   </span><span class=si>{</span><span class=n>file_sha1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ SHA256: </span><span class=si>{</span><span class=n>file_sha256</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ–‡ä»¶åä¸­çš„ hash: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file_md5</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;âœ“ æ–‡ä»¶åä¸­çš„ hash æ˜¯å›¾ç‰‡æ–‡ä»¶çš„ MD5ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;âœ— æ–‡ä»¶åä¸­çš„ hash ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶çš„ MD5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sign</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æ sign å‚æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Sign å‚æ•°åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•å„ç§ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>test_cases</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId+t&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&amp;shopId=value&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId=value&amp;t&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+shopId+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç›®æ ‡ sign: </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•å„ç§ç»„åˆçš„ MD5:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>test_cases</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“&#34;</span> <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>SIGN</span> <span class=k>else</span> <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2> MD5(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_hash_structure</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æ hash å‚æ•°ç»“æ„&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Hash å‚æ•°ç»“æ„åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_part1</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span>  <span class=c1># å¯èƒ½æ˜¯ SHA512</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_part2</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span>  <span class=c1># å¯èƒ½æ˜¯ MD5</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hash å‰ 128 å­—ç¬¦ï¼ˆç–‘ä¼¼ SHA512ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_part1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hash å 32 å­—ç¬¦ï¼ˆç–‘ä¼¼ MD5ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_part2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥å32å­—ç¬¦æ˜¯å¦ä¸æŸäº›å·²çŸ¥å€¼åŒ¹é…</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å 32 å­—ç¬¦ä¸å·²çŸ¥å€¼å¯¹æ¯”:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign:          </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename_hash: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hashå32å­—ç¬¦:  </span><span class=si>{</span><span class=n>hash_part2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hash_part2</span> <span class=o>==</span> <span class=n>SIGN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å 32 å­—ç¬¦ç­‰äº signï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hash_part2</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å 32 å­—ç¬¦ç­‰äºæ–‡ä»¶åä¸­çš„ hashï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_hash_combinations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å°è¯•å„ç§ hash ç»„åˆ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Hash ç»„åˆå°è¯•&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_part1</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_part2</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŠ è½½å›¾ç‰‡æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>    <span class=n>file_content</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>params_combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign&#34;</span><span class=p>,</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId+t&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign+t&#34;</span><span class=p>,</span> <span class=n>SIGN</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+sign&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId+sign&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign+shopId+t&#34;</span><span class=p>,</span> <span class=n>SIGN</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯• SHA512 åŒ¹é…å‰ 128 å­—ç¬¦:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>params_combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>hash_part1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ SHA512(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) åŒ¹é…ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>result</span><span class=p>[:</span><span class=mi>64</span><span class=p>]</span> <span class=o>==</span> <span class=n>hash_part1</span><span class=p>[:</span><span class=mi>64</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ~ SHA512(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) å‰åŠéƒ¨åˆ†åŒ¹é…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯• MD5 åŒ¹é…å 32 å­—ç¬¦:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>params_combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>hash_part2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ MD5(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) åŒ¹é…ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_encryption</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æå¯èƒ½çš„åŠ å¯†æ–¹å¼&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å¯èƒ½çš„åŠ å¯†/ç­¾åæ–¹å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºåˆ†æï¼Œè¿™ä¸ª API ç­¾åæœºåˆ¶å¯èƒ½æ˜¯ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>1. sign (32å­—ç¬¦ MD5):
</span></span></span><span class=line><span class=cl><span class=s2>   - å¯èƒ½æ˜¯ MD5(æŸäº›å‚æ•°ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>   - æˆ–è€… MD5(æŸä¸ªå¯†é’¥ + å‚æ•°)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>2. hash (160å­—ç¬¦ = SHA512 + MD5):
</span></span></span><span class=line><span class=cl><span class=s2>   - å‰ 128 å­—ç¬¦: SHA512(æŸäº›æ•°æ®)
</span></span></span><span class=line><span class=cl><span class=s2>   - å 32 å­—ç¬¦: MD5(æŸäº›æ•°æ®)
</span></span></span><span class=line><span class=cl><span class=s2>   
</span></span></span><span class=line><span class=cl><span class=s2>3. æ–‡ä»¶åä¸­çš„ hash:
</span></span></span><span class=line><span class=cl><span class=s2>   - tmp_</span><span class=si>{MD5}</span><span class=s2>.png æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=s2>   - å¯èƒ½æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>4. å¸¸è§çš„å¾®ä¿¡å°ç¨‹åºç­¾åæ–¹å¼:
</span></span></span><span class=line><span class=cl><span class=s2>   - å‚æ•°æŒ‰å­—æ¯æ’åº
</span></span></span><span class=line><span class=cl><span class=s2>   - æ‹¼æ¥æˆ key=value&amp;key=value æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=s2>   - åŠ ä¸Š app_secret æˆ– token
</span></span></span><span class=line><span class=cl><span class=s2>   - è®¡ç®— MD5 æˆ– SHA ç³»åˆ—
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>éœ€è¦æ›´å¤šè¯·æ±‚æ ·æœ¬æ¥ç¡®å®šå…·ä½“çš„ç­¾åç®—æ³•ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>å¯ä»¥å°è¯•ä¿®æ”¹å‚æ•°åæŠ“åŒ…ï¼Œå¯¹æ¯” sign å’Œ hash çš„å˜åŒ–ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>deep_analysis</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;æ·±åº¦åˆ†æ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ·±åº¦åˆ†æ - å¯»æ‰¾æ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åˆ†æ hash çš„ç»„æˆ</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hash æŒ‰ 64 å­—ç¬¦åˆ†å‰²ï¼ˆSHA256 é•¿åº¦ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>),</span> <span class=mi>64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>64</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  [</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hash æŒ‰ 32 å­—ç¬¦åˆ†å‰²ï¼ˆMD5 é•¿åº¦ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>),</span> <span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  [</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æ¨¡å¼</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ£€æŸ¥æ˜¯å¦æœ‰å­ä¸²é‡å¤:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span> <span class=o>-</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chunk</span> <span class=o>==</span> <span class=n>SIGN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ ä½ç½® </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=si>}</span><span class=s2> ä¸ sign ç›¸åŒ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chunk</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ ä½ç½® </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=si>}</span><span class=s2> ä¸æ–‡ä»¶å hash ç›¸åŒ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34; Hash ä¸å‚æ•°å…³ç³»åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>analyze_known_values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_filename_hash</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_sign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_hash_structure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>try_hash_combinations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>deep_analysis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_encryption</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>åˆ†æå®Œæˆï¼æ ¹æ®ç»“æœï¼Œæˆ‘æ¥æ€»ç»“å‘ç°å¹¶æ·»åŠ æ›´å¤šåˆ†æï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åˆ†æ hashã€signã€tã€shopId ä¸å›¾ç‰‡æ–‡ä»¶ä¹‹é—´çš„å…³ç³»
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å·²çŸ¥å‚æ•°</span>
</span></span><span class=line><span class=cl><span class=n>SIGN</span> <span class=o>=</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span>  <span class=c1># 32å­—ç¬¦ï¼ŒMD5æ ¼å¼</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=s2>&#34;1764833231217&#34;</span>  <span class=c1># æ—¶é—´æˆ³</span>
</span></span><span class=line><span class=cl><span class=n>HASH</span> <span class=o>=</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span>
</span></span><span class=line><span class=cl><span class=n>SHOP_ID</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FILENAME</span> <span class=o>=</span> <span class=s2>&#34;tmp_32e6dbcc2678d4d40a297ca5490acc4d.png&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»æ–‡ä»¶åä¸­æå–çš„hashéƒ¨åˆ†</span>
</span></span><span class=line><span class=cl><span class=n>FILENAME_HASH</span> <span class=o>=</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span>  <span class=c1># 32å­—ç¬¦ï¼ŒMD5æ ¼å¼</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ test.png ä½œä¸ºæµ‹è¯•å›¾ç‰‡</span>
</span></span><span class=line><span class=cl><span class=n>IMAGE_FILE</span> <span class=o>=</span> <span class=s2>&#34;test.png&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— MD5&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha1</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA1&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha256</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA256&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha512</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA512&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha512</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_section</span><span class=p>(</span><span class=n>title</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; </span><span class=si>{</span><span class=n>title</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_known_values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æå·²çŸ¥å€¼çš„ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å·²çŸ¥å€¼åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;sign: </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>SIGN</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ -&gt; MD5 æ ¼å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>t: </span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  çœ‹èµ·æ¥æ˜¯æ¯«ç§’çº§æ—¶é—´æˆ³&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>hash: </span><span class=si>{</span><span class=n>HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=si>}</span><span class=s2> bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‰ 128 å­—ç¬¦: </span><span class=si>{</span><span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å 32 å­—ç¬¦:  </span><span class=si>{</span><span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>shopId: </span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ–‡ä»¶å: </span><span class=si>{</span><span class=n>FILENAME</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶åä¸­çš„hashéƒ¨åˆ†: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>FILENAME_HASH</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ -&gt; MD5 æ ¼å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_filename_hash</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ–‡ä»¶åä¸­çš„ hash&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ–‡ä»¶å Hash åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è­¦å‘Š: </span><span class=si>{</span><span class=n>IMAGE_FILE</span><span class=si>}</span><span class=s2> ä¸å­˜åœ¨ï¼Œè·³è¿‡å›¾ç‰‡å†…å®¹åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>file_md5</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>file_sha1</span> <span class=o>=</span> <span class=n>sha1</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>file_sha256</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ MD5:    </span><span class=si>{</span><span class=n>file_md5</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ SHA1:   </span><span class=si>{</span><span class=n>file_sha1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ SHA256: </span><span class=si>{</span><span class=n>file_sha256</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ–‡ä»¶åä¸­çš„ hash: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file_md5</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;âœ“ æ–‡ä»¶åä¸­çš„ hash æ˜¯å›¾ç‰‡æ–‡ä»¶çš„ MD5ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;âœ— æ–‡ä»¶åä¸­çš„ hash ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶çš„ MD5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sign</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æ sign å‚æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Sign å‚æ•°åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•å„ç§ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>test_cases</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId+t&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&amp;shopId=value&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId=value&amp;t&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+shopId+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç›®æ ‡ sign: </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•å„ç§ç»„åˆçš„ MD5:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>test_cases</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“&#34;</span> <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>SIGN</span> <span class=k>else</span> <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2> MD5(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_hash_structure</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æ hash å‚æ•°ç»“æ„&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Hash å‚æ•°ç»“æ„åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_part1</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span>  <span class=c1># å¯èƒ½æ˜¯ SHA512</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_part2</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span>  <span class=c1># å¯èƒ½æ˜¯ MD5</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hash å‰ 128 å­—ç¬¦ï¼ˆç–‘ä¼¼ SHA512ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_part1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hash å 32 å­—ç¬¦ï¼ˆç–‘ä¼¼ MD5ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_part2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥å32å­—ç¬¦æ˜¯å¦ä¸æŸäº›å·²çŸ¥å€¼åŒ¹é…</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å 32 å­—ç¬¦ä¸å·²çŸ¥å€¼å¯¹æ¯”:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign:          </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename_hash: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hashå32å­—ç¬¦:  </span><span class=si>{</span><span class=n>hash_part2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hash_part2</span> <span class=o>==</span> <span class=n>SIGN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å 32 å­—ç¬¦ç­‰äº signï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hash_part2</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å 32 å­—ç¬¦ç­‰äºæ–‡ä»¶åä¸­çš„ hashï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_hash_combinations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å°è¯•å„ç§ hash ç»„åˆ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Hash ç»„åˆå°è¯•&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_part1</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_part2</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŠ è½½å›¾ç‰‡æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>    <span class=n>file_content</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>params_combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign&#34;</span><span class=p>,</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId+t&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign+t&#34;</span><span class=p>,</span> <span class=n>SIGN</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+sign&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId+sign&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign+shopId+t&#34;</span><span class=p>,</span> <span class=n>SIGN</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯• SHA512 åŒ¹é…å‰ 128 å­—ç¬¦:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>params_combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>hash_part1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ SHA512(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) åŒ¹é…ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>result</span><span class=p>[:</span><span class=mi>64</span><span class=p>]</span> <span class=o>==</span> <span class=n>hash_part1</span><span class=p>[:</span><span class=mi>64</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ~ SHA512(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) å‰åŠéƒ¨åˆ†åŒ¹é…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯• MD5 åŒ¹é…å 32 å­—ç¬¦:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>params_combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>hash_part2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ MD5(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) åŒ¹é…ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_encryption</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æå¯èƒ½çš„åŠ å¯†æ–¹å¼&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å¯èƒ½çš„åŠ å¯†/ç­¾åæ–¹å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºåˆ†æï¼Œè¿™ä¸ª API ç­¾åæœºåˆ¶å¯èƒ½æ˜¯ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>1. sign (32å­—ç¬¦ MD5):
</span></span></span><span class=line><span class=cl><span class=s2>   - å¯èƒ½æ˜¯ MD5(æŸäº›å‚æ•°ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>   - æˆ–è€… MD5(æŸä¸ªå¯†é’¥ + å‚æ•°)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>2. hash (160å­—ç¬¦ = SHA512 + MD5):
</span></span></span><span class=line><span class=cl><span class=s2>   - å‰ 128 å­—ç¬¦: SHA512(æŸäº›æ•°æ®)
</span></span></span><span class=line><span class=cl><span class=s2>   - å 32 å­—ç¬¦: MD5(æŸäº›æ•°æ®)
</span></span></span><span class=line><span class=cl><span class=s2>   
</span></span></span><span class=line><span class=cl><span class=s2>3. æ–‡ä»¶åä¸­çš„ hash:
</span></span></span><span class=line><span class=cl><span class=s2>   - tmp_</span><span class=si>{MD5}</span><span class=s2>.png æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=s2>   - å¯èƒ½æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>4. å¸¸è§çš„å¾®ä¿¡å°ç¨‹åºç­¾åæ–¹å¼:
</span></span></span><span class=line><span class=cl><span class=s2>   - å‚æ•°æŒ‰å­—æ¯æ’åº
</span></span></span><span class=line><span class=cl><span class=s2>   - æ‹¼æ¥æˆ key=value&amp;key=value æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=s2>   - åŠ ä¸Š app_secret æˆ– token
</span></span></span><span class=line><span class=cl><span class=s2>   - è®¡ç®— MD5 æˆ– SHA ç³»åˆ—
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>éœ€è¦æ›´å¤šè¯·æ±‚æ ·æœ¬æ¥ç¡®å®šå…·ä½“çš„ç­¾åç®—æ³•ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>å¯ä»¥å°è¯•ä¿®æ”¹å‚æ•°åæŠ“åŒ…ï¼Œå¯¹æ¯” sign å’Œ hash çš„å˜åŒ–ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_aes_analysis</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ˜¯å¦å¯èƒ½æ˜¯ AES åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;AES åŠ å¯†å¯èƒ½æ€§åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hash è½¬æ¢ä¸ºå­—èŠ‚åé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—èŠ‚&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span><span class=si>}</span><span class=s2> bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span> <span class=o>//</span> <span class=mi>16</span><span class=si>}</span><span class=s2> ä¸ª AES å— (æ¯å— 16 å­—èŠ‚)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 80 å­—èŠ‚ = 5 ä¸ª AES å—ï¼Œå¯èƒ½æ˜¯ AES-CBC åŠ å¯†ç»“æœ</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ é•¿åº¦æ˜¯ 16 çš„å€æ•°ï¼Œå¯èƒ½æ˜¯ AES åŠ å¯†&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ— é•¿åº¦ä¸æ˜¯ 16 çš„å€æ•°&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦åƒéšæœºæ•°æ®ï¼ˆé«˜ç†µï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>Counter</span>
</span></span><span class=line><span class=cl>    <span class=n>byte_freq</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å­—èŠ‚åˆ†å¸ƒ: å…± </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>byte_freq</span><span class=p>)</span><span class=si>}</span><span class=s2> ç§ä¸åŒå­—èŠ‚å€¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>byte_freq</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>60</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å­—èŠ‚åˆ†å¸ƒè¾ƒå‡åŒ€ï¼Œå¯èƒ½æ˜¯åŠ å¯†æ•°æ®æˆ– hash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_hex_decode</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å°è¯•å°† hash è§£ç ä¸ºå¯è¯»å†…å®¹&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£ç  Hash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hex è§£ç åçš„å­—èŠ‚ (å‰ 32 å­—èŠ‚):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_bytes</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯• UTF-8 è§£ç </span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>decoded</span> <span class=o>=</span> <span class=n>hash_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯ä»¥è§£ç ä¸º UTF-8: </span><span class=si>{</span><span class=n>decoded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ— æ³•è§£ç ä¸º UTF-8 (é¢„æœŸï¼Œå› ä¸ºæ˜¯äºŒè¿›åˆ¶æ•°æ®)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è§£ç å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_timestamp_relation</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ—¶é—´æˆ³ä¸å…¶ä»–å‚æ•°çš„å…³ç³»&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ—¶é—´æˆ³åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t_seconds</span> <span class=o>=</span> <span class=n>t_int</span> <span class=o>/</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>dt</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>t_seconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æ—¶é—´æˆ³: </span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è½¬æ¢ä¸ºæ—¥æœŸ: </span><span class=si>{</span><span class=n>dt</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦ä¸ sign æœ‰å…³</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•æ—¶é—´æˆ³ç›¸å…³çš„ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(t): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(t/1000): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>t_int</span> <span class=o>//</span> <span class=mi>1000</span><span class=p>))</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å¾®ä¿¡å°ç¨‹åºå¸¸ç”¨çš„ç­¾åæ–¹å¼</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¾®ä¿¡å°ç¨‹åºå¸¸è§ç­¾åæ ¼å¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>wx_sign1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>wx_sign2</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(</span><span class=si>{</span><span class=n>wx_sign1</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=n>wx_sign1</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(</span><span class=si>{</span><span class=n>wx_sign2</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=n>wx_sign2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>deep_analysis</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;æ·±åº¦åˆ†æ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ·±åº¦åˆ†æ - å¯»æ‰¾æ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åˆ†æ hash çš„ç»„æˆ</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hash æŒ‰ 64 å­—ç¬¦åˆ†å‰²ï¼ˆSHA256 é•¿åº¦ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>),</span> <span class=mi>64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>64</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  [</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hash æŒ‰ 32 å­—ç¬¦åˆ†å‰²ï¼ˆMD5 é•¿åº¦ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>),</span> <span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  [</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æ¨¡å¼</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ£€æŸ¥æ˜¯å¦æœ‰å­ä¸²é‡å¤:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span> <span class=o>-</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chunk</span> <span class=o>==</span> <span class=n>SIGN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ ä½ç½® </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=si>}</span><span class=s2> ä¸ sign ç›¸åŒ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chunk</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ ä½ç½® </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=si>}</span><span class=s2> ä¸æ–‡ä»¶å hash ç›¸åŒ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34; Hash ä¸å‚æ•°å…³ç³»åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>analyze_known_values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_filename_hash</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_sign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_hash_structure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>try_hash_combinations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>deep_analysis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_encryption</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åˆ†æ hashã€signã€tã€shopId ä¸å›¾ç‰‡æ–‡ä»¶ä¹‹é—´çš„å…³ç³»
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hmac</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å·²çŸ¥å‚æ•°</span>
</span></span><span class=line><span class=cl><span class=n>SIGN</span> <span class=o>=</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span>  <span class=c1># 32å­—ç¬¦ï¼ŒMD5æ ¼å¼</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=s2>&#34;1764833231217&#34;</span>  <span class=c1># æ—¶é—´æˆ³</span>
</span></span><span class=line><span class=cl><span class=n>HASH</span> <span class=o>=</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span>
</span></span><span class=line><span class=cl><span class=n>SHOP_ID</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl><span class=n>FILENAME</span> <span class=o>=</span> <span class=s2>&#34;tmp_32e6dbcc2678d4d40a297ca5490acc4d.png&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»æ–‡ä»¶åä¸­æå–çš„hashéƒ¨åˆ†</span>
</span></span><span class=line><span class=cl><span class=n>FILENAME_HASH</span> <span class=o>=</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span>  <span class=c1># 32å­—ç¬¦ï¼ŒMD5æ ¼å¼</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ test.png ä½œä¸ºæµ‹è¯•å›¾ç‰‡</span>
</span></span><span class=line><span class=cl><span class=n>IMAGE_FILE</span> <span class=o>=</span> <span class=s2>&#34;test.png&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— MD5&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha1</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA1&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha256</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA256&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sha512</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®— SHA512&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha512</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_section</span><span class=p>(</span><span class=n>title</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34; </span><span class=si>{</span><span class=n>title</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_known_values</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æå·²çŸ¥å€¼çš„ç‰¹å¾&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å·²çŸ¥å€¼åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;sign: </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>SIGN</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ -&gt; MD5 æ ¼å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>t: </span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  çœ‹èµ·æ¥æ˜¯æ¯«ç§’çº§æ—¶é—´æˆ³&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>hash: </span><span class=si>{</span><span class=n>HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span> <span class=o>*</span> <span class=mi>4</span><span class=si>}</span><span class=s2> bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‰ 128 å­—ç¬¦: </span><span class=si>{</span><span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å 32 å­—ç¬¦:  </span><span class=si>{</span><span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>shopId: </span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ–‡ä»¶å: </span><span class=si>{</span><span class=n>FILENAME</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶åä¸­çš„hashéƒ¨åˆ†: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>FILENAME_HASH</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—ç¬¦ -&gt; MD5 æ ¼å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_filename_hash</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ–‡ä»¶åä¸­çš„ hash&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ–‡ä»¶å Hash åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è­¦å‘Š: </span><span class=si>{</span><span class=n>IMAGE_FILE</span><span class=si>}</span><span class=s2> ä¸å­˜åœ¨ï¼Œè·³è¿‡å›¾ç‰‡å†…å®¹åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>file_md5</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>file_sha1</span> <span class=o>=</span> <span class=n>sha1</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>file_sha256</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ MD5:    </span><span class=si>{</span><span class=n>file_md5</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ SHA1:   </span><span class=si>{</span><span class=n>file_sha1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å›¾ç‰‡æ–‡ä»¶ SHA256: </span><span class=si>{</span><span class=n>file_sha256</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ–‡ä»¶åä¸­çš„ hash: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file_md5</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;âœ“ æ–‡ä»¶åä¸­çš„ hash æ˜¯å›¾ç‰‡æ–‡ä»¶çš„ MD5ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;âœ— æ–‡ä»¶åä¸­çš„ hash ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶çš„ MD5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_sign</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æ sign å‚æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Sign å‚æ•°åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•å„ç§ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>test_cases</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId+t&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&amp;shopId=value&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId=value&amp;t&#34;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+shopId+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç›®æ ‡ sign: </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•å„ç§ç»„åˆçš„ MD5:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>test_cases</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“&#34;</span> <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>SIGN</span> <span class=k>else</span> <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2> MD5(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_hash_structure</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æ hash å‚æ•°ç»“æ„&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Hash å‚æ•°ç»“æ„åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_part1</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span>  <span class=c1># å¯èƒ½æ˜¯ SHA512</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_part2</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span>  <span class=c1># å¯èƒ½æ˜¯ MD5</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hash å‰ 128 å­—ç¬¦ï¼ˆç–‘ä¼¼ SHA512ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_part1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hash å 32 å­—ç¬¦ï¼ˆç–‘ä¼¼ MD5ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_part2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥å32å­—ç¬¦æ˜¯å¦ä¸æŸäº›å·²çŸ¥å€¼åŒ¹é…</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å 32 å­—ç¬¦ä¸å·²çŸ¥å€¼å¯¹æ¯”:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign:          </span><span class=si>{</span><span class=n>SIGN</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename_hash: </span><span class=si>{</span><span class=n>FILENAME_HASH</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hashå32å­—ç¬¦:  </span><span class=si>{</span><span class=n>hash_part2</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hash_part2</span> <span class=o>==</span> <span class=n>SIGN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å 32 å­—ç¬¦ç­‰äº signï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hash_part2</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å 32 å­—ç¬¦ç­‰äºæ–‡ä»¶åä¸­çš„ hashï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_hash_combinations</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å°è¯•å„ç§ hash ç»„åˆ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;Hash ç»„åˆå°è¯•&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_part1</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[:</span><span class=mi>128</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_part2</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=mi>128</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŠ è½½å›¾ç‰‡æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>    <span class=n>file_content</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>IMAGE_FILE</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>params_combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t&#34;</span><span class=p>,</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign&#34;</span><span class=p>,</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;shopId+t&#34;</span><span class=p>,</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign+t&#34;</span><span class=p>,</span> <span class=n>SIGN</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+sign&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;filename_hash+t&#34;</span><span class=p>,</span> <span class=n>FILENAME_HASH</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+filename_hash&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>FILENAME_HASH</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;t+shopId+sign&#34;</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>SIGN</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=s2>&#34;sign+shopId+t&#34;</span><span class=p>,</span> <span class=n>SIGN</span> <span class=o>+</span> <span class=n>SHOP_ID</span> <span class=o>+</span> <span class=n>T</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯• SHA512 åŒ¹é…å‰ 128 å­—ç¬¦:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>params_combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>hash_part1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ SHA512(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) åŒ¹é…ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>result</span><span class=p>[:</span><span class=mi>64</span><span class=p>]</span> <span class=o>==</span> <span class=n>hash_part1</span><span class=p>[:</span><span class=mi>64</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ~ SHA512(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) å‰åŠéƒ¨åˆ†åŒ¹é…&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯• MD5 åŒ¹é…å 32 å­—ç¬¦:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>params_combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>result</span> <span class=o>==</span> <span class=n>hash_part2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ MD5(</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>) åŒ¹é…ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_encryption</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†æå¯èƒ½çš„åŠ å¯†æ–¹å¼&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å¯èƒ½çš„åŠ å¯†/ç­¾åæ–¹å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºåˆ†æï¼Œè¿™ä¸ª API ç­¾åæœºåˆ¶å¯èƒ½æ˜¯ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>1. sign (32å­—ç¬¦ MD5):
</span></span></span><span class=line><span class=cl><span class=s2>   - å¯èƒ½æ˜¯ MD5(æŸäº›å‚æ•°ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>   - æˆ–è€… MD5(æŸä¸ªå¯†é’¥ + å‚æ•°)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>2. hash (160å­—ç¬¦ = SHA512 + MD5):
</span></span></span><span class=line><span class=cl><span class=s2>   - å‰ 128 å­—ç¬¦: SHA512(æŸäº›æ•°æ®)
</span></span></span><span class=line><span class=cl><span class=s2>   - å 32 å­—ç¬¦: MD5(æŸäº›æ•°æ®)
</span></span></span><span class=line><span class=cl><span class=s2>   
</span></span></span><span class=line><span class=cl><span class=s2>3. æ–‡ä»¶åä¸­çš„ hash:
</span></span></span><span class=line><span class=cl><span class=s2>   - tmp_</span><span class=si>{MD5}</span><span class=s2>.png æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=s2>   - å¯èƒ½æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>4. å¸¸è§çš„å¾®ä¿¡å°ç¨‹åºç­¾åæ–¹å¼:
</span></span></span><span class=line><span class=cl><span class=s2>   - å‚æ•°æŒ‰å­—æ¯æ’åº
</span></span></span><span class=line><span class=cl><span class=s2>   - æ‹¼æ¥æˆ key=value&amp;key=value æ ¼å¼
</span></span></span><span class=line><span class=cl><span class=s2>   - åŠ ä¸Š app_secret æˆ– token
</span></span></span><span class=line><span class=cl><span class=s2>   - è®¡ç®— MD5 æˆ– SHA ç³»åˆ—
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>éœ€è¦æ›´å¤šè¯·æ±‚æ ·æœ¬æ¥ç¡®å®šå…·ä½“çš„ç­¾åç®—æ³•ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>å¯ä»¥å°è¯•ä¿®æ”¹å‚æ•°åæŠ“åŒ…ï¼Œå¯¹æ¯” sign å’Œ hash çš„å˜åŒ–ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_aes_analysis</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ˜¯å¦å¯èƒ½æ˜¯ AES åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;AES åŠ å¯†å¯èƒ½æ€§åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hash è½¬æ¢ä¸ºå­—èŠ‚åé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> å­—èŠ‚&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span><span class=si>}</span><span class=s2> bits&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span> <span class=o>//</span> <span class=mi>16</span><span class=si>}</span><span class=s2> ä¸ª AES å— (æ¯å— 16 å­—èŠ‚)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 80 å­—èŠ‚ = 5 ä¸ª AES å—ï¼Œå¯èƒ½æ˜¯ AES-CBC åŠ å¯†ç»“æœ</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ é•¿åº¦æ˜¯ 16 çš„å€æ•°ï¼Œå¯èƒ½æ˜¯ AES åŠ å¯†&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ— é•¿åº¦ä¸æ˜¯ 16 çš„å€æ•°&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦åƒéšæœºæ•°æ®ï¼ˆé«˜ç†µï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>Counter</span>
</span></span><span class=line><span class=cl>    <span class=n>byte_freq</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=n>hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å­—èŠ‚åˆ†å¸ƒ: å…± </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>byte_freq</span><span class=p>)</span><span class=si>}</span><span class=s2> ç§ä¸åŒå­—èŠ‚å€¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>byte_freq</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>60</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  âœ“ å­—èŠ‚åˆ†å¸ƒè¾ƒå‡åŒ€ï¼Œå¯èƒ½æ˜¯åŠ å¯†æ•°æ®æˆ– hash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>try_hex_decode</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å°è¯•å°† hash è§£ç ä¸ºå¯è¯»å†…å®¹&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£ç  Hash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Hex è§£ç åçš„å­—èŠ‚ (å‰ 32 å­—èŠ‚):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>hash_bytes</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯• UTF-8 è§£ç </span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>decoded</span> <span class=o>=</span> <span class=n>hash_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯ä»¥è§£ç ä¸º UTF-8: </span><span class=si>{</span><span class=n>decoded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ— æ³•è§£ç ä¸º UTF-8 (é¢„æœŸï¼Œå› ä¸ºæ˜¯äºŒè¿›åˆ¶æ•°æ®)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è§£ç å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_timestamp_relation</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;åˆ†ææ—¶é—´æˆ³ä¸å…¶ä»–å‚æ•°çš„å…³ç³»&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ—¶é—´æˆ³åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t_seconds</span> <span class=o>=</span> <span class=n>t_int</span> <span class=o>/</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>dt</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>t_seconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æ—¶é—´æˆ³: </span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è½¬æ¢ä¸ºæ—¥æœŸ: </span><span class=si>{</span><span class=n>dt</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦ä¸ sign æœ‰å…³</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•æ—¶é—´æˆ³ç›¸å…³çš„ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(t): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=n>T</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(t/1000): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>t_int</span> <span class=o>//</span> <span class=mi>1000</span><span class=p>))</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å¾®ä¿¡å°ç¨‹åºå¸¸ç”¨çš„ç­¾åæ–¹å¼</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¾®ä¿¡å°ç¨‹åºå¸¸è§ç­¾åæ ¼å¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>wx_sign1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>wx_sign2</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;t=</span><span class=si>{</span><span class=n>T</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>SHOP_ID</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(</span><span class=si>{</span><span class=n>wx_sign1</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=n>wx_sign1</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  MD5(</span><span class=si>{</span><span class=n>wx_sign2</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>md5</span><span class=p>(</span><span class=n>wx_sign2</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>deep_analysis</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;æ·±åº¦åˆ†æ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>print_section</span><span class=p>(</span><span class=s2>&#34;æ·±åº¦åˆ†æ - å¯»æ‰¾æ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åˆ†æ hash çš„ç»„æˆ</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Hash æŒ‰ 64 å­—ç¬¦åˆ†å‰²ï¼ˆSHA256 é•¿åº¦ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>),</span> <span class=mi>64</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>64</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  [</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Hash æŒ‰ 32 å­—ç¬¦åˆ†å‰²ï¼ˆMD5 é•¿åº¦ï¼‰:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>),</span> <span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  [</span><span class=si>{</span><span class=n>i</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>]: </span><span class=si>{</span><span class=n>chunk</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æ¨¡å¼</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ£€æŸ¥æ˜¯å¦æœ‰å­ä¸²é‡å¤:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>HASH</span><span class=p>)</span> <span class=o>-</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>32</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>chunk</span> <span class=o>=</span> <span class=n>HASH</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chunk</span> <span class=o>==</span> <span class=n>SIGN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ ä½ç½® </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=si>}</span><span class=s2> ä¸ sign ç›¸åŒ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>chunk</span> <span class=o>==</span> <span class=n>FILENAME_HASH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  âœ“ ä½ç½® </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>32</span><span class=si>}</span><span class=s2> ä¸æ–‡ä»¶å hash ç›¸åŒ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34; Hash ä¸å‚æ•°å…³ç³»åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>analyze_known_values</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_filename_hash</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_sign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_hash_structure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>try_hash_combinations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>deep_analysis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_timestamp_relation</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>try_aes_analysis</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>try_hex_decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>analyze_encryption</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>åˆ†æå®Œæˆï¼ä»¥ä¸‹æ˜¯å…³é”®å‘ç°ï¼š</p><h2 id=åˆ†æç»“è®º><a href=#%e5%88%86%e6%9e%90%e7%bb%93%e8%ae%ba class=header-anchor></a>åˆ†æç»“è®º</h2><h3 id=1-sign32å­—ç¬¦><a href=#1-sign32%e5%ad%97%e7%ac%a6 class=header-anchor></a>1. <strong>signï¼ˆ32å­—ç¬¦ï¼‰</strong></h3><ul><li>æ ¼å¼ä¸º MD5</li><li>æ— æ³•é€šè¿‡ç®€å•çš„å‚æ•°ç»„åˆå¤ç°</li><li>å¾ˆå¯èƒ½ä½¿ç”¨äº† <strong>æœåŠ¡å™¨å¯†é’¥/app_secret</strong> å‚ä¸è®¡ç®—</li></ul><h3 id=2-hash160å­—ç¬¦--80å­—èŠ‚><a href=#2-hash160%e5%ad%97%e7%ac%a6--80%e5%ad%97%e8%8a%82 class=header-anchor></a>2. <strong>hashï¼ˆ160å­—ç¬¦ = 80å­—èŠ‚ï¼‰</strong></h3><ul><li><strong>å¯èƒ½æ˜¯ AES åŠ å¯†</strong>ï¼Œè€Œéçº¯å“ˆå¸Œæ‹¼æ¥</li><li>é•¿åº¦æ­£å¥½æ˜¯ 5 ä¸ª AES å—ï¼ˆæ¯å— 16 å­—èŠ‚ï¼‰</li><li>å­—èŠ‚åˆ†å¸ƒå‡åŒ€ï¼Œç¬¦åˆåŠ å¯†æ•°æ®ç‰¹å¾</li><li>å¯èƒ½æ˜¯å¯¹æŸäº›æ•æ„Ÿæ•°æ®ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€æ–‡ä»¶ä¿¡æ¯ï¼‰çš„åŠ å¯†ç»“æœ</li></ul><h3 id=3-æ–‡ä»¶åä¸­çš„-hash><a href=#3-%e6%96%87%e4%bb%b6%e5%90%8d%e4%b8%ad%e7%9a%84-hash class=header-anchor></a>3. <strong>æ–‡ä»¶åä¸­çš„ hash</strong></h3><ul><li><code>tmp_32e6dbcc2678d4d40a297ca5490acc4d.png</code> ä¸­çš„ hash æ˜¯åŸå§‹å›¾ç‰‡çš„ MD5</li><li><code>test.png</code> çš„ MD5 æ˜¯ <code>5883ca5003f5e1315db79be5dc200e1f</code>ï¼Œä¸ä¹‹ä¸åŒ¹é…</li><li>è¯´æ˜ <code>test.png</code> ä¸æ˜¯åŸå§‹ä¸Šä¼ çš„é‚£å¼ å›¾ç‰‡</li></ul><h3 id=4-æ—¶é—´æˆ³-t><a href=#4-%e6%97%b6%e9%97%b4%e6%88%b3-t class=header-anchor></a>4. <strong>æ—¶é—´æˆ³ t</strong></h3><ul><li>æ¯«ç§’çº§æ—¶é—´æˆ³ <code>1764833231217</code></li><li>å¯¹åº”æ—¶é—´ï¼š<code>2025-12-04 15:27:11.217</code></li></ul><h2 id=ä¸‹ä¸€æ­¥å»ºè®®><a href=#%e4%b8%8b%e4%b8%80%e6%ad%a5%e5%bb%ba%e8%ae%ae class=header-anchor></a>ä¸‹ä¸€æ­¥å»ºè®®</h2><p>è¦å½»åº•ç ´è§£ç­¾åç®—æ³•ï¼Œå»ºè®®ï¼š</p><ol><li><strong>åç¼–è¯‘å–œèŒ¶å°ç¨‹åº</strong>ï¼ŒæŸ¥æ‰¾ç­¾åç”Ÿæˆä»£ç </li><li><strong>å¤šæ¬¡æŠ“åŒ…å¯¹æ¯”</strong>ï¼Œè§‚å¯Ÿ sign å’Œ hash éšå‚æ•°å˜åŒ–çš„è§„å¾‹</li><li>å¦‚æœ hash ç¡®å®æ˜¯ AES åŠ å¯†ï¼Œéœ€è¦æ‰¾åˆ°åŠ å¯†å¯†é’¥</li></ol><p>éœ€è¦æˆ‘å¸®ä½ åç¼–è¯‘å°ç¨‹åºæˆ–åšè¿›ä¸€æ­¥åˆ†æå—ï¼Ÿ</p><hr><p><strong>User</strong></p><p>æˆ‘å·²åç¼–è¯‘ç›¸å…³ä»£ç ï¼Œç°åœ¨è¦å¦‚ä½•æ‰¾åˆ°ç­¾åç›¸å…³ç‰‡æ®µå‘¢</p><hr><p><strong>Cursor</strong></p><p>æˆ‘æ¥å¸®ä½ åœ¨åç¼–è¯‘çš„ä»£ç ä¸­æœç´¢ç­¾åç›¸å…³çš„ä»£ç ç‰‡æ®µï¼š</p><p>æ‰¾åˆ°å…³é”®æ–‡ä»¶äº†ï¼è®©æˆ‘æ·±å…¥æœç´¢ <code>common.js</code> ä¸­çš„ç­¾åé€»è¾‘ï¼š</p><p>æ‰¾åˆ°äº†å…³é”®çº¿ç´¢ï¼å‘ç°äº† <code>calDIYSign</code> å‡½æ•°ã€‚è®©æˆ‘æ·±å…¥æŸ¥çœ‹ï¼š</p><p>éå¸¸é‡è¦çš„å‘ç°ï¼ç­¾åæ˜¯é€šè¿‡<strong>å¾®ä¿¡å°ç¨‹åºæ’ä»¶</strong>è®¡ç®—çš„ã€‚è®©æˆ‘æ‰¾åˆ°æ›´å¤šç»†èŠ‚ï¼š</p><p>è®©æˆ‘æœç´¢æ’ä»¶é…ç½®å’Œæ¯è´´ä¸Šä¼ çš„å…·ä½“å®ç°ï¼š</p><p>æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œé€»è¾‘åœ¨ <code>common.js</code> ä¸­ã€‚è®©æˆ‘æœç´¢ä¸Šä¼ æ¯è´´çš„å…·ä½“ä»£ç ï¼š</p><p>è®©æˆ‘æ‰¾åˆ°è°ƒç”¨ç­¾åå’Œä¸Šä¼ çš„å®Œæ•´æµç¨‹ï¼š</p><p>è®©æˆ‘æœç´¢æ’ä»¶åˆå§‹åŒ–å’Œå®é™…ä¸Šä¼ è°ƒç”¨ï¼š</p><p>è®©æˆ‘æœç´¢å®é™…å‘é€ DIY è¯·æ±‚çš„ä»£ç ï¼š</p><p>æˆ‘å·²ç»æ‰¾åˆ°å…³é”®ä¿¡æ¯äº†ï¼è®©æˆ‘ä¸ºä½ æ€»ç»“å¹¶åˆ›å»ºä¸€ä¸ªåˆ†æè„šæœ¬ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶å°ç¨‹åº DIY æ¯è´´ç­¾åæœºåˆ¶åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºåç¼–è¯‘ä»£ç çš„å‘ç°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>======================
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>1. ç­¾åè®¡ç®—ä½ç½®
</span></span></span><span class=line><span class=cl><span class=s2>   - DIY æ¯è´´çš„ç­¾å (sign, hash) æ˜¯é€šè¿‡åŸç”Ÿæ’ä»¶è®¡ç®—çš„
</span></span></span><span class=line><span class=cl><span class=s2>   - æ’ä»¶åç§°: CrashReportAndIosPush (æˆ–ç±»ä¼¼)
</span></span></span><span class=line><span class=cl><span class=s2>   - è°ƒç”¨æ–¹æ³•: pluginInstance.calDIYSign({ fileHash: e })
</span></span></span><span class=line><span class=cl><span class=s2>   - è¾“å…¥å‚æ•°: fileHash (å›¾ç‰‡æ–‡ä»¶çš„ MD5 hash)
</span></span></span><span class=line><span class=cl><span class=s2>   - è¿”å›æ•°æ®: { errorCode, message, data }
</span></span></span><span class=line><span class=cl><span class=s2>   
</span></span></span><span class=line><span class=cl><span class=s2>2. ç›¸å…³ä»£ç ç‰‡æ®µ (common.js ç¬¬ 5368-5400 è¡Œ):
</span></span></span><span class=line><span class=cl><span class=s2>   ```javascript
</span></span></span><span class=line><span class=cl><span class=s2>   key: &#34;calculateDiySign&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>   value: function(e) {
</span></span></span><span class=line><span class=cl><span class=s2>       if (!this._checkPluginInitialized()) return null;
</span></span></span><span class=line><span class=cl><span class=s2>       var t = this.pluginInstance;
</span></span></span><span class=line><span class=cl><span class=s2>       if (!t || &#34;function&#34; != typeof t.calDIYSign) return null;
</span></span></span><span class=line><span class=cl><span class=s2>       try {
</span></span></span><span class=line><span class=cl><span class=s2>           var n = t.calDIYSign({
</span></span></span><span class=line><span class=cl><span class=s2>               fileHash: e  // &lt;-- è¾“å…¥æ˜¯æ–‡ä»¶çš„ MD5 hash
</span></span></span><span class=line><span class=cl><span class=s2>           }),
</span></span></span><span class=line><span class=cl><span class=s2>           // ... è§£æè¿”å›ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>       }
</span></span></span><span class=line><span class=cl><span class=s2>   }
</span></span></span></code></pre></td></tr></table></div></div><ol start=3><li><p>è®¢å•ç­¾åå¯¹æ¯” (common.js ç¬¬ 16099-16100 è¡Œ):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>o</span> <span class=o>=</span> <span class=nx>j</span><span class=p>.</span><span class=nx>HmacMD5</span><span class=p>(</span><span class=s2>&#34;submitOrder&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>).</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>r</span> <span class=o>=</span> <span class=sb>`?app=</span><span class=si>${</span><span class=nx>t</span><span class=si>}</span><span class=sb>&amp;n=</span><span class=si>${</span><span class=nx>r</span><span class=si>}</span><span class=sb>&amp;t=</span><span class=si>${</span><span class=nx>a</span><span class=si>}</span><span class=sb>&amp;biz=</span><span class=si>${</span><span class=nx>o</span><span class=si>}</span><span class=sb>&amp;sign=`</span> <span class=o>+</span> <span class=nx>j</span><span class=p>.</span><span class=nx>HmacMD5</span><span class=p>(</span><span class=nx>t</span> <span class=o>+</span> <span class=nx>r</span> <span class=o>+</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>o</span> <span class=o>+</span> <span class=nx>e</span><span class=p>,</span> <span class=nx>t</span> <span class=o>+</span> <span class=nx>e</span><span class=p>).</span><span class=nx>toString</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>è®¢å•ç­¾åä½¿ç”¨ HmacMD5ï¼Œä½† DIY æ¯è´´ç­¾åä½¿ç”¨åŸç”Ÿæ’ä»¶ã€‚</p></li><li><p>ç»“è®º:</p><ul><li>sign å’Œ hash å‚æ•°æ˜¯ç”±åŸç”Ÿæ’ä»¶è®¡ç®—çš„ï¼Œç®—æ³•ä¸åœ¨ JavaScript ä»£ç ä¸­</li><li>éœ€è¦åˆ†æåŸç”Ÿæ’ä»¶æ‰èƒ½å¾—åˆ°å®Œæ•´çš„ç­¾åç®—æ³•</li><li>å¯èƒ½éœ€è¦ä½¿ç”¨ Frida/Xposed ç­‰å·¥å…· Hook åŸç”Ÿæ–¹æ³•æ¥è·å–ç­¾å
"""</li></ul></li></ol><p>import hashlib
import hmac
import time
import os</p><h1 id=å·²çŸ¥å‚æ•°><a href=#%e5%b7%b2%e7%9f%a5%e5%8f%82%e6%95%b0 class=header-anchor></a>å·²çŸ¥å‚æ•°</h1><p>SIGN = &ldquo;805f30f5c3cb85e1779ae3daacf8dce5&rdquo;
T = &ldquo;1764833231217&rdquo;
HASH_PARAM = &ldquo;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&rdquo;
SHOP_ID = &ldquo;4216&rdquo;
FILENAME_HASH = &ldquo;32e6dbcc2678d4d40a297ca5490acc4d&rdquo; # åŸå§‹æ–‡ä»¶ MD5</p><p>def md5(data):
if isinstance(data, str):
data = data.encode(&lsquo;utf-8&rsquo;)
return hashlib.md5(data).hexdigest()</p><p>def sha512(data):
if isinstance(data, str):
data = data.encode(&lsquo;utf-8&rsquo;)
return hashlib.sha512(data).hexdigest()</p><p>def hmac_md5(key, msg):
if isinstance(key, str):
key = key.encode(&lsquo;utf-8&rsquo;)
if isinstance(msg, str):
msg = msg.encode(&lsquo;utf-8&rsquo;)
return hmac.new(key, msg, hashlib.md5).hexdigest()</p><p>def print_section(title):
print("\n" + &ldquo;=&rdquo; * 70)
print(f" {title}")
print("=" * 70)</p><p>def analyze_plugin_signature():
&ldquo;&ldquo;&ldquo;åˆ†ææ’ä»¶ç­¾åæœºåˆ¶&rdquo;&rdquo;&rdquo;
print_section(&ldquo;DIY æ¯è´´ç­¾åæœºåˆ¶åˆ†æ&rdquo;)</p><pre><code>print(&quot;&quot;&quot;
</code></pre><h2 id=ç­¾åæµç¨‹æ ¹æ®åç¼–è¯‘ä»£ç æ¨æ–­><a href=#%e7%ad%be%e5%90%8d%e6%b5%81%e7%a8%8b%e6%a0%b9%e6%8d%ae%e5%8f%8d%e7%bc%96%e8%af%91%e4%bb%a3%e7%a0%81%e6%8e%a8%e6%96%ad class=header-anchor></a>ç­¾åæµç¨‹ï¼ˆæ ¹æ®åç¼–è¯‘ä»£ç æ¨æ–­ï¼‰:</h2><ol><li><p>ç”¨æˆ·åœ¨ç”»å¸ƒä¸Šåˆ›ä½œå®Œæˆåï¼Œè°ƒç”¨ wx.canvasToTempFilePath ç”Ÿæˆä¸´æ—¶å›¾ç‰‡</p></li><li><p>è®¡ç®—å›¾ç‰‡æ–‡ä»¶çš„ MD5 (fileHash):</p><ul><li>ç¤ºä¾‹: 32e6dbcc2678d4d40a297ca5490acc4d</li><li>è¿™ä¹Ÿæ˜¯æ–‡ä»¶å tmp_{hash}.png ä¸­çš„ hash</li></ul></li><li><p>è°ƒç”¨åŸç”Ÿæ’ä»¶è®¡ç®—ç­¾å:</p><ul><li>pluginInstance.calDIYSign({ fileHash: &ldquo;32e6dbcc&mldr;&rdquo; })</li><li>è¿”å›: { errorCode: 0, message: &ldquo;SUCCESS&rdquo;, data: &ldquo;ç­¾åæ•°æ®&rdquo; }</li></ul></li><li><p>æ„é€ è¯·æ±‚å‚æ•°:</p><ul><li>sign: ç”±æ’ä»¶è¿”å›ï¼ˆå¯èƒ½æ˜¯ç­¾åæ•°æ®çš„ä¸€éƒ¨åˆ†ï¼‰</li><li>t: å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</li><li>hash: ç”±æ’ä»¶è¿”å›ï¼ˆå¯èƒ½æ˜¯åŠ å¯†åçš„æ•°æ®ï¼‰</li><li>shopId: å½“å‰é—¨åº— ID</li></ul></li><li><p>ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨:</p><ul><li>URL: /api/service-cps/user/diy?sign=&mldr;&amp;t=&mldr;&amp;hash=&mldr;&amp;shopId=&mldr;</li><li>Body: multipart/form-data (file, width, height)
&ldquo;&rdquo;")</li></ul></li></ol><p>def analyze_known_values():
&ldquo;&ldquo;&ldquo;åˆ†æå·²çŸ¥å€¼&rdquo;&rdquo;&rdquo;
print_section(&ldquo;å·²çŸ¥å‚æ•°åˆ†æ&rdquo;)</p><pre><code>print(f&quot;sign (32å­—ç¬¦ = MD5 æ ¼å¼):&quot;)
print(f&quot;  {SIGN}&quot;)

print(f&quot;\nt (æ—¶é—´æˆ³):&quot;)
print(f&quot;  {T}&quot;)

print(f&quot;\nhash (160å­—ç¬¦ = 80å­—èŠ‚):&quot;)
print(f&quot;  å‰64: {HASH_PARAM[:64]}&quot;)
print(f&quot;  ä¸­64: {HASH_PARAM[64:128]}&quot;)
print(f&quot;  å32: {HASH_PARAM[128:]}&quot;)

print(f&quot;\nshopId:&quot;)
print(f&quot;  {SHOP_ID}&quot;)

print(f&quot;\næ–‡ä»¶åä¸­çš„ hash (åŸå›¾ MD5):&quot;)
print(f&quot;  {FILENAME_HASH}&quot;)
</code></pre><p>def try_common_patterns():
&ldquo;&ldquo;&ldquo;å°è¯•å¸¸è§ç­¾åæ¨¡å¼&rdquo;&rdquo;&rdquo;
print_section(&ldquo;å°è¯•å¸¸è§ç­¾åæ¨¡å¼&rdquo;)</p><pre><code># å¸¸è§çš„å°ç¨‹åºç­¾åæ¨¡å¼
patterns = [
    # HMAC-MD5 æ¨¡å¼
    (&quot;HMAC-MD5(fileHash, '')&quot;, hmac_md5(&quot;&quot;, FILENAME_HASH)),
    (&quot;HMAC-MD5('', fileHash)&quot;, hmac_md5(FILENAME_HASH, &quot;&quot;)),
    (&quot;HMAC-MD5(t, fileHash)&quot;, hmac_md5(T, FILENAME_HASH)),
    (&quot;HMAC-MD5(fileHash, t)&quot;, hmac_md5(FILENAME_HASH, T)),
    (&quot;HMAC-MD5(shopId, fileHash)&quot;, hmac_md5(SHOP_ID, FILENAME_HASH)),
    (&quot;HMAC-MD5(fileHash, shopId)&quot;, hmac_md5(FILENAME_HASH, SHOP_ID)),
    
    # MD5 ç»„åˆæ¨¡å¼
    (&quot;MD5(fileHash + t)&quot;, md5(FILENAME_HASH + T)),
    (&quot;MD5(t + fileHash)&quot;, md5(T + FILENAME_HASH)),
    (&quot;MD5(fileHash + shopId + t)&quot;, md5(FILENAME_HASH + SHOP_ID + T)),
    (&quot;MD5(t + shopId + fileHash)&quot;, md5(T + SHOP_ID + FILENAME_HASH)),
]

print(f&quot;ç›®æ ‡ sign: {SIGN}\n&quot;)

for name, result in patterns:
    match = &quot;âœ“ åŒ¹é…!&quot; if result == SIGN else &quot;&quot;
    print(f&quot;  {name}:&quot;)
    print(f&quot;    {result} {match}&quot;)
</code></pre><p>def suggest_next_steps():
&ldquo;&ldquo;&ldquo;å»ºè®®ä¸‹ä¸€æ­¥æ“ä½œ&rdquo;&rdquo;&rdquo;
print_section(&ldquo;å»ºè®®çš„ä¸‹ä¸€æ­¥æ“ä½œ&rdquo;)</p><pre><code>print(&quot;&quot;&quot;
</code></pre><p>ç”±äºç­¾åç®—æ³•åœ¨åŸç”Ÿæ’ä»¶ä¸­ï¼Œå»ºè®®ä»¥ä¸‹æ–¹æ³•æ¥è·å–ç­¾å:</p><h2 id=æ–¹æ³•-1-hook-åŸç”Ÿæ’ä»¶><a href=#%e6%96%b9%e6%b3%95-1-hook-%e5%8e%9f%e7%94%9f%e6%8f%92%e4%bb%b6 class=header-anchor></a>æ–¹æ³• 1: Hook åŸç”Ÿæ’ä»¶</h2><p>ä½¿ç”¨ Frida æˆ– Xposed Hook æ’ä»¶çš„ calDIYSign æ–¹æ³•:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Frida è„šæœ¬ç¤ºä¾‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Java</span><span class=p>.</span><span class=nx>perform</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>pluginClass</span> <span class=o>=</span> <span class=nx>Java</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s2>&#34;com.heytea.xxx.DIYSignPlugin&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>pluginClass</span><span class=p>.</span><span class=nx>calDIYSign</span><span class=p>.</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Input fileHash: &#34;</span> <span class=o>+</span> <span class=nx>params</span><span class=p>.</span><span class=nx>fileHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>calDIYSign</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Output: &#34;</span> <span class=o>+</span> <span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=æ–¹æ³•-2-æŠ“å–å¤šä¸ªè¯·æ±‚æ ·æœ¬><a href=#%e6%96%b9%e6%b3%95-2-%e6%8a%93%e5%8f%96%e5%a4%9a%e4%b8%aa%e8%af%b7%e6%b1%82%e6%a0%b7%e6%9c%ac class=header-anchor></a>æ–¹æ³• 2: æŠ“å–å¤šä¸ªè¯·æ±‚æ ·æœ¬</h2><ol><li>ä½¿ç”¨ä¸åŒå›¾ç‰‡å¤šæ¬¡æŠ“åŒ…</li><li>è®°å½•æ¯æ¬¡çš„ fileHashã€signã€hashã€t</li><li>åˆ†æå‚æ•°ä¹‹é—´çš„æ•°å­¦å…³ç³»</li></ol><h2 id=æ–¹æ³•-3-é€†å‘åŸç”Ÿæ’ä»¶><a href=#%e6%96%b9%e6%b3%95-3-%e9%80%86%e5%90%91%e5%8e%9f%e7%94%9f%e6%8f%92%e4%bb%b6 class=header-anchor></a>æ–¹æ³• 3: é€†å‘åŸç”Ÿæ’ä»¶</h2><ol><li>æ‰¾åˆ°æ’ä»¶çš„ AppID: åœ¨ app.json çš„ plugins é…ç½®ä¸­</li><li>ä¸‹è½½å¹¶åç¼–è¯‘æ’ä»¶</li><li>åˆ†æç­¾åç®—æ³•</li></ol><h2 id=æ–¹æ³•-4-æœåŠ¡å™¨ç«¯é‡æ”¾-å½“å‰æ–¹æ¡ˆ><a href=#%e6%96%b9%e6%b3%95-4-%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e9%87%8d%e6%94%be-%e5%bd%93%e5%89%8d%e6%96%b9%e6%a1%88 class=header-anchor></a>æ–¹æ³• 4: æœåŠ¡å™¨ç«¯é‡æ”¾ (å½“å‰æ–¹æ¡ˆ)</h2><p>å¦‚æœç­¾ååœ¨æœ‰æ•ˆæœŸå†…ï¼Œå¯ä»¥ç›´æ¥é‡æ”¾å·²æŠ“å–çš„è¯·æ±‚:</p><ul><li>æ³¨æ„: sign/hash/t å¯èƒ½æœ‰æ—¶æ•ˆæ€§</li><li>å»ºè®®: æŠ“å–åç«‹å³é‡æ”¾æµ‹è¯•
&ldquo;&rdquo;")</li></ul><p>def generate_new_request_template():
&ldquo;&ldquo;&ldquo;ç”Ÿæˆæ–°è¯·æ±‚æ¨¡æ¿&rdquo;&rdquo;&rdquo;
print_section(&ldquo;è¯·æ±‚æ¨¡æ¿ (éœ€è¦è·å–æ–°çš„ç­¾å)&rdquo;)</p><pre><code>current_t = str(int(time.time() * 1000))

print(f&quot;&quot;&quot;
</code></pre><h1 id=ä»¥ä¸‹æ˜¯å‘é€-diy-æ¯è´´è¯·æ±‚çš„æ¨¡æ¿><a href=#%e4%bb%a5%e4%b8%8b%e6%98%af%e5%8f%91%e9%80%81-diy-%e6%9d%af%e8%b4%b4%e8%af%b7%e6%b1%82%e7%9a%84%e6%a8%a1%e6%9d%bf class=header-anchor></a>ä»¥ä¸‹æ˜¯å‘é€ DIY æ¯è´´è¯·æ±‚çš„æ¨¡æ¿</h1><h1 id=éœ€è¦æ›¿æ¢-sign-å’Œ-hash-ä¸ºä»æ’ä»¶è·å–çš„å€¼><a href=#%e9%9c%80%e8%a6%81%e6%9b%bf%e6%8d%a2-sign-%e5%92%8c-hash-%e4%b8%ba%e4%bb%8e%e6%8f%92%e4%bb%b6%e8%8e%b7%e5%8f%96%e7%9a%84%e5%80%bc class=header-anchor></a>éœ€è¦æ›¿æ¢ sign å’Œ hash ä¸ºä»æ’ä»¶è·å–çš„å€¼</h1><p>import requests</p><p>url = &ldquo;<a class=link href=https://go.heytea.com/api/service-cps/user/diy%22 target=_blank rel=noopener>https://go.heytea.com/api/service-cps/user/diy"</a></p><h1 id=è¿™äº›å‚æ•°éœ€è¦ä»æ’ä»¶è·å–><a href=#%e8%bf%99%e4%ba%9b%e5%8f%82%e6%95%b0%e9%9c%80%e8%a6%81%e4%bb%8e%e6%8f%92%e4%bb%b6%e8%8e%b7%e5%8f%96 class=header-anchor></a>è¿™äº›å‚æ•°éœ€è¦ä»æ’ä»¶è·å–</h1><p>sign = &ldquo;ä»æ’ä»¶è·å–&rdquo;
hash_param = &ldquo;ä»æ’ä»¶è·å–&rdquo;
t = &ldquo;{current_t}&rdquo; # å½“å‰æ—¶é—´æˆ³
shop_id = &ldquo;4216&rdquo;</p><p>params = {{
&ldquo;sign&rdquo;: sign,
&ldquo;t&rdquo;: t,
&ldquo;hash&rdquo;: hash_param,
&ldquo;shopId&rdquo;: shop_id
}}</p><h1 id=è¯·æ±‚å¤´-authorization-éœ€è¦æœ‰æ•ˆçš„-token><a href=#%e8%af%b7%e6%b1%82%e5%a4%b4-authorization-%e9%9c%80%e8%a6%81%e6%9c%89%e6%95%88%e7%9a%84-token class=header-anchor></a>è¯·æ±‚å¤´ (Authorization éœ€è¦æœ‰æ•ˆçš„ token)</h1><p>headers = {{
&ldquo;Authorization&rdquo;: &ldquo;Bearer YOUR_TOKEN&rdquo;,
&ldquo;X-client&rdquo;: &ldquo;weapp&rdquo;,
&ldquo;X-client-version&rdquo;: &ldquo;3.318.0.p8&rdquo;,
&ldquo;User-Agent&rdquo;: &ldquo;&mldr;&rdquo;,
}}</p><h1 id=ä¸Šä¼ æ–‡ä»¶><a href=#%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6 class=header-anchor></a>ä¸Šä¼ æ–‡ä»¶</h1><p>files = {{
&ldquo;file&rdquo;: (&ldquo;image.png&rdquo;, open(&ldquo;your_image.png&rdquo;, &ldquo;rb&rdquo;), &ldquo;image/png&rdquo;)
}}</p><p>data = {{
&ldquo;width&rdquo;: &ldquo;596&rdquo;,
&ldquo;height&rdquo;: &ldquo;832&rdquo;
}}</p><p>response = requests.post(url, params=params, headers=headers, files=files, data=data)
print(response.json())
&ldquo;&rdquo;&rdquo;)</p><p>if <strong>name</strong> == &ldquo;<strong>main</strong>&rdquo;:
print("=" * 70)
print(" å–œèŒ¶ DIY æ¯è´´ç­¾åæœºåˆ¶åˆ†æ")
print("=" * 70)</p><pre><code>analyze_plugin_signature()
analyze_known_values()
try_common_patterns()
suggest_next_steps()
generate_new_request_template()
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>## åˆ†ææ€»ç»“
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>é€šè¿‡åç¼–è¯‘ä»£ç åˆ†æï¼Œæˆ‘å‘ç°äº†ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>### ç­¾åæœºåˆ¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>DIY</span><span class=w> </span><span class=err>æ¯è´´çš„</span><span class=w> </span><span class=o>`</span><span class=n>sign</span><span class=o>`</span><span class=w> </span><span class=err>å’Œ</span><span class=w> </span><span class=o>`</span><span class=n>hash</span><span class=o>`</span><span class=w> </span><span class=err>å‚æ•°æ˜¯é€šè¿‡</span><span class=o>**</span><span class=err>åŸç”Ÿæ’ä»¶</span><span class=o>**</span><span class=err>è®¡ç®—çš„ï¼Œè€Œä¸æ˜¯åœ¨</span><span class=w> </span><span class=n>JavaScript</span><span class=w> </span><span class=err>ä¸­ï¼š</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>```</span><span class=n>javascript</span><span class=p>:</span><span class=mi>5368</span><span class=p>:</span><span class=mi>5400</span><span class=p>:</span><span class=n>wx696a42df4f2456d3</span><span class=o>/</span><span class=n>common</span><span class=p>.</span><span class=n>js</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;calculateDiySign&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=nf>function</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>var</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>this</span><span class=p>.</span><span class=n>pluginInstance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>var</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=nf>calDIYSign</span><span class=p>(</span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>fileHash</span><span class=p>:</span><span class=w> </span><span class=n>e</span><span class=w>  </span><span class=o>//</span><span class=w> </span><span class=err>è¾“å…¥æ˜¯æ–‡ä»¶çš„</span><span class=w> </span><span class=n>MD5</span><span class=w> </span><span class=n>hash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=err>è¿”å›</span><span class=p>:</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>errorCode</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=ç­¾åæµç¨‹><a href=#%e7%ad%be%e5%90%8d%e6%b5%81%e7%a8%8b class=header-anchor></a>ç­¾åæµç¨‹</h3><ol><li>ç”¨æˆ·åˆ›ä½œå®Œæˆ â†’ ç”Ÿæˆä¸´æ—¶å›¾ç‰‡</li><li>è®¡ç®—å›¾ç‰‡ MD5 â†’ <code>fileHash</code> (å³æ–‡ä»¶åä¸­çš„ <code>32e6dbcc...</code>)</li><li>è°ƒç”¨åŸç”Ÿæ’ä»¶ <code>calDIYSign({ fileHash })</code></li><li>æ’ä»¶è¿”å› <code>sign</code> å’Œ <code>hash</code> å‚æ•°</li><li>æ„é€ è¯·æ±‚ä¸Šä¼ å›¾ç‰‡</li></ol><h3 id=ä¸ºä»€ä¹ˆæ— æ³•é€šè¿‡ç®€å•ç»„åˆå¤ç°ç­¾å><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%97%a0%e6%b3%95%e9%80%9a%e8%bf%87%e7%ae%80%e5%8d%95%e7%bb%84%e5%90%88%e5%a4%8d%e7%8e%b0%e7%ad%be%e5%90%8d class=header-anchor></a>ä¸ºä»€ä¹ˆæ— æ³•é€šè¿‡ç®€å•ç»„åˆå¤ç°ç­¾å</h3><ul><li>ç­¾åç®—æ³•åœ¨<strong>åŸç”Ÿæ’ä»¶</strong>ä¸­å®ç°ï¼Œä¸åœ¨ JavaScript ä»£ç é‡Œ</li><li>å¸¸è§çš„ MD5/HMAC-MD5 ç»„åˆéƒ½æ— æ³•åŒ¹é…</li><li><code>hash</code> å‚æ•°å¯èƒ½æ˜¯ <strong>AES åŠ å¯†</strong>æ•°æ®ï¼ˆ80å­—èŠ‚ = 5ä¸ª AES å—ï¼‰</li></ul><h3 id=å»ºè®®çš„ä¸‹ä¸€æ­¥><a href=#%e5%bb%ba%e8%ae%ae%e7%9a%84%e4%b8%8b%e4%b8%80%e6%ad%a5 class=header-anchor></a>å»ºè®®çš„ä¸‹ä¸€æ­¥</h3><ol><li><strong>æŠ“å–å¤šä¸ªæ ·æœ¬</strong> - ç”¨ä¸åŒå›¾ç‰‡å¤šæ¬¡æŠ“åŒ…ï¼Œåˆ†æè§„å¾‹</li><li><strong>Hook åŸç”Ÿæ’ä»¶</strong> - ä½¿ç”¨ Frida æ‹¦æˆª <code>calDIYSign</code> è°ƒç”¨</li><li><strong>é‡æ”¾æµ‹è¯•</strong> - ç›´æ¥ä½¿ç”¨å·²æŠ“å–çš„ç­¾åæµ‹è¯•æ—¶æ•ˆæ€§</li></ol><p>éœ€è¦æˆ‘å¸®ä½ è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œå—ï¼Ÿæ¯”å¦‚æœç´¢æ’ä»¶çš„ AppID æˆ–å‡†å¤‡ Frida Hook è„šæœ¬ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>key: &#34;calculateDiySign&#34;,
</span></span><span class=line><span class=cl>value: function(e) {
</span></span><span class=line><span class=cl>    var t = this.pluginInstance;
</span></span><span class=line><span class=cl>    var n = t.calDIYSign({
</span></span><span class=line><span class=cl>        fileHash: e  // è¾“å…¥æ˜¯æ–‡ä»¶çš„ MD5 hash
</span></span><span class=line><span class=cl>    });
</span></span><span class=line><span class=cl>    // è¿”å›: { errorCode, message, data }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>User</strong></p><p>â€œåŸç”Ÿæ’ä»¶â€œæ˜¯ä»€ä¹ˆï¼Ÿè¯·å°è¯•è¿™ä»½æ’ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚</p><hr><p><strong>Cursor</strong></p><p>è®©æˆ‘æœç´¢è¿™ä¸ªæ’ä»¶çš„æ›´å¤šä¿¡æ¯ï¼š</p><p>å‘ç°äº†å…³é”®æ’ä»¶ IDï¼è®©æˆ‘æ·±å…¥æœç´¢ï¼š</p><p>è®©æˆ‘æœç´¢æ›´å¤šå…³äºè¿™ä¸ªæ’ä»¶çš„ä¿¡æ¯ï¼š</p><p>ç°åœ¨æˆ‘æ¥ä¸ºä½ å®Œæ•´è§£é‡Šï¼š</p><h2 id=ä»€ä¹ˆæ˜¯åŸç”Ÿæ’ä»¶><a href=#%e4%bb%80%e4%b9%88%e6%98%af%e5%8e%9f%e7%94%9f%e6%8f%92%e4%bb%b6 class=header-anchor></a>ä»€ä¹ˆæ˜¯"åŸç”Ÿæ’ä»¶"</h2><p><strong>å¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ’ä»¶</strong>æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŠŸèƒ½æ¨¡å—ï¼Œä¸æ™®é€š JavaScript æ’ä»¶ä¸åŒï¼Œå®ƒåŒ…å«äº†<strong>åŸç”Ÿä»£ç </strong>ï¼ˆiOS çš„ Objective-C/Swift æˆ– Android çš„ Java/Kotlinï¼‰ï¼Œå¯ä»¥ï¼š</p><ul><li>è®¿é—®è®¾å¤‡åº•å±‚åŠŸèƒ½ï¼ˆå¦‚è®¾å¤‡IDã€æ¨é€æœåŠ¡ï¼‰</li><li>æ‰§è¡Œæ€§èƒ½æ•æ„Ÿçš„è®¡ç®—ï¼ˆå¦‚åŠ å¯†ç®—æ³•ï¼‰</li><li>è°ƒç”¨ç³»ç»Ÿ API</li></ul><p><strong>å…³é”®åŒºåˆ«ï¼š</strong></p><ul><li><strong>æ™®é€šæ’ä»¶</strong>: çº¯ JavaScript ä»£ç ï¼Œå¯ä»¥åœ¨åç¼–è¯‘åçœ‹åˆ°å…¨éƒ¨é€»è¾‘</li><li><strong>åŸç”Ÿæ’ä»¶</strong>: æ ¸å¿ƒä»£ç åœ¨åŸç”Ÿå±‚ï¼ŒJavaScript åªæ˜¯æ¥å£åŒ…è£…ï¼Œ<strong>æ— æ³•é€šè¿‡åç¼–è¯‘å°ç¨‹åºè·å–ç®—æ³•</strong></li></ul><hr><h2 id=å–œèŒ¶ä½¿ç”¨çš„å…³é”®æ’ä»¶><a href=#%e5%96%9c%e8%8c%b6%e4%bd%bf%e7%94%a8%e7%9a%84%e5%85%b3%e9%94%ae%e6%8f%92%e4%bb%b6 class=header-anchor></a>å–œèŒ¶ä½¿ç”¨çš„å…³é”®æ’ä»¶</h2><p>æ ¹æ®åç¼–è¯‘ä»£ç ï¼Œå–œèŒ¶ä½¿ç”¨äº†æ’ä»¶ <strong><code>wx1a13d6849c0100f0</code></strong>ï¼Œè¿™ä¸ªæ’ä»¶æä¾›ï¼š</p><div class=table-wrapper><table><thead><tr><th>åŠŸèƒ½</th><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>DIYç­¾å</td><td><code>calDIYSign({ fileHash })</code></td><td><strong>è®¡ç®— sign å’Œ hash å‚æ•°</strong></td></tr><tr><td>å´©æºƒæŠ¥å‘Š</td><td><code>initBugly()</code>, <code>setBuglyUser()</code></td><td>Bugly é”™è¯¯ç›‘æ§</td></tr><tr><td>æ¨é€æœåŠ¡</td><td><code>registerRemoteNotifications()</code></td><td>iOS æ¨é€</td></tr><tr><td>è®¾å¤‡ID</td><td><code>getAndroidId()</code>, <code>getIdentifierForVendor()</code></td><td>è·å–è®¾å¤‡æ ‡è¯†</td></tr><tr><td>SDå¡æƒé™</td><td><code>checkSDCardPermission()</code></td><td>Android å­˜å‚¨æƒé™</td></tr></tbody></table></div><hr><h2 id=ç­¾åè®¡ç®—æµç¨‹><a href=#%e7%ad%be%e5%90%8d%e8%ae%a1%e7%ae%97%e6%b5%81%e7%a8%8b class=header-anchor></a>ç­¾åè®¡ç®—æµç¨‹</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>JavaScript å±‚                    åŸç”Ÿå±‚ (æ— æ³•çœ‹åˆ°)
</span></span><span class=line><span class=cl>     â”‚                                â”‚
</span></span><span class=line><span class=cl>     â”‚  calDIYSign({ fileHash })      â”‚
</span></span><span class=line><span class=cl>     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 1. æ¥æ”¶æ–‡ä»¶ MD5
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 2. è·å–æ—¶é—´æˆ³
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 3. ä½¿ç”¨å†…ç½®å¯†é’¥åŠ å¯†
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 4. ç”Ÿæˆ sign + hash
</span></span><span class=line><span class=cl>     â”‚   { sign, hash, t }            â”‚
</span></span><span class=line><span class=cl>     â”‚ &lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
</span></span><span class=line><span class=cl>     â”‚                                â”‚
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=ç»“è®º><a href=#%e7%bb%93%e8%ae%ba class=header-anchor></a>ç»“è®º</h2><p><strong>ç­¾åç®—æ³• (<code>sign</code>, <code>hash</code>) åœ¨åŸç”Ÿæ’ä»¶ä¸­å®ç°ï¼Œæ— æ³•é€šè¿‡åç¼–è¯‘ JavaScript è·å–ã€‚</strong></p><h3 id=å¯è¡Œçš„ç ´è§£æ–¹æ³•><a href=#%e5%8f%af%e8%a1%8c%e7%9a%84%e7%a0%b4%e8%a7%a3%e6%96%b9%e6%b3%95 class=header-anchor></a>å¯è¡Œçš„ç ´è§£æ–¹æ³•ï¼š</h3><ol><li><strong>Frida Hook</strong> - åœ¨è¿è¡Œæ—¶æ‹¦æˆª <code>calDIYSign</code> çš„è¾“å…¥è¾“å‡º</li><li><strong>é€†å‘åŸç”Ÿæ’ä»¶</strong> - éœ€è¦è·å–æ’ä»¶çš„ <code>.so</code> (Android) æˆ– Framework (iOS) æ–‡ä»¶</li><li><strong>å¤šæ ·æœ¬åˆ†æ</strong> - æ”¶é›†å¤šç»„ <code>fileHash â†’ sign, hash</code> æ˜ å°„ï¼Œå°è¯•é€†æ¨ç®—æ³•</li><li><strong>ç›´æ¥é‡æ”¾</strong> - å¦‚æœç­¾åæ²¡æœ‰æ—¶æ•ˆæ€§ï¼Œå¯ç›´æ¥ä½¿ç”¨å·²æŠ“å–çš„ç­¾å</li></ol><p>éœ€è¦æˆ‘å¸®ä½ å‡†å¤‡ Frida Hook è„šæœ¬å—ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>JavaScript å±‚                    åŸç”Ÿå±‚ (æ— æ³•çœ‹åˆ°)
</span></span><span class=line><span class=cl>     â”‚                                â”‚
</span></span><span class=line><span class=cl>     â”‚  calDIYSign({ fileHash })      â”‚
</span></span><span class=line><span class=cl>     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 1. æ¥æ”¶æ–‡ä»¶ MD5
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 2. è·å–æ—¶é—´æˆ³
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 3. ä½¿ç”¨å†…ç½®å¯†é’¥åŠ å¯†
</span></span><span class=line><span class=cl>     â”‚                                â”‚ 4. ç”Ÿæˆ sign + hash
</span></span><span class=line><span class=cl>     â”‚   { sign, hash, t }            â”‚
</span></span><span class=line><span class=cl>     â”‚ &lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
</span></span><span class=line><span class=cl>     â”‚                                â”‚
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>User</strong></p><p>æˆ‘ä¸ç†Ÿæ‚‰å®‰å“ï¼Œè¯·ä¸ºæˆ‘è§£é‡ŠFrida Hookã€‚</p><hr><p><strong>Cursor</strong></p><h2 id=frida-hook-ç®€ä»‹><a href=#frida-hook-%e7%ae%80%e4%bb%8b class=header-anchor></a>Frida Hook ç®€ä»‹</h2><h3 id=ä»€ä¹ˆæ˜¯-frida><a href=#%e4%bb%80%e4%b9%88%e6%98%af-frida class=header-anchor></a>ä»€ä¹ˆæ˜¯ Fridaï¼Ÿ</h3><p><strong>Frida</strong> æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç æ’æ¡©å·¥å…·ï¼Œå¯ä»¥è®©ä½ åœ¨ç¨‹åºè¿è¡Œæ—¶"æ‹¦æˆª"å’Œ"ä¿®æ”¹"å‡½æ•°è°ƒç”¨ã€‚</p><p>ç”¨ä¸€ä¸ªæ¯”å–»æ¥è¯´æ˜ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>æƒ³è±¡ä½ åœ¨ç›‘å¬ä¸€ä¸ªç”µè¯é€šè¯ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ­£å¸¸æƒ…å†µ:
</span></span><span class=line><span class=cl>  å°ç¨‹åº â”€â”€è°ƒç”¨â”€â”€&gt; calDIYSign(fileHash) â”€â”€è¿”å›â”€â”€&gt; { sign, hash }
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>ä½¿ç”¨ Frida:
</span></span><span class=line><span class=cl>  å°ç¨‹åº â”€â”€è°ƒç”¨â”€â”€&gt; [Frida æ‹¦æˆª] â”€â”€&gt; calDIYSign(fileHash) â”€â”€è¿”å›â”€â”€&gt; [Frida è®°å½•] â”€â”€&gt; { sign, hash }
</span></span><span class=line><span class=cl>                      â”‚                                              â”‚
</span></span><span class=line><span class=cl>                      â”‚ æ‰“å°: è¾“å…¥å‚æ•°æ˜¯ &#34;32e6dbcc...&#34;                â”‚ æ‰“å°: è¿”å›å€¼æ˜¯ { sign: &#34;805f...&#34;, hash: &#34;fc8a...&#34; }
</span></span><span class=line><span class=cl>                      v                                              v
</span></span></code></pre></td></tr></table></div></div><h3 id=å®ƒèƒ½åšä»€ä¹ˆ><a href=#%e5%ae%83%e8%83%bd%e5%81%9a%e4%bb%80%e4%b9%88 class=header-anchor></a>å®ƒèƒ½åšä»€ä¹ˆï¼Ÿ</h3><ol><li><strong>æŸ¥çœ‹å‚æ•°</strong> - çœ‹åˆ°å‡½æ•°è¢«è°ƒç”¨æ—¶ä¼ å…¥äº†ä»€ä¹ˆ</li><li><strong>æŸ¥çœ‹è¿”å›å€¼</strong> - çœ‹åˆ°å‡½æ•°è¿”å›äº†ä»€ä¹ˆ</li><li><strong>ä¿®æ”¹è¡Œä¸º</strong> - æ”¹å˜å‡½æ•°çš„è¾“å…¥æˆ–è¾“å‡º</li><li><strong>è¿½è¸ªè°ƒç”¨</strong> - çŸ¥é“è°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°</li></ol><hr><h2 id=å¯¹äºå–œèŒ¶ç­¾åçš„åº”ç”¨><a href=#%e5%af%b9%e4%ba%8e%e5%96%9c%e8%8c%b6%e7%ad%be%e5%90%8d%e7%9a%84%e5%ba%94%e7%94%a8 class=header-anchor></a>å¯¹äºå–œèŒ¶ç­¾åçš„åº”ç”¨</h2><p>ä½¿ç”¨ Fridaï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚                    å¾®ä¿¡ App è¿è¡Œä¸­                        â”‚
</span></span><span class=line><span class=cl>â”‚                                                         â”‚
</span></span><span class=line><span class=cl>â”‚  å–œèŒ¶å°ç¨‹åº                                              â”‚
</span></span><span class=line><span class=cl>â”‚     â”‚                                                   â”‚
</span></span><span class=line><span class=cl>â”‚     â”‚ è°ƒç”¨ calDIYSign({ fileHash: &#34;32e6dbcc...&#34; })      â”‚
</span></span><span class=line><span class=cl>â”‚     â”‚                                                   â”‚
</span></span><span class=line><span class=cl>â”‚     v                                                   â”‚
</span></span><span class=line><span class=cl>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  åŸç”Ÿæ’ä»¶ wx1a13d6849c0100f0          â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚                                      â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  [Frida åœ¨è¿™é‡Œæ‹¦æˆª]                   â”‚â—„â”€â”€â”€ æˆ‘ä»¬æ’å…¥çš„ä»£ç 
</span></span><span class=line><span class=cl>â”‚  â”‚     â†“                                â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  è¾“å…¥: fileHash = &#34;32e6dbcc...&#34;       â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  è¾“å‡º: sign = &#34;805f30f5...&#34;          â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚        hash = &#34;fc8aad81...&#34;          â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚        t = &#34;1764833231217&#34;           â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚                                      â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=ä½¿ç”¨-frida-çš„å‰ææ¡ä»¶><a href=#%e4%bd%bf%e7%94%a8-frida-%e7%9a%84%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6 class=header-anchor></a>ä½¿ç”¨ Frida çš„å‰ææ¡ä»¶</h2><div class=table-wrapper><table><thead><tr><th>æ¡ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Root æ‰‹æœº</strong> æˆ– <strong>æ¨¡æ‹Ÿå™¨</strong></td><td>Frida éœ€è¦é«˜æƒé™æ‰èƒ½æ³¨å…¥è¿›ç¨‹</td></tr><tr><td><strong>å®‰è£… Frida Server</strong></td><td>åœ¨æ‰‹æœºä¸Šè¿è¡Œçš„æœåŠ¡ç«¯</td></tr><tr><td><strong>å®‰è£… Frida å®¢æˆ·ç«¯</strong></td><td>åœ¨ç”µè„‘ä¸Šç”¨ Python æ§åˆ¶</td></tr><tr><td><strong>ç›®æ ‡ App</strong></td><td>å¾®ä¿¡ + å–œèŒ¶å°ç¨‹åº</td></tr></tbody></table></div><hr><h2 id=ç®€åŒ–çš„æ“ä½œæµç¨‹><a href=#%e7%ae%80%e5%8c%96%e7%9a%84%e6%93%8d%e4%bd%9c%e6%b5%81%e7%a8%8b class=header-anchor></a>ç®€åŒ–çš„æ“ä½œæµç¨‹</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. ç”µè„‘ä¸Šå®‰è£… Frida</span>
</span></span><span class=line><span class=cl>pip install frida frida-tools
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. æ‰‹æœºä¸Šè¿è¡Œ Frida Server (éœ€è¦ root)</span>
</span></span><span class=line><span class=cl>adb push frida-server /data/local/tmp/
</span></span><span class=line><span class=cl>adb shell <span class=s2>&#34;chmod 755 /data/local/tmp/frida-server&#34;</span>
</span></span><span class=line><span class=cl>adb shell <span class=s2>&#34;/data/local/tmp/frida-server &amp;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. è¿è¡Œ Hook è„šæœ¬</span>
</span></span><span class=line><span class=cl>frida -U -f com.tencent.mm -l hook_heytea.js
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=ç¤ºä¾‹-hook-è„šæœ¬><a href=#%e7%a4%ba%e4%be%8b-hook-%e8%84%9a%e6%9c%ac class=header-anchor></a>ç¤ºä¾‹ Hook è„šæœ¬</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// hook_heytea.js - æ‹¦æˆª calDIYSign å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>Java</span><span class=p>.</span><span class=nx>perform</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] Frida å·²æ³¨å…¥å¾®ä¿¡è¿›ç¨‹&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// æ‰¾åˆ°å¹¶ Hook ç›®æ ‡å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// æ³¨æ„ï¼šå…·ä½“ç±»åéœ€è¦æ ¹æ®å®é™…é€†å‘åˆ†æç¡®å®š
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>targetClass</span> <span class=o>=</span> <span class=nx>Java</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s2>&#34;com.heytea.plugin.DIYSign&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>targetClass</span><span class=p>.</span><span class=nx>calDIYSign</span><span class=p>.</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ‰“å°è¾“å…¥å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] calDIYSign è¢«è°ƒç”¨!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] è¾“å…¥ fileHash: &#34;</span> <span class=o>+</span> <span class=nx>params</span><span class=p>.</span><span class=nx>fileHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// è°ƒç”¨åŸå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>calDIYSign</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// æ‰“å°è¿”å›ç»“æœ
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] è¿”å›ç»“æœ: &#34;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>result</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=æ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆ><a href=#%e6%9b%b4%e7%ae%80%e5%8d%95%e7%9a%84%e6%9b%bf%e4%bb%a3%e6%96%b9%e6%a1%88 class=header-anchor></a>æ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆ</h2><p>å¦‚æœä½ ä¸æƒ³æŠ˜è…¾ Fridaï¼Œè¿˜æœ‰å‡ ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼š</p><h3 id=æ–¹æ³•-1-å¤šæ¬¡æŠ“åŒ…å¯¹æ¯”><a href=#%e6%96%b9%e6%b3%95-1-%e5%a4%9a%e6%ac%a1%e6%8a%93%e5%8c%85%e5%af%b9%e6%af%94 class=header-anchor></a>æ–¹æ³• 1: å¤šæ¬¡æŠ“åŒ…å¯¹æ¯”</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ç¬¬1æ¬¡: fileHash=aaa â†’ sign=xxx, hash=yyy, t=111
</span></span><span class=line><span class=cl>ç¬¬2æ¬¡: fileHash=bbb â†’ sign=xxx2, hash=yyy2, t=222
</span></span><span class=line><span class=cl>ç¬¬3æ¬¡: fileHash=ccc â†’ sign=xxx3, hash=yyy3, t=333
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>åˆ†æè§„å¾‹
</span></span></code></pre></td></tr></table></div></div><h3 id=æ–¹æ³•-2-ç›´æ¥é‡æ”¾å·²æŠ“å–çš„è¯·æ±‚><a href=#%e6%96%b9%e6%b3%95-2-%e7%9b%b4%e6%8e%a5%e9%87%8d%e6%94%be%e5%b7%b2%e6%8a%93%e5%8f%96%e7%9a%84%e8%af%b7%e6%b1%82 class=header-anchor></a>æ–¹æ³• 2: ç›´æ¥é‡æ”¾å·²æŠ“å–çš„è¯·æ±‚</h3><p>å¦‚æœ <code>sign</code> å’Œ <code>hash</code> æ²¡æœ‰æ—¶æ•ˆæ€§ï¼Œå¯ä»¥ç›´æ¥ç”¨ä½ å·²ç»æŠ“åˆ°çš„å‚æ•°é‡å¤è¯·æ±‚ã€‚</p><h3 id=æ–¹æ³•-3-ä½¿ç”¨-http-è°ƒè¯•å·¥å…·><a href=#%e6%96%b9%e6%b3%95-3-%e4%bd%bf%e7%94%a8-http-%e8%b0%83%e8%af%95%e5%b7%a5%e5%85%b7 class=header-anchor></a>æ–¹æ³• 3: ä½¿ç”¨ HTTP è°ƒè¯•å·¥å…·</h3><p>ç”¨ Charles/mitmproxy æŒç»­æŠ“åŒ…ï¼Œæ¯æ¬¡ä¸Šä¼ å›¾ç‰‡æ—¶è®°å½•å‚æ•°ã€‚</p><hr><h2 id=å»ºè®®><a href=#%e5%bb%ba%e8%ae%ae class=header-anchor></a>å»ºè®®</h2><p>é‰´äºä½ ä¸ç†Ÿæ‚‰å®‰å“å¼€å‘ï¼Œæˆ‘å»ºè®®ï¼š</p><ol><li><strong>å…ˆæµ‹è¯•é‡æ”¾</strong> - ç”¨å·²æŠ“å–çš„ç­¾åç›´æ¥å‘è¯·æ±‚ï¼Œçœ‹æ˜¯å¦æœ‰æ—¶æ•ˆæ€§</li><li><strong>å¦‚æœæœ‰æ—¶æ•ˆæ€§</strong> - è€ƒè™‘å¤šæ¬¡æŠ“åŒ…åˆ†æè§„å¾‹</li><li><strong>å¦‚æœéœ€è¦ Frida</strong> - æˆ‘å¯ä»¥å¸®ä½ å†™å®Œæ•´çš„è„šæœ¬ï¼Œä½†éœ€è¦ä½ å‡†å¤‡å¥½ Root æ‰‹æœºæˆ–æ¨¡æ‹Ÿå™¨</li></ol><p>è¦æˆ‘å…ˆå¸®ä½ æµ‹è¯•ä¸€ä¸‹å·²æœ‰ç­¾åçš„é‡æ”¾è¯·æ±‚å—ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>æƒ³è±¡ä½ åœ¨ç›‘å¬ä¸€ä¸ªç”µè¯é€šè¯ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ­£å¸¸æƒ…å†µ:
</span></span><span class=line><span class=cl>  å°ç¨‹åº â”€â”€è°ƒç”¨â”€â”€&gt; calDIYSign(fileHash) â”€â”€è¿”å›â”€â”€&gt; { sign, hash }
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>ä½¿ç”¨ Frida:
</span></span><span class=line><span class=cl>  å°ç¨‹åº â”€â”€è°ƒç”¨â”€â”€&gt; [Frida æ‹¦æˆª] â”€â”€&gt; calDIYSign(fileHash) â”€â”€è¿”å›â”€â”€&gt; [Frida è®°å½•] â”€â”€&gt; { sign, hash }
</span></span><span class=line><span class=cl>                      â”‚                                              â”‚
</span></span><span class=line><span class=cl>                      â”‚ æ‰“å°: è¾“å…¥å‚æ•°æ˜¯ &#34;32e6dbcc...&#34;                â”‚ æ‰“å°: è¿”å›å€¼æ˜¯ { sign: &#34;805f...&#34;, hash: &#34;fc8a...&#34; }
</span></span><span class=line><span class=cl>                      v                                              v
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>â”‚                    å¾®ä¿¡ App è¿è¡Œä¸­                        â”‚
</span></span><span class=line><span class=cl>â”‚                                                         â”‚
</span></span><span class=line><span class=cl>â”‚  å–œèŒ¶å°ç¨‹åº                                              â”‚
</span></span><span class=line><span class=cl>â”‚     â”‚                                                   â”‚
</span></span><span class=line><span class=cl>â”‚     â”‚ è°ƒç”¨ calDIYSign({ fileHash: &#34;32e6dbcc...&#34; })      â”‚
</span></span><span class=line><span class=cl>â”‚     â”‚                                                   â”‚
</span></span><span class=line><span class=cl>â”‚     v                                                   â”‚
</span></span><span class=line><span class=cl>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  åŸç”Ÿæ’ä»¶ wx1a13d6849c0100f0          â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚                                      â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  [Frida åœ¨è¿™é‡Œæ‹¦æˆª]                   â”‚â—„â”€â”€â”€ æˆ‘ä»¬æ’å…¥çš„ä»£ç 
</span></span><span class=line><span class=cl>â”‚  â”‚     â†“                                â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  è¾“å…¥: fileHash = &#34;32e6dbcc...&#34;       â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚  è¾“å‡º: sign = &#34;805f30f5...&#34;          â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚        hash = &#34;fc8aad81...&#34;          â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚        t = &#34;1764833231217&#34;           â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â”‚                                      â”‚              â”‚
</span></span><span class=line><span class=cl>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
</span></span><span class=line><span class=cl>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># 1. ç”µè„‘ä¸Šå®‰è£… Frida</span>
</span></span><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>frida</span> <span class=n>frida</span><span class=o>-</span><span class=n>tools</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. æ‰‹æœºä¸Šè¿è¡Œ Frida Server (éœ€è¦ root)</span>
</span></span><span class=line><span class=cl><span class=n>adb</span> <span class=n>push</span> <span class=n>frida</span><span class=o>-</span><span class=n>server</span> <span class=o>/</span><span class=n>data</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>tmp</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=n>adb</span> <span class=n>shell</span> <span class=s2>&#34;chmod 755 /data/local/tmp/frida-server&#34;</span>
</span></span><span class=line><span class=cl><span class=n>adb</span> <span class=n>shell</span> <span class=s2>&#34;/data/local/tmp/frida-server &amp;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. è¿è¡Œ Hook è„šæœ¬</span>
</span></span><span class=line><span class=cl><span class=n>frida</span> <span class=o>-</span><span class=n>U</span> <span class=o>-</span><span class=n>f</span> <span class=n>com</span><span class=o>.</span><span class=n>tencent</span><span class=o>.</span><span class=n>mm</span> <span class=o>-</span><span class=n>l</span> <span class=n>hook_heytea</span><span class=o>.</span><span class=n>js</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// hook_heytea.js - æ‹¦æˆª calDIYSign å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>Java</span><span class=p>.</span><span class=nx>perform</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] Frida å·²æ³¨å…¥å¾®ä¿¡è¿›ç¨‹&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// æ‰¾åˆ°å¹¶ Hook ç›®æ ‡å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// æ³¨æ„ï¼šå…·ä½“ç±»åéœ€è¦æ ¹æ®å®é™…é€†å‘åˆ†æç¡®å®š
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>targetClass</span> <span class=o>=</span> <span class=nx>Java</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s2>&#34;com.heytea.plugin.DIYSign&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>targetClass</span><span class=p>.</span><span class=nx>calDIYSign</span><span class=p>.</span><span class=nx>implementation</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ‰“å°è¾“å…¥å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] calDIYSign è¢«è°ƒç”¨!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] è¾“å…¥ fileHash: &#34;</span> <span class=o>+</span> <span class=nx>params</span><span class=p>.</span><span class=nx>fileHash</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// è°ƒç”¨åŸå‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>calDIYSign</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// æ‰“å°è¿”å›ç»“æœ
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;[*] è¿”å›ç»“æœ: &#34;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>result</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>ç¬¬1æ¬¡: fileHash=aaa â†’ sign=xxx, hash=yyy, t=111
</span></span><span class=line><span class=cl>ç¬¬2æ¬¡: fileHash=bbb â†’ sign=xxx2, hash=yyy2, t=222
</span></span><span class=line><span class=cl>ç¬¬3æ¬¡: fileHash=ccc â†’ sign=xxx3, hash=yyy3, t=333
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>åˆ†æè§„å¾‹
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>User</strong></p><p>æˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸€å°IDAï¼Œè¯·æµ‹è¯•MCPå®ç°æ˜¯å¦æ­£å¸¸ã€‚</p><hr><p><strong>Cursor</strong></p><p>å¥½çš„ï¼Œè®©æˆ‘æµ‹è¯• IDA MCP è¿æ¥ï¼š</p><p>IDA MCP è¿æ¥æ­£å¸¸ï¼å½“å‰åŠ è½½çš„æ˜¯ <strong><code>libcrypto.so</code></strong> æ–‡ä»¶ã€‚è®©æˆ‘è·å–æ›´å¤šä¿¡æ¯ï¼š</p><p>æˆ‘æ¥æµ‹è¯•ä¸€ä¸‹ä¸ IDA Pro çš„ MCP è¿æ¥æ˜¯å¦æ­£å¸¸ã€‚è®©æˆ‘è·å–ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼š</p><hr><p><strong>User</strong></p><p>è¯·ä½¿ç”¨IDAï¼Œç»“åˆæˆ‘ä»å–œèŒ¶å°ç¨‹åºAPPç‰ˆapkä¸­æ‹†å‡ºæ¥çš„ç›¸å…³ä»£ç ï¼ˆä¸¤ä¸ª.soæ–‡ä»¶ï¼‰ï¼Œå†æ¬¡å°è¯•åˆ†æhashå‚æ•°çš„ç”Ÿæˆé€»è¾‘ã€‚</p><hr><p><strong>Cursor</strong></p><p>å¥½çš„ï¼Œè®©æˆ‘å…ˆæŸ¥çœ‹ä¸€ä¸‹å·¥ä½œç›®å½•ä¸­æœ‰å“ªäº› <code>.so</code> æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ IDA è¿›è¡Œåˆ†æã€‚</p><p>æ‰¾åˆ°äº†ä¸‰ä¸ª <code>.so</code> æ–‡ä»¶ï¼š</p><ul><li><code>libcanvas.so</code> - å¯èƒ½ä¸ç”»å¸ƒ/å›¾ç‰‡å¤„ç†ç›¸å…³</li><li><code>libheyteago.so</code> - å–œèŒ¶è‡ªæœ‰çš„æ ¸å¿ƒåº“ï¼Œå¾ˆå¯èƒ½åŒ…å«ç­¾åé€»è¾‘</li><li><code>libcrypto.so</code> - é€šç”¨åŠ å¯†åº“</li></ul><p>ä½†æ˜¯ IDA Pro çš„ MCP æœåŠ¡å™¨è¿˜æ²¡æœ‰å¯åŠ¨ã€‚è¯·åœ¨ IDA Pro ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥å¯åŠ¨ MCP æœåŠ¡å™¨ï¼š</p><ol><li>æ‰“å¼€ IDA Pro</li><li>åŠ è½½ <code>libheyteago.so</code> æ–‡ä»¶ï¼ˆè¿™ä¸ªæœ€å¯èƒ½åŒ…å«ç­¾åé€»è¾‘ï¼‰</li><li>ç‚¹å‡»èœå• <strong>Edit â†’ Plugins â†’ MCP</strong> (æˆ–æŒ‰ <code>Ctrl+Alt+M</code>)</li></ol><p>å¯åŠ¨åè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘å°†ç»§ç»­åˆ†æã€‚</p><p>åŒæ—¶ï¼Œ<code>libheyteago.so</code> è¿™ä¸ªåå­—å¾ˆæœ‰æ„æ€ - &ldquo;heyteago&rdquo; æš—ç¤ºè¿™æ˜¯å–œèŒ¶ä¸“ç”¨çš„ Go è¯­è¨€ç¼–è¯‘çš„åº“ï¼Œå¾ˆå¯èƒ½åŒ…å« <code>calDIYSign</code> çš„æ ¸å¿ƒå®ç°ã€‚</p><hr><p><strong>User</strong></p><p>æŠ±æ­‰ã€‚ç°åœ¨è¯·å†å°è¯•ä¸€ä¸‹ã€‚</p><hr><p><strong>Cursor</strong></p><p>IDA è¿æ¥æˆåŠŸï¼å½“å‰åŠ è½½çš„æ˜¯ <code>libcrypto.so</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„ OpenSSL åŠ å¯†åº“ã€‚</p><p>ä¸è¿‡ï¼Œç­¾åé€»è¾‘æ›´å¯èƒ½åœ¨ <code>libheyteago.so</code>ï¼ˆå–œèŒ¶è‡ªæœ‰åº“ï¼‰ä¸­ã€‚è®©æˆ‘å…ˆå¿«é€ŸæŸ¥çœ‹ä¸€ä¸‹å½“å‰åº“çš„å…³é”®å‡½æ•°ï¼Œç„¶åå»ºè®®åˆ†æ <code>libheyteago.so</code>ï¼š</p><p>æ­£å¦‚é¢„æœŸï¼Œ<code>libcrypto.so</code> æ˜¯æ ‡å‡†çš„ OpenSSL åº“ï¼Œæ²¡æœ‰å–œèŒ¶ç‰¹å®šçš„ç­¾åé€»è¾‘ã€‚</p><p><strong>è¯·åœ¨ IDA Pro ä¸­åŠ è½½ <code>libheyteago.so</code> æ–‡ä»¶</strong>ï¼Œè¿™ä¸ªæ–‡ä»¶æ›´å¯èƒ½åŒ…å« <code>calDIYSign</code> çš„æ ¸å¿ƒå®ç°ã€‚åŠ è½½å®Œæˆåè¯·å‘Šè¯‰æˆ‘ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œè®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåº“æœ‰å“ªäº›å¸¸ç”¨çš„åŠ å¯†å‡½æ•°å¯èƒ½è¢«è°ƒç”¨ï¼š</p><p><code>libcrypto.so</code> æä¾›äº†å®Œæ•´çš„åŠ å¯†èƒ½åŠ›ï¼š</p><ul><li><strong>MD5</strong>: <code>MD5</code>, <code>MD5_Init</code>, <code>MD5_Update</code>, <code>MD5_Final</code></li><li><strong>SHA</strong>: <code>EVP_sha1</code>, <code>EVP_sha256</code>, <code>EVP_sha512</code></li><li><strong>AES</strong>: <code>AES_encrypt</code>, <code>AES_cbc_encrypt</code>, <code>AES_set_encrypt_key</code></li><li><strong>HMAC</strong>: <code>HMAC_Init_ex</code>, <code>HMAC_Init</code></li></ul><p>è¿™äº›æ˜¯åº•å±‚åŠ å¯†åŸè¯­ï¼Œ<code>libheyteago.so</code> ä¼šè°ƒç”¨å®ƒä»¬æ¥å®ç°ç­¾åé€»è¾‘ã€‚</p><hr><p><strong>ä¸‹ä¸€æ­¥ï¼šè¯·åœ¨ IDA Pro ä¸­åŠ è½½ <code>libheyteago.so</code></strong></p><p>è¿™ä¸ªåº“å &ldquo;heyteago&rdquo; è¡¨æ˜å®ƒæ˜¯å–œèŒ¶ç”¨ Go è¯­è¨€ç¼–å†™çš„åŸç”Ÿåº“ï¼Œå¾ˆå¯èƒ½åŒ…å«ï¼š</p><ul><li><code>calDIYSign</code> å‡½æ•°çš„å®é™…å®ç°</li><li>ç­¾åç®—æ³•çš„å…·ä½“é€»è¾‘ï¼ˆå¦‚ä½•ç»„åˆ <code>fileHash</code>ã€<code>t</code>ã€<code>shopId</code> ç­‰å‚æ•°ï¼‰</li><li>å¯èƒ½çš„åŠ å¯†å¯†é’¥</li></ul><p>åŠ è½½å®Œæˆåå‘Šè¯‰æˆ‘ï¼Œæˆ‘å°†ç«‹å³æœç´¢ç­¾åç›¸å…³å‡½æ•°ã€‚</p><hr><p><strong>User</strong></p><p>ç°åœ¨åº”è¯¥æˆåŠŸåŠ è½½libheyteago.soäº†ã€‚</p><hr><p><strong>Cursor</strong></p><p>æˆåŠŸè¿æ¥ï¼ç°åœ¨è®©æˆ‘æœç´¢æ›´å¤šå…³é”®è¯æ¥æ‰¾åˆ°ç­¾åç›¸å…³å‡½æ•°ï¼š</p><p><strong>æ‰¾åˆ°äº†å…³é”®çº¿ç´¢ï¼</strong> å­—ç¬¦ä¸² <code>calDIYSign</code> ä½äºåœ°å€ <code>0x439055</code>ï¼</p><p>è®©æˆ‘æ‰¾åˆ°å¼•ç”¨è¿™ä¸ªå­—ç¬¦ä¸²çš„ä»£ç ï¼š</p><p><strong>é‡å¤§å‘ç°ï¼</strong></p><ol><li><strong><code>HEYTEA6H7J8K9M0N</code></strong> - è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ª<strong>ç¡¬ç¼–ç çš„åŠ å¯†å¯†é’¥</strong>ï¼</li><li><strong><code>com/donut/wx1a13d6849c0100f0/jni/HeyteagoJNI</code></strong> - JNI æ¥å£ç±»è·¯å¾„</li></ol><p>è®©æˆ‘æ·±å…¥åˆ†æä½¿ç”¨è¿™ä¸ªå¯†é’¥çš„å‡½æ•°ï¼š</p><p><strong>é‡å¤§å‘ç°ï¼</strong> æ‰¾åˆ°äº†ç­¾åå‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼</p><p>å…³é”®ä¿¡æ¯ï¼š</p><ol><li><strong>ç¡¬ç¼–ç å¯†é’¥</strong>: <code>"HEYTEA6H7J8K9M0N"</code> (16å­—èŠ‚ = AES-128å¯†é’¥é•¿åº¦ï¼)</li><li><strong>æ—¶é—´æˆ³</strong>: <code>std::chrono::system_clock::now() / 1000</code> è·å–æ¯«ç§’çº§æ—¶é—´æˆ³</li><li><strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>: ä½¿ç”¨ <code>#</code> ä½œä¸ºåˆ†éš”ç¬¦</li></ol><p>è®©æˆ‘æ·±å…¥åˆ†æåŠ å¯†å‡½æ•° <code>sub_15B808</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15CDF0</span><span class=p>(</span><span class=n>ptr</span><span class=p>,</span> <span class=n>v54</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v51</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v48</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>å‘ç°æ›´å¤šå¯†é’¥ï¼</strong></p><ol><li><strong><code>HEYTEA6H7J8K9M0N</code></strong> - ä¸»åŠ å¯†å¯†é’¥ (16å­—èŠ‚ = AES-128)</li><li><strong><code>AN1wedUvOJblfD8Z</code></strong> - å¤‡ç”¨å¯†é’¥æˆ–IV (16å­—èŠ‚)</li><li><strong><code>2lJuL8jdH03oNIq5</code></strong> - å¦ä¸€ä¸ªå¤‡ç”¨å¯†é’¥ (16å­—èŠ‚)</li></ol><p>è®©æˆ‘ç»§ç»­åˆ†ææ ¸å¿ƒåŠ å¯†å‡½æ•°ï¼š</p><p>ç°åœ¨æˆ‘å·²ç»å®Œå…¨ç†è§£äº†ç­¾åç®—æ³•çš„æ ¸å¿ƒé€»è¾‘ï¼è®©æˆ‘æ€»ç»“åˆ†æç»“æœå¹¶åˆ›å»ºä¸€ä¸ªå¯ç”¨çš„ç­¾åç”Ÿæˆè„šæœ¬ï¼š</p><h2 id=-ç­¾åç®—æ³•åˆ†æç»“æœ><a href=#-%e7%ad%be%e5%90%8d%e7%ae%97%e6%b3%95%e5%88%86%e6%9e%90%e7%bb%93%e6%9e%9c class=header-anchor></a>ğŸ”‘ <strong>ç­¾åç®—æ³•åˆ†æç»“æœ</strong></h2><h3 id=å‘ç°çš„å¯†é’¥><a href=#%e5%8f%91%e7%8e%b0%e7%9a%84%e5%af%86%e9%92%a5 class=header-anchor></a>å‘ç°çš„å¯†é’¥</h3><ol><li><strong>ä¸»å¯†é’¥</strong>: <code>HEYTEA6H7J8K9M0N</code> (16å­—èŠ‚)</li><li><strong>IVé€‰é¡¹1</strong>: <code>AN1wedUvOJblfD8Z</code> (16å­—èŠ‚)</li><li><strong>IVé€‰é¡¹2</strong>: <code>2lJuL8jdH03oNIq5</code> (16å­—èŠ‚)</li></ol><h3 id=ç®—æ³•æµç¨‹><a href=#%e7%ae%97%e6%b3%95%e6%b5%81%e7%a8%8b class=header-anchor></a>ç®—æ³•æµç¨‹</h3><p>ä»åç¼–è¯‘ä»£ç åˆ†æï¼Œ<code>calDIYSign</code> å‡½æ•°çš„ç­¾åæµç¨‹æ˜¯ï¼š</p><ol><li>è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</li><li>å°†è¾“å…¥æ•°æ®ï¼ˆ<code>fileHash</code>ï¼‰ä¸æ—¶é—´æˆ³ç”¨ <code>#</code> æ‹¼æ¥</li><li>ä½¿ç”¨ <strong>AES-128-CBC</strong> åŠ å¯†</li><li>å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆæ¥è‡ªIDAé€†å‘ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N
</span></span></span><span class=line><span class=cl><span class=s2>- IV Option 1: AN1wedUvOJblfD8Z
</span></span></span><span class=line><span class=cl><span class=s2>- IV Option 2: 2lJuL8jdH03oNIq5
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTION_1</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># 16 bytes</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTION_2</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># 16 bytes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTION_1</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTION_2</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>çœ‹èµ·æ¥æˆ‘ä»¬æ‰¾åˆ°çš„å¯†é’¥å¯èƒ½ä¸å®Œå…¨æ­£ç¡®ï¼Œæˆ–è€…åŠ å¯†æµç¨‹æœ‰é¢å¤–çš„æ­¥éª¤ã€‚è®©æˆ‘åœ¨ IDA ä¸­è¿›ä¸€æ­¥åˆ†æï¼ŒæŸ¥æ‰¾æ›´å¤šç»†èŠ‚ï¼š</p><p>è®©æˆ‘è¿›ä¸€æ­¥åˆ†æå¼•ç”¨è¿™ä¸ªå¤‡ç”¨å¯†é’¥çš„å‡½æ•°ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›å¯†é’¥çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>v7</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=nf>now</span><span class=p>(</span><span class=n>v6</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000LL</span><span class=p>;</span>  <span class=c1>// æ¯«ç§’çº§æ—¶é—´æˆ³
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=nf>to_string</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v43</span><span class=p>,</span> <span class=n>v7</span><span class=p>);</span>  <span class=c1>// è½¬ä¸ºå­—ç¬¦ä¸²
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B6FC</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>a1</span><span class=p>,</span> <span class=s>&#34;#&#34;</span><span class=p>);</span>  <span class=c1>// å°† fileHash å’Œ &#34;#&#34; æ‹¼æ¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>sub_15E948</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>v8</span><span class=p>,</span> <span class=n>v9</span><span class=p>);</span>  <span class=c1>// å°†æ—¶é—´æˆ³æ‹¼æ¥ä¸Šå»
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_1599BC</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>,</span> <span class=s>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>);</span>  <span class=c1>// AES å¯†é’¥
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// æ£€æŸ¥å¯†é’¥é•¿åº¦å¿…é¡»æ˜¯ 16, 24 æˆ– 32 å­—èŠ‚
</span></span></span><span class=line><span class=cl><span class=c1>// æ£€æŸ¥ IV å¿…é¡»æ˜¯ 16 å­—èŠ‚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>EVP_CIPHER_CTX_new</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nf>EVP_aes_128_cbc</span><span class=p>();</span>  <span class=c1>// ä½¿ç”¨ AES-128-CBC
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>EVP_EncryptInit_ex</span><span class=p>(</span><span class=n>v10</span><span class=p>,</span> <span class=n>v13</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>*</span><span class=n>a2</span><span class=p>,</span> <span class=o>*</span><span class=n>a3</span><span class=p>);</span>  <span class=c1>// key å’Œ IV
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>EVP_EncryptUpdate</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl><span class=nf>EVP_EncryptFinal_ex</span><span class=p>(...);</span>
</span></span></code></pre></td></tr></table></div></div><p>å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘å®Œå…¨ç†è§£äº†ç­¾åç®—æ³•çš„æ ¸å¿ƒé€»è¾‘ã€‚è®©æˆ‘åˆ†æ <code>sign</code> å‚æ•°çš„ç”Ÿæˆé€»è¾‘ï¼š</p><p>ç°åœ¨æˆ‘æœ‰äº†å®Œæ•´çš„ç®—æ³•åˆ†æç»“æœã€‚è®©æˆ‘æ›´æ–°ç­¾åç”Ÿæˆè„šæœ¬ï¼Œå°è¯•æ‰¾åˆ°æ­£ç¡®çš„ IVï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTION_1</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTION_2</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTION_1</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTION_2</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘éœ€è¦ä¿®å¤è„šæœ¬ä¸­çš„å˜é‡å¼•ç”¨é—®é¢˜ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTION_1</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTION_2</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTION_1</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTION_2</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;IV2&#34;</span><span class=p>,</span> <span class=n>IV_OPTION_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>2</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;IV4_key&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>3</span><span class=p>])]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†æˆåŠŸ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç»“æœ: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯† (æ— æ³•unpad):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨è®©æˆ‘è¿è¡Œæ›´æ–°åçš„è„šæœ¬æ¥éªŒè¯ç®—æ³•ï¼š</p><p>è§£å¯†ç»“æœè¡¨æ˜æˆ‘ä»¬æ‰¾åˆ°çš„å¯†é’¥å¯èƒ½æ­£ç¡®ï¼ˆåç»­å—çš„è§£å¯†ç»“æœç›¸åŒï¼‰ï¼Œä½†IVå¯èƒ½ä¸å¯¹ã€‚è®©æˆ‘æ·±å…¥åˆ†æ <code>sub_15B808</code> å‡½æ•°æ¥æ‰¾åˆ°æ­£ç¡®çš„ IVï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B808</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v34</span><span class=p>,</span> <span class=n>v14</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘çœ‹åˆ°å…³é”®ä¿¡æ¯äº†ï¼<code>sub_15B808</code> è¢«è°ƒç”¨æ—¶ä¼ å…¥äº†4ä¸ªå‚æ•°ã€‚è®©æˆ‘åˆ†æ <code>sub_15BC94</code> å‡½æ•°æ¥æ‰¾åˆ° IV çš„æ¥æºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=n>v2</span> <span class=o>=</span> <span class=n>qword_535CD8</span><span class=p>;</span>  <span class=c1>// æ£€æŸ¥æŸä¸ªé•¿åº¦å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=n>byte_535CD0</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=n>v2</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int64</span><span class=p>)(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>byte_535CD0</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=k>if</span> <span class=p>(</span> <span class=n>v2</span> <span class=o>!=</span> <span class=mi>4</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=k>return</span> <span class=o>&amp;</span><span class=n>unk_535C48</span><span class=p>;</span>  <span class=c1>// è¿”å› IV1: AN1wedUvOJblfD8Z
</span></span></span><span class=line><span class=cl><span class=c1></span>   
</span></span><span class=line><span class=cl>   <span class=c1>// å¦‚æœé•¿åº¦æ˜¯4ï¼Œè¿›ä¸€æ­¥æ£€æŸ¥
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>if</span> <span class=p>(</span> <span class=o>*</span><span class=n>v3</span> <span class=o>==</span> <span class=mi>1685025392</span> <span class=p>)</span>  <span class=c1>// è¿™æ˜¯æŸä¸ªé­”æœ¯å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=k>return</span> <span class=o>&amp;</span><span class=n>unk_535C68</span><span class=p>;</span>  <span class=c1>// è¿”å› IV2: 2lJuL8jdH03oNIq5
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=k>else</span>
</span></span><span class=line><span class=cl>     <span class=k>return</span> <span class=o>&amp;</span><span class=n>unk_535C48</span><span class=p>;</span>  <span class=c1>// è¿”å› IV1: AN1wedUvOJblfD8Z
</span></span></span></code></pre></td></tr></table></div></div><p><strong>é‡å¤§å‘ç°ï¼</strong> æˆ‘æ‰¾åˆ°äº† IV é€‰æ‹©çš„é€»è¾‘ï¼</p><p>ä» <code>sub_15BC94</code> å‡½æ•°å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li><strong>IV1</strong>: <code>AN1wedUvOJblfD8Z</code> ï¼ˆé»˜è®¤ï¼‰</li><li><strong>IV2</strong>: <code>2lJuL8jdH03oNIq5</code> ï¼ˆç‰¹å®šæ¡ä»¶ä¸‹ä½¿ç”¨ï¼‰</li></ul><p>å…³é”®æ˜¯é­”æœ¯å€¼ <code>1685025392</code>ï¼ˆåå…­è¿›åˆ¶ <code>0x64706970</code> = ASCII &ldquo;dpip&rdquo;/&ldquo;pipd&rdquo;ï¼‰ã€‚è®©æˆ‘éªŒè¯è¿™ä¸ªå‘ç°å¹¶æ›´æ–°è„šæœ¬ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B6FC</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>a1</span><span class=p>,</span> <span class=s>&#34;#&#34;</span><span class=p>);</span>  <span class=c1>// æ‹¼æ¥ a1 (fileHash) å’Œ &#34;#&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>sub_15E948</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>v8</span><span class=p>,</span> <span class=n>v9</span><span class=p>);</span>  <span class=c1>// è¿½åŠ æ—¶é—´æˆ³å­—ç¬¦ä¸²
</span></span></span></code></pre></td></tr></table></div></div><p>é­”æœ¯å€¼ <code>1685025392</code> = ASCII &ldquo;prod&rdquo;ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼è¿™æ˜¯ç¯å¢ƒé€‰æ‹©é€»è¾‘ã€‚è®©æˆ‘æ›´æ–°è„šæœ¬æ¥å°è¯•æ‰€æœ‰å¯èƒ½çš„ç»„åˆï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æœŸæœ›æ˜æ–‡é•¿åº¦ (å‡å»padding): 65-80 bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;fileHash#t é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>+1+</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>])</span><span class=o>+</span><span class=mi>1</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ ¹æ®IDAåˆ†æï¼ŒIVé€‰æ‹©é€»è¾‘ï¼š</span>
</span></span><span class=line><span class=cl>        <span class=c1># - é»˜è®¤: AN1wedUvOJblfD8Z</span>
</span></span><span class=line><span class=cl>        <span class=c1># - å¦‚æœç¯å¢ƒ=&#34;prod&#34;: 2lJuL8jdH03oNIq5</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ ¹æ®IDAåˆ†æçš„IVé€‰æ‹©é€»è¾‘:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  - é»˜è®¤IV: AN1wedUvOJblfD8Z&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  - ç”Ÿäº§ç¯å¢ƒIV: 2lJuL8jdH03oNIq5 (å½“env=&#39;prod&#39;)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;é»˜è®¤IV (AN1wed)&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;ç”Ÿäº§IV (2lJuL8)&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>])]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰å¯è¯»å†…å®¹</span>
</span></span><span class=line><span class=cl>                <span class=n>printable_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>decrypted</span> <span class=k>if</span> <span class=mi>32</span> <span class=o>&lt;=</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mi>126</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>decrypted</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯æ‰“å°å­—ç¬¦æ•°: </span><span class=si>{</span><span class=n>printable_count</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>decrypted</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•æ‰¾åˆ°ç±»ä¼¼ fileHash#timestamp çš„æ¨¡å¼</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‘ç° &#39;#&#39; å­—ç¬¦ï¼å¯èƒ½æ˜¯æ­£ç¡®çš„IV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8å°è¯•: </span><span class=si>{</span><span class=n>decoded</span><span class=p>[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ£€æŸ¥æ˜¯å¦å¯†æ–‡æ ¼å¼ä¸åŒ</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åˆ†æå¯†æ–‡ç»“æ„:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å®Œæ•´å¯†æ–‡: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‰64å­—ç¬¦ (32å­—èŠ‚): </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>64</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å96å­—ç¬¦ (48å­—èŠ‚): </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][</span><span class=mi>64</span><span class=p>:]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B808</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v34</span><span class=p>,</span> <span class=n>v14</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=kr>__fastcall</span> <span class=nf>sub_15B808</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=n>a1</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=n>a2</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=n>a3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è§£å¯†å¤±è´¥ï¼Œä½†æˆ‘æ³¨æ„åˆ°ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š<strong>hashæ˜¯80å­—èŠ‚ï¼Œè€Œæ˜æ–‡åº”è¯¥åªæœ‰46å­—èŠ‚</strong>ã€‚è¿™æš—ç¤ºå¯èƒ½æœ‰é¢å¤–çš„æ•°æ®ã€‚è®©æˆ‘æµ‹è¯•ä¸€ç§å¸¸è§æ¨¡å¼â€”â€”<strong>å‰16å­—èŠ‚ä½œä¸ºIV</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æœŸæœ›æ˜æ–‡é•¿åº¦ (å‡å»padding): 65-80 bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;fileHash#t é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>+1+</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>])</span><span class=o>+</span><span class=mi>1</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ ¹æ®IDAåˆ†æï¼ŒIVé€‰æ‹©é€»è¾‘ï¼š</span>
</span></span><span class=line><span class=cl>        <span class=c1># - é»˜è®¤: AN1wedUvOJblfD8Z</span>
</span></span><span class=line><span class=cl>        <span class=c1># - å¦‚æœç¯å¢ƒ=&#34;prod&#34;: 2lJuL8jdH03oNIq5</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ ¹æ®IDAåˆ†æçš„IVé€‰æ‹©é€»è¾‘:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  - é»˜è®¤IV: AN1wedUvOJblfD8Z&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  - ç”Ÿäº§ç¯å¢ƒIV: 2lJuL8jdH03oNIq5 (å½“env=&#39;prod&#39;)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;é»˜è®¤IV (AN1wed)&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;ç”Ÿäº§IV (2lJuL8)&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>])]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰å¯è¯»å†…å®¹</span>
</span></span><span class=line><span class=cl>                <span class=n>printable_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>decrypted</span> <span class=k>if</span> <span class=mi>32</span> <span class=o>&lt;=</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mi>126</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>decrypted</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯æ‰“å°å­—ç¬¦æ•°: </span><span class=si>{</span><span class=n>printable_count</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>decrypted</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•æ‰¾åˆ°ç±»ä¼¼ fileHash#timestamp çš„æ¨¡å¼</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‘ç° &#39;#&#39; å­—ç¬¦ï¼å¯èƒ½æ˜¯æ­£ç¡®çš„IV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8å°è¯•: </span><span class=si>{</span><span class=n>decoded</span><span class=p>[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ£€æŸ¥æ˜¯å¦å¯†æ–‡æ ¼å¼ä¸åŒ</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åˆ†æå¯†æ–‡ç»“æ„:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å®Œæ•´å¯†æ–‡: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‰64å­—ç¬¦ (32å­—èŠ‚): </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>64</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å96å­—ç¬¦ (48å­—èŠ‚): </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][</span><span class=mi>64</span><span class=p>:]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ï¼šå‰16å­—èŠ‚æ˜¯IVï¼Œå64å­—èŠ‚æ˜¯å¯†æ–‡</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•æ–¹æ¡ˆ: å‰16å­—èŠ‚=IV, å64å­—èŠ‚=å¯†æ–‡&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>dynamic_iv</span> <span class=o>=</span> <span class=n>original_hash_bytes</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>actual_ciphertext</span> <span class=o>=</span> <span class=n>original_hash_bytes</span><span class=p>[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŠ¨æ€IV: </span><span class=si>{</span><span class=n>dynamic_iv</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯†æ–‡: </span><span class=si>{</span><span class=n>actual_ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯†æ–‡é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes (4ä¸ªAESå—)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>dynamic_iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># å°è¯•unpad</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  âœ“ è§£å¯†æˆåŠŸï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ˜æ–‡é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>unpadded</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ˜æ–‡å†…å®¹: </span><span class=si>{</span><span class=n>unpadded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8è§£ç : </span><span class=si>{</span><span class=n>decoded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># éªŒè¯æ ¼å¼</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>parts</span> <span class=o>=</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  âœ“âœ“ å‘ç°fileHash#timestampæ ¼å¼!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=k>else</span> <span class=s1>&#39;N/A&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ— æ³•UTF-8è§£ç &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  è§£å¯†åpaddingæ— æ•ˆ: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹è§£å¯†: </span><span class=si>{</span><span class=n>decrypted</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8å°è¯•: </span><span class=si>{</span><span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=nf>EVP_EncryptInit_ex</span><span class=p>(</span><span class=n>v10</span><span class=p>,</span> <span class=n>v13</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>*</span><span class=n>a2</span><span class=p>,</span> <span class=o>*</span><span class=n>a3</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span> <span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_1599BC</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>,</span> <span class=s>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>
</span></span><span class=line><span class=cl>c
</span></span><span class=line><span class=cl>I notice a discrepancy in the function call parameters. The function sub_15B808 is defined with three parameters, but it&#39;s being called with four arguments. This suggests a potential mismatch in how the arguments are being passed or interpreted.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The vector data pointers seem correct, but the extra argument raises questions about the actual function implementation and how the parameters are being used.
</span></span></code></pre></td></tr></table></div></div><p>è§£å¯†ä»ç„¶å¤±è´¥ã€‚è®©æˆ‘æœç´¢æ›´å¤šå…³äºç­¾åç”Ÿæˆçš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ <code>sign</code> å‚æ•°ï¼š</p><p>è®©æˆ‘æ·±å…¥åˆ†æ <code>calTradeAndMemberSign</code> å’Œç›¸å…³å‡½æ•°ï¼Œçœ‹çœ‹ <code>sign</code> å‚æ•°æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼š</p><p>è®©æˆ‘æŸ¥çœ‹ <code>JNI_OnLoad</code> æ¥äº†è§£æ³¨å†Œçš„æ–¹æ³•ï¼Œä»¥åŠåˆ†æä½¿ç”¨ MD5 çš„ä»£ç ï¼š</p><p>éå¸¸æœ‰ä»·å€¼ï¼ç°åœ¨æˆ‘çœ‹åˆ°äº† JNI æ–¹æ³•æ³¨å†Œè¡¨ <code>off_530010</code>ã€‚è®©æˆ‘æŸ¥çœ‹è¿™ä¸ªè¡¨æ¥æ‰¾åˆ°æ‰€æœ‰æ³¨å†Œçš„ native æ–¹æ³•ï¼š</p><p>è®©æˆ‘è¯»å– JNI æ–¹æ³•è¡¨ä¸­çš„å­—ç¬¦ä¸²ï¼š</p><p>ç°åœ¨æˆ‘æ‰¾åˆ°äº†å®Œæ•´çš„ JNI æ–¹æ³•è¡¨ï¼è®©æˆ‘åç¼–è¯‘ <code>calDIYSign</code> å‡½æ•° (åœ°å€ 0x1629D8) æ¥è¯¦ç»†åˆ†æç­¾åç®—æ³•ï¼š</p><p>è®©æˆ‘é‡æ–°åç¼–è¯‘æ­£ç¡®çš„å‡½æ•°åœ°å€ï¼š</p><p>è®©æˆ‘ç›´æ¥åç¼–è¯‘æˆ‘ä»¬ä¹‹å‰å‘ç°çš„æ ¸å¿ƒç­¾åå‡½æ•°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=n>v7</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=nf>now</span><span class=p>(</span><span class=n>v6</span><span class=p>)</span> <span class=o>/</span> <span class=mi>1000LL</span><span class=p>;</span>  <span class=c1>// æ¯«ç§’æ—¶é—´æˆ³
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=n>std</span><span class=o>::</span><span class=nf>to_string</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v43</span><span class=p>,</span> <span class=n>v7</span><span class=p>);</span>  <span class=c1>// è½¬ä¸ºå­—ç¬¦ä¸²
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=nf>sub_15B6FC</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>a1</span><span class=p>,</span> <span class=s>&#34;#&#34;</span><span class=p>);</span>  <span class=c1>// a1 æ˜¯è¾“å…¥çš„ fileHashï¼Œç”¨ &#34;#&#34; ä½œä¸ºåˆ†éš”ç¬¦
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=nf>sub_15E948</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>v8</span><span class=p>,</span> <span class=n>v9</span><span class=p>);</span>  <span class=c1>// v8 æ˜¯æ—¶é—´æˆ³å­—ç¬¦ä¸²
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=nf>sub_1599BC</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>,</span> <span class=s>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>);</span>  <span class=c1>// AESå¯†é’¥
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>   <span class=nf>sub_15B808</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v34</span><span class=p>,</span> <span class=n>v14</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=c1>// n = è¾“å‡ºç»“æœ
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=c1>// v34 = æ˜æ–‡ï¼ˆfileHash#timestampï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=c1>// v14 = sub_15BC94() çš„è¿”å›å€¼ï¼ˆIVï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=c1>// unk_535C88 = å¯†é’¥
</span></span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨æˆ‘ç†è§£äº†æ•´ä¸ªç­¾åæµç¨‹ã€‚è®©æˆ‘æ›´æ–°åˆ†æè„šæœ¬æ¥éªŒè¯æˆ‘ä»¬çš„å‘ç°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B808</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=n>a1</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=n>a2</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=o>*</span><span class=n>a3</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B808</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v34</span><span class=p>,</span> <span class=n>v14</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15CDF0</span><span class=p>(</span><span class=n>ptr</span><span class=p>,</span> <span class=n>v54</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v51</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v48</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>è®©æˆ‘æœç´¢ <code>sign</code> å‚æ•°çš„ç”Ÿæˆé€»è¾‘ï¼Œä»¥åŠæŸ¥æ‰¾å…¶ä»–å¯èƒ½çš„å¯†é’¥å¤„ç†ï¼š</p><p>ç°åœ¨æˆ‘å®Œå…¨ç¡®è®¤äº†åŠ å¯†ç®—æ³•æ˜¯æ ‡å‡†çš„ AES-CBCã€‚è®©æˆ‘æ›´æ–°æµ‹è¯•è„šæœ¬æ¥å°è¯•æ›´å¤šçš„ç»„åˆï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç®—æ³•å®ç°
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäºlibheyteago.soé€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ï¼ˆæ¥è‡ªIDAé€†å‘åˆ†æï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ è¾“å…¥å­—ç¬¦ä¸²: fileHash + &#34;#&#34; + t
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash
</span></span></span><span class=line><span class=cl><span class=s2>5. sign å¯èƒ½æ˜¯å¯¹æŸäº›å‚æ•°çš„ MD5
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ï¼ˆä»libheyteago.soåœ°å€ 0x4379f4 æå–ï¼‰:
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>- IVå€™é€‰å€¼: 
</span></span></span><span class=line><span class=cl><span class=s2>  - AN1wedUvOJblfD8Z (16å­—èŠ‚) 
</span></span></span><span class=line><span class=cl><span class=s2>  - 2lJuL8jdH03oNIq5 (16å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=s2>  - å…¨é›¶IV (å¸¸è§é»˜è®¤å€¼)
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡¬ç¼–ç å¯†é’¥ï¼ˆä»libheyteago.soæå–ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl><span class=n>IV_OPTIONS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹1</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span><span class=p>,</span>  <span class=c1># é€‰é¡¹2</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span><span class=p>,</span>          <span class=c1># å…¨é›¶IV</span>
</span></span><span class=line><span class=cl>    <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span><span class=p>,</span>  <span class=c1># å¯†é’¥ä½œä¸ºIV</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCåŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>,</span> <span class=n>iv</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;AES-CBCè§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted</span>  <span class=c1># å¦‚æœunpadå¤±è´¥ï¼Œè¿”å›åŸå§‹è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>hash_value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®— sign å‚æ•° (MD5)
</span></span></span><span class=line><span class=cl><span class=s2>    å°è¯•å¤šç§ç»„åˆæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>combinations</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>hash_value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;fileHash=</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&amp;t=</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&amp;shopId=</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>combo</span> <span class=ow>in</span> <span class=n>combinations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=p>[</span><span class=n>combo</span><span class=p>[:</span><span class=mi>50</span><span class=p>]]</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>combo</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_diy_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>iv_index</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    è®¡ç®—DIYè´´çº¸ç­¾å
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°:
</span></span></span><span class=line><span class=cl><span class=s2>        file_hash: æ–‡ä»¶MD5å“ˆå¸Œå€¼ï¼ˆ32å­—ç¬¦åå…­è¿›åˆ¶ï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>        timestamp: æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›:
</span></span></span><span class=line><span class=cl><span class=s2>        åŒ…å« sign, hash, t çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t_str</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ1: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_1</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ–¹æ¡ˆ2: ä»… fileHash</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_2</span> <span class=o>=</span> <span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„IVå°è¯•åŠ å¯†</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•ä¸åŒçš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>iv_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=s2>&#34;IV3_zeros&#34;</span><span class=p>,</span> <span class=s2>&#34;IV4_key&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>iv_idx</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>IV_OPTIONS</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt_name</span><span class=p>,</span> <span class=n>plaintext</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;hash#t&#34;</span><span class=p>,</span> <span class=n>plaintext_1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;hash&#34;</span><span class=p>,</span> <span class=n>plaintext_2</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypted_hex</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>iv_names</span><span class=p>[</span><span class=n>iv_idx</span><span class=p>]</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>pt_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®—å¯èƒ½çš„signï¼ˆMD5ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_candidates</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>file_hash</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>t_str</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash+t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(t+fileHash)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>t_str</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;md5(fileHash#t)&#34;</span><span class=p>:</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>t_str</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;file_hash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash_candidates&#34;</span><span class=p>:</span> <span class=n>results</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign_candidates&#34;</span><span class=p>:</span> <span class=n>sign_candidates</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_request_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆè¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    è¿™ä¸ªå‡½æ•°å°è¯•é‡ç°calDIYSignçš„è¡Œä¸º
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file_hash</span> <span class=o>=</span> <span class=n>calculate_file_hash</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># åŸºäºé€†å‘åˆ†æï¼Œæœ€å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ä¸»å¯†é’¥å’ŒIV</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>hash_param</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># signå¯èƒ½æ˜¯æŸç§MD5</span>
</span></span><span class=line><span class=cl>    <span class=n>sign_param</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_param</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># æµ‹è¯•ç”¨ä¾‹ - ä½¿ç”¨HARåŒ…ä¸­çš„æ•°æ®éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶DIYç­¾åç®—æ³•åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># HARåŒ…ä¸­çš„åŸå§‹æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>original_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>  <span class=c1># from tmp_xxx.png</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹HARæ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2> (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash bytes: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯ (ä»libheyteago.soæå–):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #1: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV #2: </span><span class=si>{</span><span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŸå§‹æ•°æ®æµ‹è¯•</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æµ‹è¯•ç­¾åè®¡ç®—:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>calculate_diy_sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>        <span class=nb>int</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è¾“å…¥:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;file_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„hashå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;hash_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è®¡ç®—çš„signå€™é€‰å€¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;sign_candidates&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“ MATCH!&#34;</span> <span class=k>if</span> <span class=n>value</span> <span class=o>==</span> <span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;sign&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># å°è¯•è§£å¯†åŸå§‹hash</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•è§£å¯†åŸå§‹hashå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>original_hash_bytes</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹hashé•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æœŸæœ›æ˜æ–‡é•¿åº¦ (å‡å»padding): 65-80 bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;fileHash#t é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2>+1+</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> = </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>])</span><span class=o>+</span><span class=mi>1</span><span class=o>+</span><span class=nb>len</span><span class=p>(</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> bytes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ ¹æ®IDAåˆ†æï¼ŒIVé€‰æ‹©é€»è¾‘ï¼š</span>
</span></span><span class=line><span class=cl>        <span class=c1># - é»˜è®¤: AN1wedUvOJblfD8Z</span>
</span></span><span class=line><span class=cl>        <span class=c1># - å¦‚æœç¯å¢ƒ=&#34;prod&#34;: 2lJuL8jdH03oNIq5</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ ¹æ®IDAåˆ†æçš„IVé€‰æ‹©é€»è¾‘:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  - é»˜è®¤IV: AN1wedUvOJblfD8Z&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  - ç”Ÿäº§ç¯å¢ƒIV: 2lJuL8jdH03oNIq5 (å½“env=&#39;prod&#39;)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;é»˜è®¤IV (AN1wed)&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;ç”Ÿäº§IV (2lJuL8)&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>])]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰å¯è¯»å†…å®¹</span>
</span></span><span class=line><span class=cl>                <span class=n>printable_count</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>decrypted</span> <span class=k>if</span> <span class=mi>32</span> <span class=o>&lt;=</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mi>126</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>decrypted</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯æ‰“å°å­—ç¬¦æ•°: </span><span class=si>{</span><span class=n>printable_count</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>decrypted</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># å°è¯•æ‰¾åˆ°ç±»ä¼¼ fileHash#timestamp çš„æ¨¡å¼</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‘ç° &#39;#&#39; å­—ç¬¦ï¼å¯èƒ½æ˜¯æ­£ç¡®çš„IV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  UTF-8å°è¯•: </span><span class=si>{</span><span class=n>decoded</span><span class=p>[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> è§£å¯†å¤±è´¥: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ£€æŸ¥æ˜¯å¦å¯†æ–‡æ ¼å¼ä¸åŒ</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åˆ†æå¯†æ–‡ç»“æ„:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å®Œæ•´å¯†æ–‡: </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å‰64å­—ç¬¦ (32å­—èŠ‚): </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>64</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å96å­—ç¬¦ (48å­—èŠ‚): </span><span class=si>{</span><span class=n>original_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][</span><span class=mi>64</span><span class=p>:]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ï¼šå‰16å­—èŠ‚æ˜¯IVï¼Œå64å­—èŠ‚æ˜¯å¯†æ–‡</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•æ–¹æ¡ˆ: å‰16å­—èŠ‚=IV, å64å­—èŠ‚=å¯†æ–‡&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>dynamic_iv</span> <span class=o>=</span> <span class=n>original_hash_bytes</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>actual_ciphertext</span> <span class=o>=</span> <span class=n>original_hash_bytes</span><span class=p>[</span><span class=mi>16</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŠ¨æ€IV: </span><span class=si>{</span><span class=n>dynamic_iv</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯†æ–‡: </span><span class=si>{</span><span class=n>actual_ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  å¯†æ–‡é•¿åº¦: </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>)</span><span class=si>}</span><span class=s2> bytes (4ä¸ªAESå—)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸åŒçš„å¯†é’¥å˜å½¢</span>
</span></span><span class=line><span class=cl>        <span class=n>key_variants</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=s2>&#34;åŸå§‹å¯†é’¥&#34;</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=s2>&#34;å¯†é’¥MD5&#34;</span><span class=p>,</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=s2>&#34;å¯†é’¥SHA256[:16]&#34;</span><span class=p>,</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=s2>&#34;IV1_AN1wed&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=s2>&#34;IV2_2lJuL8&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>key_name</span><span class=p>,</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>key_variants</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>dynamic_iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># æ£€æŸ¥æ˜¯å¦æœ‰å¯è¯»å†…å®¹</span>
</span></span><span class=line><span class=cl>                <span class=n>printable</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>decrypted</span> <span class=k>if</span> <span class=mi>32</span> <span class=o>&lt;=</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mi>126</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>printable</span> <span class=o>&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>decrypted</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.5</span><span class=p>:</span>  <span class=c1># è¶…è¿‡50%å¯æ‰“å°å­—ç¬¦</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>key_name</span><span class=si>}</span><span class=s2> (key=</span><span class=si>{</span><span class=n>key</span><span class=o>.</span><span class=n>hex</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span><span class=si>}</span><span class=s2>...):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>decoded</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>decoded</span> <span class=o>=</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    éƒ¨åˆ†è§£å¯†: </span><span class=si>{</span><span class=n>decoded</span><span class=p>[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•å®Œæ•´å¯†æ–‡ï¼ˆä¸æ‹†åˆ†IVï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•æ–¹æ¡ˆ: å®Œæ•´å¯†æ–‡ + ä¸åŒIV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;é›¶IV&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=mi>16</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;AN1wed&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;2lJuL8&#34;</span><span class=p>,</span> <span class=n>IV_OPTIONS</span><span class=p>[</span><span class=mi>1</span><span class=p>]),</span> <span class=p>(</span><span class=s2>&#34;å¯†é’¥IV&#34;</span><span class=p>,</span> <span class=n>AES_KEY</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>original_hash_bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>printable</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=mi>1</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>decrypted</span> <span class=k>if</span> <span class=mi>32</span> <span class=o>&lt;=</span> <span class=n>c</span> <span class=o>&lt;=</span> <span class=mi>126</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>printable</span> <span class=o>&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>decrypted</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    è§£å¯†ç»“æœ: </span><span class=si>{</span><span class=n>decoded</span><span class=p>[:</span><span class=mi>80</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2>: é”™è¯¯ - </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;éœ€è¦å®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¦‚æœè¦ä½¿ç”¨çœŸå®æ–‡ä»¶æµ‹è¯•ï¼Œè¯·è¿è¡Œ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;  python heytea_sign.py &lt;image_path&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>\xab\xbc\xfd\xf1\xd5\x0e\xe1\xbc\x1e=na\xe0ea\xb1
</span></span></code></pre></td></tr></table></div></div><p>è®©æˆ‘å†æ¬¡åˆ†æ IV é€‰æ‹©é€»è¾‘ï¼Œå¹¶å°è¯•ç”¨æ­£å‘åŠ å¯†æ¥éªŒè¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>*</span><span class=n>v3</span> <span class=o>==</span> <span class=mi>1685025392</span>
</span></span></code></pre></td></tr></table></div></div><p>è®©æˆ‘æ£€æŸ¥è¾“å‡ºå¤„ç†å‡½æ•°ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰é¢å¤–çš„è½¬æ¢ï¼š</p><p>è®©æˆ‘æ€»ç»“åˆ†æç»“æœå¹¶åˆ›å»ºä¸€ä¸ªæœ€ç»ˆçš„ç­¾åç”Ÿæˆè„šæœ¬ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl><span class=gh># å–œèŒ¶ DIY è´´çº¸ç­¾åç®—æ³•åˆ†ææŠ¥å‘Š
</span></span></span><span class=line><span class=cl><span class=gh></span>
</span></span><span class=line><span class=cl><span class=gu>## åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl><span class=gu>### 1. ç®—æ³•æ¦‚è¿°
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>ä» IDA Pro é€†å‘åˆ†æ <span class=sb>`libheyteago.so`</span> å¾—åˆ°ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>#### 1.1 JNI æ–¹æ³•è¡¨
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>| æ–¹æ³•å | ç­¾å | åœ°å€ |
</span></span><span class=line><span class=cl>|--------|------|------|
</span></span><span class=line><span class=cl>| setEnv | (String) -&gt; void | 0x162780 |
</span></span><span class=line><span class=cl>| calTradeAndMemberSign | (String, String) -&gt; String | 0x162840 |
</span></span><span class=line><span class=cl>| <span class=gs>**calDIYSign**</span> | (String) -&gt; String | 0x1629D8 |
</span></span><span class=line><span class=cl>| callNativeRequest | (String, String, int, String, String, String) -&gt; String | 0x162AF0 |
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>#### 1.2 åŠ å¯†å‚æ•°
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>| å‚æ•° | å€¼ | æ¥æºåœ°å€ |
</span></span><span class=line><span class=cl>|------|------|----------|
</span></span><span class=line><span class=cl>| <span class=gs>**AES Key**</span> | <span class=sb>`HEYTEA6H7J8K9M0N`</span> (16å­—èŠ‚) | 0x4379F4 |
</span></span><span class=line><span class=cl>| <span class=gs>**IV Option 1**</span> | <span class=sb>`AN1wedUvOJblfD8Z`</span> (16å­—èŠ‚) | 0x437A04 |
</span></span><span class=line><span class=cl>| <span class=gs>**IV Option 2**</span> | <span class=sb>`2lJuL8jdH03oNIq5`</span> (16å­—èŠ‚) | 0x437A15 |
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>### 2. ç­¾åç”Ÿæˆæµç¨‹
</span></span></span></code></pre></td></tr></table></div></div><p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ calDIYSign(fileHash) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è·å–å½“å‰æ—¶é—´æˆ³ (æ¯«ç§’) â”‚
â”‚ timestamp = std::chrono::system_clock::now() / 1000 â”‚
â”‚ â”‚
â”‚ 2. æ„é€ æ˜æ–‡ â”‚
â”‚ plaintext = fileHash + &ldquo;#&rdquo; + timestamp â”‚
â”‚ ä¾‹: &ldquo;32e6dbcc2678d4d40a297ca5490acc4d#1764833231217&rdquo; â”‚
â”‚ â”‚
â”‚ 3. é€‰æ‹© IV (åŸºäºç¯å¢ƒé…ç½®) â”‚
â”‚ if (env == &ldquo;ç‰¹å®šå€¼&rdquo;) IV = &ldquo;2lJuL8jdH03oNIq5&rdquo; â”‚
â”‚ else IV = &ldquo;AN1wedUvOJblfD8Z&rdquo; â”‚
â”‚ â”‚
â”‚ 4. AES-128-CBC åŠ å¯† â”‚
â”‚ key = &ldquo;HEYTEA6H7J8K9M0N&rdquo; â”‚
â”‚ ciphertext = AES_CBC_Encrypt(plaintext, key, IV) â”‚
â”‚ â”‚
â”‚ 5. è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸² â”‚
â”‚ hash = ciphertext.toHex() â”‚
â”‚ â”‚
â”‚ 6. è¿”å›ç»“æœ â”‚
â”‚ return {errorCode: 0, message: &ldquo;&rdquo;, data: {hash, t}} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>### 3. å…³é”®å‡½æ•°åˆ†æ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#### 3.1 ä¸»å‡½æ•° (0x15ADEC / 0x15B230)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```c
</span></span><span class=line><span class=cl>// è·å–æ—¶é—´æˆ³
</span></span><span class=line><span class=cl>v7 = std::chrono::system_clock::now() / 1000LL;
</span></span><span class=line><span class=cl>std::to_string(&amp;v43, v7);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// æ‹¼æ¥å­—ç¬¦ä¸²
</span></span><span class=line><span class=cl>sub_15B6FC(&amp;v38, a1, &#34;#&#34;);  // a1 æ˜¯ fileHashï¼Œç”¨ &#34;#&#34; åˆ†éš”
</span></span><span class=line><span class=cl>sub_15E948(&amp;v38, timestamp_str, timestamp_len);  // æ‹¼æ¥æ—¶é—´æˆ³
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// è·å– IV
</span></span><span class=line><span class=cl>v14 = sub_15BC94();  // æ ¹æ®ç¯å¢ƒé€‰æ‹© IV
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// åˆå§‹åŒ–å¯†é’¥ (å•ä¾‹æ¨¡å¼)
</span></span><span class=line><span class=cl>if (!initialized) {
</span></span><span class=line><span class=cl>    sub_1599BC(&amp;unk_535C88, &#34;HEYTEA6H7J8K9M0N&#34;);
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// åŠ å¯†
</span></span><span class=line><span class=cl>sub_15B808(n, &amp;plaintext, v14, &amp;unk_535C88);
</span></span></code></pre></td></tr></table></div></div><h4 id=32-åŠ å¯†å‡½æ•°-0x15cdf0><a href=#32-%e5%8a%a0%e5%af%86%e5%87%bd%e6%95%b0-0x15cdf0 class=header-anchor></a>3.2 åŠ å¯†å‡½æ•° (0x15CDF0)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// éªŒè¯å¯†é’¥é•¿åº¦ (16, 24, æˆ– 32 å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>key_len</span> <span class=o>==</span> <span class=mi>16</span><span class=p>)</span> <span class=n>cipher</span> <span class=o>=</span> <span class=nf>EVP_aes_128_cbc</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=n>key_len</span> <span class=o>==</span> <span class=mi>24</span><span class=p>)</span> <span class=n>cipher</span> <span class=o>=</span> <span class=nf>EVP_aes_192_cbc</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=n>key_len</span> <span class=o>==</span> <span class=mi>32</span><span class=p>)</span> <span class=n>cipher</span> <span class=o>=</span> <span class=nf>EVP_aes_256_cbc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// éªŒè¯ IV é•¿åº¦ (å¿…é¡»æ˜¯ 16 å­—èŠ‚)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>iv_len</span> <span class=o>!=</span> <span class=mi>16</span><span class=p>)</span> <span class=n>throw</span> <span class=n>std</span><span class=o>::</span><span class=nf>invalid_argument</span><span class=p>(</span><span class=s>&#34;IV must be 16 bytes&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä½¿ç”¨ OpenSSL EVP API åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>EVP_CIPHER_CTX_new</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nf>EVP_EncryptInit_ex</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>cipher</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>EVP_EncryptUpdate</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>len</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>,</span> <span class=n>plaintext_len</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>EVP_EncryptFinal_ex</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>ciphertext</span> <span class=o>+</span> <span class=n>len</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>final_len</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=4-åº”ç”¨ç­¾åéªŒè¯><a href=#4-%e5%ba%94%e7%94%a8%e7%ad%be%e5%90%8d%e9%aa%8c%e8%af%81 class=header-anchor></a>4. åº”ç”¨ç­¾åéªŒè¯</h3><p>JNI_OnLoad ä¸­æœ‰ APK ç­¾åéªŒè¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// éªŒè¯ APK ç­¾å
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=nf>getCurrentAppSignature</span><span class=p>(),</span> <span class=n>EXPECTED_SIGNATURE</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>  <span class=c1>// ç­¾åä¸åŒ¹é…ï¼Œæ‹’ç»åŠ è½½
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ„å‘³ç€è¯¥ native åº“åªä¼šåœ¨å®˜æ–¹å–œèŒ¶ APP ä¸­æ­£å¸¸å·¥ä½œã€‚</p><h3 id=5-sign-å‚æ•°><a href=#5-sign-%e5%8f%82%e6%95%b0 class=header-anchor></a>5. sign å‚æ•°</h3><p><code>sign</code> å‚æ•°çš„ç”Ÿæˆé€»è¾‘åœ¨ JavaScript ç«¯æˆ–å…¶ä»–åœ°æ–¹ã€‚ä» HAR æ•°æ®çœ‹ï¼Œ<code>sign</code> æ˜¯ 32 ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆMD5 æ ¼å¼ï¼‰ï¼Œä½†å…·ä½“è®¡ç®—æ–¹å¼éœ€è¦è¿›ä¸€æ­¥åˆ†æã€‚</p><p>å¯èƒ½çš„ç»„åˆï¼ˆæœªéªŒè¯ï¼‰ï¼š</p><ul><li><code>MD5(fileHash + timestamp + shopId)</code></li><li><code>MD5(hash + timestamp)</code></li><li>å…¶ä»–ç»„åˆ</li></ul><h3 id=6-ç»“è®º><a href=#6-%e7%bb%93%e8%ae%ba class=header-anchor></a>6. ç»“è®º</h3><ol><li><strong>åŠ å¯†ç®—æ³•</strong>: AES-128-CBC (PKCS7 padding)</li><li><strong>å¯†é’¥</strong>: <code>HEYTEA6H7J8K9M0N</code></li><li><strong>IV</strong>: <code>AN1wedUvOJblfD8Z</code> æˆ– <code>2lJuL8jdH03oNIq5</code></li><li><strong>æ˜æ–‡æ ¼å¼</strong>: <code>fileHash#timestamp</code></li><li><strong>è¾“å‡ºæ ¼å¼</strong>: åŠ å¯†ç»“æœçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²</li></ol><h3 id=7-æ³¨æ„äº‹é¡¹><a href=#7-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 class=header-anchor></a>7. æ³¨æ„äº‹é¡¹</h3><ul><li><p>è§£å¯†æµ‹è¯•æœªæˆåŠŸï¼Œå¯èƒ½åŸå› ï¼š</p><ul><li>fileHash è®¡ç®—æ–¹å¼ä¸æ˜ç¡®</li><li>å¯èƒ½æœ‰è¿è¡Œæ—¶å¯†é’¥/IV ä¿®æ”¹</li><li>APK ç­¾åéªŒè¯å¯èƒ½å½±å“ç»“æœ</li></ul></li><li><p>å»ºè®®è¿›ä¸€æ­¥ç ”ç©¶ï¼š</p><ul><li>ä½¿ç”¨ Frida åŠ¨æ€ hook ç¡®è®¤å®é™…å‚æ•°</li><li>æ•è·å¤šç»„è¯·æ±‚æ ·æœ¬è¿›è¡Œåˆ†æ</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç°åœ¨è®©æˆ‘æ›´æ–°ç­¾åç”Ÿæˆè„šæœ¬ï¼Œä½¿å…¶æ›´å®Œå–„ï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```python
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span><span class=line><span class=cl>åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç®—æ³•æµç¨‹:
</span></span><span class=line><span class=cl>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span><span class=line><span class=cl>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span><span class=line><span class=cl>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span><span class=line><span class=cl>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span><span class=line><span class=cl>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span><span class=line><span class=cl>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04)  
</span></span><span class=line><span class=cl>- IVå¤‡é€‰: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ä½¿ç”¨æ–¹æ³•:
</span></span><span class=line><span class=cl>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span><span class=line><span class=cl>&#34;&#34;&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>import hashlib
</span></span><span class=line><span class=cl>import time
</span></span><span class=line><span class=cl>import sys
</span></span><span class=line><span class=cl>import os
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>try:
</span></span><span class=line><span class=cl>    from Crypto.Cipher import AES
</span></span><span class=line><span class=cl>    from Crypto.Util.Padding import pad, unpad
</span></span><span class=line><span class=cl>except ImportError:
</span></span><span class=line><span class=cl>    print(&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;)
</span></span><span class=line><span class=cl>    sys.exit(1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class HeyteaDIYSign:
</span></span><span class=line><span class=cl>    &#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    # ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥
</span></span><span class=line><span class=cl>    AES_KEY = b&#34;HEYTEA6H7J8K9M0N&#34;  # 16 bytes = AES-128
</span></span><span class=line><span class=cl>    IV_DEFAULT = b&#34;AN1wedUvOJblfD8Z&#34;  # é»˜è®¤ IV
</span></span><span class=line><span class=cl>    IV_PROD = b&#34;2lJuL8jdH03oNIq5&#34;  # ç”Ÿäº§ç¯å¢ƒ IV
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def __init__(self, env: str = &#34;default&#34;):
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        Args:
</span></span><span class=line><span class=cl>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        self.env = env
</span></span><span class=line><span class=cl>        self.iv = self.IV_PROD if env == &#34;prod&#34; else self.IV_DEFAULT
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    @staticmethod
</span></span><span class=line><span class=cl>    def calculate_file_md5(file_path: str) -&gt; str:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼&#34;&#34;&#34;
</span></span><span class=line><span class=cl>        with open(file_path, &#34;rb&#34;) as f:
</span></span><span class=line><span class=cl>            return hashlib.md5(f.read()).hexdigest()
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def aes_encrypt(self, plaintext: bytes) -&gt; bytes:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;
</span></span><span class=line><span class=cl>        cipher = AES.new(self.AES_KEY, AES.MODE_CBC, self.iv)
</span></span><span class=line><span class=cl>        padded = pad(plaintext, AES.block_size)
</span></span><span class=line><span class=cl>        return cipher.encrypt(padded)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def aes_decrypt(self, ciphertext: bytes) -&gt; bytes:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;
</span></span><span class=line><span class=cl>        cipher = AES.new(self.AES_KEY, AES.MODE_CBC, self.iv)
</span></span><span class=line><span class=cl>        decrypted = cipher.decrypt(ciphertext)
</span></span><span class=line><span class=cl>        try:
</span></span><span class=line><span class=cl>            return unpad(decrypted, AES.block_size)
</span></span><span class=line><span class=cl>        except ValueError:
</span></span><span class=line><span class=cl>            return decrypted
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def generate_hash(self, file_hash: str, timestamp: int = None) -&gt; tuple:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        ç”Ÿæˆ hash å‚æ•°
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        Args:
</span></span><span class=line><span class=cl>            file_hash: æ–‡ä»¶ MD5 å“ˆå¸Œå€¼ (32å­—ç¬¦åå…­è¿›åˆ¶)
</span></span><span class=line><span class=cl>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        Returns:
</span></span><span class=line><span class=cl>            (hash_value, timestamp)
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        if timestamp is None:
</span></span><span class=line><span class=cl>            timestamp = int(time.time() * 1000)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # æ„é€ æ˜æ–‡: fileHash#timestamp
</span></span><span class=line><span class=cl>        plaintext = f&#34;{file_hash}#{timestamp}&#34;.encode(&#39;utf-8&#39;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # AES åŠ å¯†
</span></span><span class=line><span class=cl>        ciphertext = self.aes_encrypt(plaintext)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # è½¬ä¸ºåå…­è¿›åˆ¶
</span></span><span class=line><span class=cl>        hash_value = ciphertext.hex()
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        return hash_value, timestamp
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def generate_sign(self, file_hash: str, timestamp: int, shop_id: str) -&gt; str:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        # å¯èƒ½çš„ç»„åˆ
</span></span><span class=line><span class=cl>        candidates = [
</span></span><span class=line><span class=cl>            hashlib.md5(f&#34;{file_hash}{timestamp}{shop_id}&#34;.encode()).hexdigest(),
</span></span><span class=line><span class=cl>            hashlib.md5(f&#34;{timestamp}{file_hash}{shop_id}&#34;.encode()).hexdigest(),
</span></span><span class=line><span class=cl>            hashlib.md5(f&#34;{file_hash}#{timestamp}&#34;.encode()).hexdigest(),
</span></span><span class=line><span class=cl>            hashlib.md5(f&#34;{shop_id}{timestamp}{file_hash}&#34;.encode()).hexdigest(),
</span></span><span class=line><span class=cl>        ]
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # é»˜è®¤è¿”å›ç¬¬ä¸€ç§
</span></span><span class=line><span class=cl>        return candidates[0]
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def generate_params(self, file_path: str, shop_id: str = &#34;4216&#34;) -&gt; dict:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        Args:
</span></span><span class=line><span class=cl>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„
</span></span><span class=line><span class=cl>            shop_id: åº—é“ºID
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        Returns:
</span></span><span class=line><span class=cl>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        # è®¡ç®—æ–‡ä»¶ MD5
</span></span><span class=line><span class=cl>        file_hash = self.calculate_file_md5(file_path)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # ç”Ÿæˆ hash å’Œ timestamp
</span></span><span class=line><span class=cl>        hash_value, timestamp = self.generate_hash(file_hash)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # ç”Ÿæˆ sign
</span></span><span class=line><span class=cl>        sign = self.generate_sign(file_hash, timestamp, shop_id)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        return {
</span></span><span class=line><span class=cl>            &#34;sign&#34;: sign,
</span></span><span class=line><span class=cl>            &#34;t&#34;: str(timestamp),
</span></span><span class=line><span class=cl>            &#34;hash&#34;: hash_value,
</span></span><span class=line><span class=cl>            &#34;shopId&#34;: shop_id,
</span></span><span class=line><span class=cl>            &#34;_fileHash&#34;: file_hash,  # è°ƒè¯•ç”¨
</span></span><span class=line><span class=cl>            &#34;_plaintext&#34;: f&#34;{file_hash}#{timestamp}&#34;,  # è°ƒè¯•ç”¨
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    def try_decrypt(self, hash_hex: str) -&gt; dict:
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        å°è¯•è§£å¯† hash å‚æ•°
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        Args:
</span></span><span class=line><span class=cl>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        Returns:
</span></span><span class=line><span class=cl>            è§£å¯†ç»“æœ
</span></span><span class=line><span class=cl>        &#34;&#34;&#34;
</span></span><span class=line><span class=cl>        results = {}
</span></span><span class=line><span class=cl>        ciphertext = bytes.fromhex(hash_hex)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # å°è¯•ä¸¤ç§ IV
</span></span><span class=line><span class=cl>        for iv_name, iv in [(&#34;default&#34;, self.IV_DEFAULT), (&#34;prod&#34;, self.IV_PROD)]:
</span></span><span class=line><span class=cl>            try:
</span></span><span class=line><span class=cl>                cipher = AES.new(self.AES_KEY, AES.MODE_CBC, iv)
</span></span><span class=line><span class=cl>                decrypted = cipher.decrypt(ciphertext)
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                try:
</span></span><span class=line><span class=cl>                    unpadded = unpad(decrypted, AES.block_size)
</span></span><span class=line><span class=cl>                    decoded = unpadded.decode(&#39;utf-8&#39;)
</span></span><span class=line><span class=cl>                    results[iv_name] = {
</span></span><span class=line><span class=cl>                        &#34;success&#34;: True,
</span></span><span class=line><span class=cl>                        &#34;plaintext&#34;: decoded,
</span></span><span class=line><span class=cl>                        &#34;parts&#34;: decoded.split(&#39;#&#39;) if &#39;#&#39; in decoded else [decoded]
</span></span><span class=line><span class=cl>                    }
</span></span><span class=line><span class=cl>                except:
</span></span><span class=line><span class=cl>                    results[iv_name] = {
</span></span><span class=line><span class=cl>                        &#34;success&#34;: False,
</span></span><span class=line><span class=cl>                        &#34;raw&#34;: decrypted.hex(),
</span></span><span class=line><span class=cl>                        &#34;printable&#34;: decrypted.decode(&#39;utf-8&#39;, errors=&#39;replace&#39;)
</span></span><span class=line><span class=cl>                    }
</span></span><span class=line><span class=cl>            except Exception as e:
</span></span><span class=line><span class=cl>                results[iv_name] = {&#34;error&#34;: str(e)}
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        return results
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def main():
</span></span><span class=line><span class=cl>    &#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;
</span></span><span class=line><span class=cl>    print(&#34;=&#34; * 60)
</span></span><span class=line><span class=cl>    print(&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;)
</span></span><span class=line><span class=cl>    print(&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;)
</span></span><span class=line><span class=cl>    print(&#34;=&#34; * 60)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    # æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯
</span></span><span class=line><span class=cl>    signer = HeyteaDIYSign()
</span></span><span class=line><span class=cl>    print(f&#34;\nå¯†é’¥ä¿¡æ¯:&#34;)
</span></span><span class=line><span class=cl>    print(f&#34;  AES Key: {signer.AES_KEY.decode()}&#34;)
</span></span><span class=line><span class=cl>    print(f&#34;  IV (é»˜è®¤): {signer.IV_DEFAULT.decode()}&#34;)
</span></span><span class=line><span class=cl>    print(f&#34;  IV (ç”Ÿäº§): {signer.IV_PROD.decode()}&#34;)
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    if len(sys.argv) &gt; 1:
</span></span><span class=line><span class=cl>        # ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°
</span></span><span class=line><span class=cl>        file_path = sys.argv[1]
</span></span><span class=line><span class=cl>        shop_id = sys.argv[2] if len(sys.argv) &gt; 2 else &#34;4216&#34;
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        if not os.path.exists(file_path):
</span></span><span class=line><span class=cl>            print(f&#34;\né”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - {file_path}&#34;)
</span></span><span class=line><span class=cl>            return
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        print(f&#34;\nç”Ÿæˆç­¾åå‚æ•°:&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  æ–‡ä»¶: {file_path}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  åº—é“ºID: {shop_id}&#34;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        params = signer.generate_params(file_path, shop_id)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        print(f&#34;\nç”Ÿæˆçš„å‚æ•°:&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  sign: {params[&#39;sign&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  t: {params[&#39;t&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  hash: {params[&#39;hash&#39;][:50]}...&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  shopId: {params[&#39;shopId&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;\nè°ƒè¯•ä¿¡æ¯:&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  fileHash: {params[&#39;_fileHash&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  plaintext: {params[&#39;_plaintext&#39;]}&#34;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    else:
</span></span><span class=line><span class=cl>        # ä½¿ç”¨æµ‹è¯•æ•°æ®
</span></span><span class=line><span class=cl>        print(&#34;\nä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        test_data = {
</span></span><span class=line><span class=cl>            &#34;sign&#34;: &#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;,
</span></span><span class=line><span class=cl>            &#34;t&#34;: &#34;1764833231217&#34;,
</span></span><span class=line><span class=cl>            &#34;hash&#34;: &#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;,
</span></span><span class=line><span class=cl>            &#34;shopId&#34;: &#34;4216&#34;,
</span></span><span class=line><span class=cl>            &#34;filename_hash&#34;: &#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;,
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        print(f&#34;\nåŸå§‹æ•°æ®:&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  sign: {test_data[&#39;sign&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  t: {test_data[&#39;t&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  hash: {test_data[&#39;hash&#39;][:50]}... ({len(test_data[&#39;hash&#39;])} chars)&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  shopId: {test_data[&#39;shopId&#39;]}&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  filename hash: {test_data[&#39;filename_hash&#39;]}&#34;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°
</span></span><span class=line><span class=cl>        print(&#34;\nå°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename_hash ä½œä¸º fileHash):&#34;)
</span></span><span class=line><span class=cl>        hash_value, _ = signer.generate_hash(
</span></span><span class=line><span class=cl>            test_data[&#34;filename_hash&#34;], 
</span></span><span class=line><span class=cl>            int(test_data[&#34;t&#34;])
</span></span><span class=line><span class=cl>        )
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        print(f&#34;  ç”Ÿæˆçš„ hash: {hash_value[:50]}...&#34;)
</span></span><span class=line><span class=cl>        print(f&#34;  åŒ¹é…åŸå§‹: {&#39;âœ“&#39; if hash_value == test_data[&#39;hash&#39;] else &#39;âœ—&#39;}&#34;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        # å°è¯•è§£å¯†
</span></span><span class=line><span class=cl>        print(&#34;\nå°è¯•è§£å¯†åŸå§‹ hash:&#34;)
</span></span><span class=line><span class=cl>        decrypt_results = signer.try_decrypt(test_data[&#34;hash&#34;])
</span></span><span class=line><span class=cl>        for iv_name, result in decrypt_results.items():
</span></span><span class=line><span class=cl>            print(f&#34;\n  ä½¿ç”¨ {iv_name} IV:&#34;)
</span></span><span class=line><span class=cl>            if result.get(&#34;success&#34;):
</span></span><span class=line><span class=cl>                print(f&#34;    âœ“ è§£å¯†æˆåŠŸ: {result[&#39;plaintext&#39;]}&#34;)
</span></span><span class=line><span class=cl>                if len(result[&#39;parts&#39;]) == 2:
</span></span><span class=line><span class=cl>                    print(f&#34;    fileHash: {result[&#39;parts&#39;][0]}&#34;)
</span></span><span class=line><span class=cl>                    print(f&#34;    timestamp: {result[&#39;parts&#39;][1]}&#34;)
</span></span><span class=line><span class=cl>            elif &#34;error&#34; in result:
</span></span><span class=line><span class=cl>                print(f&#34;    âœ— é”™è¯¯: {result[&#39;error&#39;]}&#34;)
</span></span><span class=line><span class=cl>            else:
</span></span><span class=line><span class=cl>                print(f&#34;    âœ— è§£å¯†å¤±è´¥&#34;)
</span></span><span class=line><span class=cl>                print(f&#34;    åŸå§‹å­—èŠ‚: {result.get(&#39;raw&#39;, &#39;N/A&#39;)[:60]}...&#34;)
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        print(&#34;\n&#34; + &#34;=&#34; * 60)
</span></span><span class=line><span class=cl>        print(&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;)
</span></span><span class=line><span class=cl>        print(&#34;=&#34; * 60)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if __name__ == &#34;__main__&#34;:
</span></span><span class=line><span class=cl>    main()
</span></span></code></pre></td></tr></table></div></div><h2 id=åˆ†æå®Œæˆ><a href=#%e5%88%86%e6%9e%90%e5%ae%8c%e6%88%90 class=header-anchor></a>åˆ†æå®Œæˆï¼</h2><p>æ ¹æ®å¯¹ <code>libheyteago.so</code> çš„ IDA Pro é€†å‘åˆ†æï¼Œæˆ‘å·²ç»æå–å‡ºäº†å–œèŒ¶ DIY è´´çº¸ç­¾åç®—æ³•çš„æ ¸å¿ƒé€»è¾‘ï¼š</p><h3 id=-å‘ç°çš„åŠ å¯†å‚æ•°><a href=#-%e5%8f%91%e7%8e%b0%e7%9a%84%e5%8a%a0%e5%af%86%e5%8f%82%e6%95%b0 class=header-anchor></a>ğŸ” <strong>å‘ç°çš„åŠ å¯†å‚æ•°</strong></h3><div class=table-wrapper><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç®—æ³•</strong></td><td>AES-128-CBC</td><td>ä½¿ç”¨ OpenSSL EVP API</td></tr><tr><td><strong>å¯†é’¥</strong></td><td><code>HEYTEA6H7J8K9M0N</code></td><td>16å­—èŠ‚ï¼Œåœ°å€ 0x4379F4</td></tr><tr><td><strong>IV (é»˜è®¤)</strong></td><td><code>AN1wedUvOJblfD8Z</code></td><td>16å­—èŠ‚ï¼Œåœ°å€ 0x437A04</td></tr><tr><td><strong>IV (å¤‡é€‰)</strong></td><td><code>2lJuL8jdH03oNIq5</code></td><td>16å­—èŠ‚ï¼Œåœ°å€ 0x437A15</td></tr></tbody></table></div><h3 id=-ç­¾åç”Ÿæˆæµç¨‹><a href=#-%e7%ad%be%e5%90%8d%e7%94%9f%e6%88%90%e6%b5%81%e7%a8%8b class=header-anchor></a>ğŸ“ <strong>ç­¾åç”Ÿæˆæµç¨‹</strong></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³: t = time() * 1000
</span></span><span class=line><span class=cl>2. æ„é€ æ˜æ–‡: plaintext = fileHash + &#34;#&#34; + t
</span></span><span class=line><span class=cl>   ä¾‹: &#34;32e6dbcc2678d4d40a297ca5490acc4d#1764833231217&#34;
</span></span><span class=line><span class=cl>3. AES-128-CBC åŠ å¯†: ciphertext = AES_Encrypt(plaintext, key, iv)
</span></span><span class=line><span class=cl>4. è½¬åå…­è¿›åˆ¶: hash = ciphertext.toHex()
</span></span><span class=line><span class=cl>5. è¿”å›: {errorCode: 0, data: {hash, t}}
</span></span></code></pre></td></tr></table></div></div><h3 id=-ç”Ÿæˆçš„æ–‡ä»¶><a href=#-%e7%94%9f%e6%88%90%e7%9a%84%e6%96%87%e4%bb%b6 class=header-anchor></a>ğŸ“ <strong>ç”Ÿæˆçš„æ–‡ä»¶</strong></h3><ol><li><strong><code>heytea_signature_analysis.md</code></strong> - è¯¦ç»†åˆ†ææŠ¥å‘Š</li><li><strong><code>heytea_diy_sign.py</code></strong> - ç­¾åç”Ÿæˆè„šæœ¬</li></ol><h3 id=-æœªè§£å†³çš„é—®é¢˜><a href=#-%e6%9c%aa%e8%a7%a3%e5%86%b3%e7%9a%84%e9%97%ae%e9%a2%98 class=header-anchor></a>âš ï¸ <strong>æœªè§£å†³çš„é—®é¢˜</strong></h3><p>æ— æ³•ç”¨æå–çš„å‚æ•°è§£å¯†åŸå§‹ HAR ä¸­çš„ hashï¼Œå¯èƒ½åŸå› ï¼š</p><ol><li><strong>fileHash è®¡ç®—æ–¹å¼ä¸æ˜</strong> - å¯èƒ½æ˜¯å¤„ç†åçš„å›¾ç‰‡ MD5ï¼Œè€ŒéåŸå§‹å›¾ç‰‡</li><li><strong>APK ç­¾åéªŒè¯</strong> - è¯¥åº“åœ¨éå®˜æ–¹ APP ä¸­å¯èƒ½æœ‰ä¸åŒè¡Œä¸º</li><li><strong>åŠ¨æ€å‚æ•°</strong> - å¯èƒ½å­˜åœ¨è¿è¡Œæ—¶ä¿®æ”¹</li></ol><h3 id=-å»ºè®®åç»­æ­¥éª¤><a href=#-%e5%bb%ba%e8%ae%ae%e5%90%8e%e7%bb%ad%e6%ad%a5%e9%aa%a4 class=header-anchor></a>ğŸ’¡ <strong>å»ºè®®åç»­æ­¥éª¤</strong></h3><ol><li><strong>Frida Hook</strong> - åŠ¨æ€è¿½è¸ªå®é™…åŠ å¯†å‚æ•°</li><li><strong>å¤šæ ·æœ¬åˆ†æ</strong> - æ•è·å¤šç»„è¯·æ±‚å¯¹æ¯”</li><li><strong>sign å‚æ•°</strong> - è¿›ä¸€æ­¥åˆ†æ sign çš„ MD5 è®¡ç®—æ–¹å¼</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³: t = time() * 1000
</span></span><span class=line><span class=cl>2. æ„é€ æ˜æ–‡: plaintext = fileHash + &#34;#&#34; + t
</span></span><span class=line><span class=cl>   ä¾‹: &#34;32e6dbcc2678d4d40a297ca5490acc4d#1764833231217&#34;
</span></span><span class=line><span class=cl>3. AES-128-CBC åŠ å¯†: ciphertext = AES_Encrypt(plaintext, key, iv)
</span></span><span class=line><span class=cl>4. è½¬åå…­è¿›åˆ¶: hash = ciphertext.toHex()
</span></span><span class=line><span class=cl>5. è¿”å›: {errorCode: 0, data: {hash, t}}
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>User</strong></p><p>@heytea_diy_sign.py:77-78 ä½ ç¡®å®šè¿™ä¸€å‚æ•°æ˜¯æ–‡ä»¶çš„MD5å—ï¼Ÿè¯·æ ¹æ®@replay_request.py ä¸­çš„ä¿¡æ¯å†æ¬¡åˆ†æã€‚</p><hr><p><strong>Cursor</strong></p><p>å¥½é—®é¢˜ï¼è®©æˆ‘é‡æ–°æ£€æŸ¥ä¸€ä¸‹ã€‚é¦–å…ˆè®¡ç®—ä¸€ä¸‹å®é™…æ–‡ä»¶çš„ MD5ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>wx</span><span class=p>.</span><span class=nx>chooseImage</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>success</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>tempFilePaths</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>tempFilePaths</span>
</span></span><span class=line><span class=cl>    <span class=c1>// tempFilePaths ç±»ä¼¼: [&#34;wxfile://tmp_xxxx.png&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>éå¸¸é‡è¦çš„å‘ç°ï¼æ–‡ä»¶åä¸­çš„ <code>32e6dbcc2678d4d40a297ca5490acc4d</code> <strong>ä¸æ˜¯æ–‡ä»¶çš„ MD5</strong>ï¼è®©æˆ‘åœ¨åç¼–è¯‘çš„ JavaScript ä»£ç ä¸­æŸ¥æ‰¾ <code>fileHash</code> çš„æ¥æºï¼š</p><p>è®©æˆ‘å†æ¬¡æ£€æŸ¥ IDA ä¸­ <code>calDIYSign</code> å‡½æ•°çš„å®Œæ•´å®ç°ï¼Œçœ‹çœ‹ä¼ å…¥çš„ <code>fileHash</code> æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</p><p>ä» IDA åç¼–è¯‘ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œ<code>calDIYSign</code> å‡½æ•°æ¥æ”¶å‚æ•° <code>a1</code>ï¼ˆå³ <code>fileHash</code>ï¼‰å<strong>ç›´æ¥ä½¿ç”¨</strong>ï¼Œæ²¡æœ‰å¯¹å…¶è¿›è¡Œ MD5 è®¡ç®—ï¼</p><p>è¿™æ„å‘³ç€ <code>fileHash</code> æ˜¯ç”± <strong>JavaScript ä»£ç </strong> ç”Ÿæˆå¹¶ä¼ å…¥çš„ã€‚è®©æˆ‘æœç´¢ JS ä»£ç ä¸­å¦‚ä½•è·å–è¿™ä¸ªå€¼ï¼š</p><p>è®©æˆ‘æ£€æŸ¥ HAR æ–‡ä»¶ä¸­çš„åŸå§‹æ–‡ä»¶åï¼š</p><p>ä½ è¯´å¾—å¯¹ï¼è®©æˆ‘éªŒè¯ä¸€ä¸‹å…³é”®å‘ç°ï¼š</p><p><strong><code>32e6dbcc2678d4d40a297ca5490acc4d</code> ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼</strong></p><p>ä» IDA åç¼–è¯‘çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œ<code>calDIYSign</code> å‡½æ•°æ¥æ”¶ <code>fileHash</code> å‚æ•°å<strong>ç›´æ¥ä½¿ç”¨</strong>ï¼Œæ²¡æœ‰è®¡ç®— MD5ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// ç¬¬ 95 è¡Œ - ç›´æ¥æ‹¼æ¥ä¼ å…¥çš„å‚æ•° a1 (fileHash) å’Œ &#34;#&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>sub_15B6FC</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>a1</span><span class=p>,</span> <span class=s>&#34;#&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>fileHash</code> å®é™…ä¸Šæ˜¯<strong>å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦</strong>ï¼Œæ¥è‡ª <code>tmp_xxxxx.png</code> æ–‡ä»¶åï¼</p><p>è®©æˆ‘æ›´æ–°ç­¾åè„šæœ¬æ¥åæ˜ è¿™ä¸ªå‘ç°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// ç¬¬ 95 è¡Œ - ç›´æ¥æ‹¼æ¥ä¼ å…¥çš„å‚æ•° a1 (fileHash) å’Œ &#34;#&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>sub_15B6FC</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v38</span><span class=p>,</span> <span class=n>a1</span><span class=p>,</span> <span class=s>&#34;#&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span></span><span class=line><span class=cl><span class=s2>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04)  
</span></span></span><span class=line><span class=cl><span class=s2>- IVå¤‡é€‰: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ä½¿ç”¨æ–¹æ³•:
</span></span></span><span class=line><span class=cl><span class=s2>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HeyteaDIYSign</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_DEFAULT</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># é»˜è®¤ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_PROD</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># ç”Ÿäº§ç¯å¢ƒ IV</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>env</span> <span class=o>=</span> <span class=n>env</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span> <span class=k>if</span> <span class=n>env</span> <span class=o>==</span> <span class=s2>&#34;prod&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ (ä» tmp_xxxxx.png æ–‡ä»¶åä¸­æå–çš„ xxxxx éƒ¨åˆ†)
</span></span></span><span class=line><span class=cl><span class=s2>                       æ³¨æ„ï¼šè¿™ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼Œè€Œæ˜¯å¾®ä¿¡å°ç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ï¼
</span></span></span><span class=line><span class=cl><span class=s2>                       ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc2678d4d40a297ca5490acc4d
</span></span></span><span class=line><span class=cl><span class=s2>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (hash_value, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ„é€ æ˜æ–‡: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># AES åŠ å¯†</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è½¬ä¸ºåå…­è¿›åˆ¶</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># é»˜è®¤è¿”å›ç¬¬ä¸€ç§</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„
</span></span></span><span class=line><span class=cl><span class=s2>            shop_id: åº—é“ºID
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—æ–‡ä»¶ MD5</span>
</span></span><span class=line><span class=cl>        <span class=n>file_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ hash å’Œ timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span><span class=n>file_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ sign</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_plaintext&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hash_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å°è¯•è§£å¯† hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            è§£å¯†ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hash_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸¤ç§ IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;prod&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;plaintext&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span> <span class=k>else</span> <span class=p>[</span><span class=n>decoded</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;printable&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>signer</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (é»˜è®¤): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (ç”Ÿäº§): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_PROD</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_id</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆç­¾åå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åº—é“ºID: </span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆçš„å‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è°ƒè¯•ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_fileHash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  plaintext: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨æµ‹è¯•æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> chars)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename_hash ä½œä¸º fileHash):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=nb>int</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç”Ÿæˆçš„ hash: </span><span class=si>{</span><span class=n>hash_value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŒ¹é…åŸå§‹: </span><span class=si>{</span><span class=s1>&#39;âœ“&#39;</span> <span class=k>if</span> <span class=n>hash_value</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;âœ—&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•è§£å¯†</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•è§£å¯†åŸå§‹ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_results</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>try_decrypt</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>decrypt_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> IV:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— é”™è¯¯: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— è§£å¯†å¤±è´¥&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;raw&#39;</span><span class=p>,</span> <span class=s1>&#39;N/A&#39;</span><span class=p>)[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span></span><span class=line><span class=cl><span class=s2>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04)  
</span></span></span><span class=line><span class=cl><span class=s2>- IVå¤‡é€‰: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ä½¿ç”¨æ–¹æ³•:
</span></span></span><span class=line><span class=cl><span class=s2>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HeyteaDIYSign</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_DEFAULT</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># é»˜è®¤ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_PROD</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># ç”Ÿäº§ç¯å¢ƒ IV</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>env</span> <span class=o>=</span> <span class=n>env</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span> <span class=k>if</span> <span class=n>env</span> <span class=o>==</span> <span class=s2>&#34;prod&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ (æ³¨æ„: è¿™ä¸æ˜¯ fileHash å‚æ•°!)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä»å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­æå– fileHash
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        å¾®ä¿¡å°ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„æ ¼å¼:
</span></span></span><span class=line><span class=cl><span class=s2>        - wxfile://tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - http://tmp/tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        fileHash æ˜¯ tmp_ åé¢ã€æ‰©å±•åå‰é¢çš„é‚£éƒ¨åˆ†
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è·å–æ–‡ä»¶å</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># åŒ¹é… tmp_xxxxx æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;tmp_([a-fA-F0-9]+)&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å¦‚æœæ²¡æœ‰ tmp_ å‰ç¼€ï¼Œè¿”å›æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=n>name_without_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name_without_ext</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ (ä» tmp_xxxxx.png æ–‡ä»¶åä¸­æå–çš„ xxxxx éƒ¨åˆ†)
</span></span></span><span class=line><span class=cl><span class=s2>                       æ³¨æ„ï¼šè¿™ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼Œè€Œæ˜¯å¾®ä¿¡å°ç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ï¼
</span></span></span><span class=line><span class=cl><span class=s2>                       ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc2678d4d40a297ca5490acc4d
</span></span></span><span class=line><span class=cl><span class=s2>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (hash_value, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ„é€ æ˜æ–‡: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># AES åŠ å¯†</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è½¬ä¸ºåå…­è¿›åˆ¶</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># é»˜è®¤è¿”å›ç¬¬ä¸€ç§</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„
</span></span></span><span class=line><span class=cl><span class=s2>            shop_id: åº—é“ºID
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—æ–‡ä»¶ MD5</span>
</span></span><span class=line><span class=cl>        <span class=n>file_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ hash å’Œ timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span><span class=n>file_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ sign</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_plaintext&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hash_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å°è¯•è§£å¯† hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            è§£å¯†ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hash_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸¤ç§ IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;prod&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;plaintext&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span> <span class=k>else</span> <span class=p>[</span><span class=n>decoded</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;printable&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>signer</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (é»˜è®¤): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (ç”Ÿäº§): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_PROD</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_id</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆç­¾åå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åº—é“ºID: </span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆçš„å‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è°ƒè¯•ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_fileHash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  plaintext: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨æµ‹è¯•æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> chars)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename_hash ä½œä¸º fileHash):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=nb>int</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç”Ÿæˆçš„ hash: </span><span class=si>{</span><span class=n>hash_value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŒ¹é…åŸå§‹: </span><span class=si>{</span><span class=s1>&#39;âœ“&#39;</span> <span class=k>if</span> <span class=n>hash_value</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;âœ—&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•è§£å¯†</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•è§£å¯†åŸå§‹ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_results</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>try_decrypt</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>decrypt_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> IV:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— é”™è¯¯: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— è§£å¯†å¤±è´¥&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;raw&#39;</span><span class=p>,</span> <span class=s1>&#39;N/A&#39;</span><span class=p>)[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span></span><span class=line><span class=cl><span class=s2>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04)  
</span></span></span><span class=line><span class=cl><span class=s2>- IVå¤‡é€‰: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ä½¿ç”¨æ–¹æ³•:
</span></span></span><span class=line><span class=cl><span class=s2>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HeyteaDIYSign</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_DEFAULT</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># é»˜è®¤ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_PROD</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># ç”Ÿäº§ç¯å¢ƒ IV</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>env</span> <span class=o>=</span> <span class=n>env</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span> <span class=k>if</span> <span class=n>env</span> <span class=o>==</span> <span class=s2>&#34;prod&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ (æ³¨æ„: è¿™ä¸æ˜¯ fileHash å‚æ•°!)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä»å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­æå– fileHash
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        å¾®ä¿¡å°ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„æ ¼å¼:
</span></span></span><span class=line><span class=cl><span class=s2>        - wxfile://tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - http://tmp/tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        fileHash æ˜¯ tmp_ åé¢ã€æ‰©å±•åå‰é¢çš„é‚£éƒ¨åˆ†
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è·å–æ–‡ä»¶å</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># åŒ¹é… tmp_xxxxx æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;tmp_([a-fA-F0-9]+)&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å¦‚æœæ²¡æœ‰ tmp_ å‰ç¼€ï¼Œè¿”å›æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=n>name_without_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name_without_ext</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ (ä» tmp_xxxxx.png æ–‡ä»¶åä¸­æå–çš„ xxxxx éƒ¨åˆ†)
</span></span></span><span class=line><span class=cl><span class=s2>                       æ³¨æ„ï¼šè¿™ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼Œè€Œæ˜¯å¾®ä¿¡å°ç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ï¼
</span></span></span><span class=line><span class=cl><span class=s2>                       ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc2678d4d40a297ca5490acc4d
</span></span></span><span class=line><span class=cl><span class=s2>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (hash_value, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ„é€ æ˜æ–‡: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># AES åŠ å¯†</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è½¬ä¸ºåå…­è¿›åˆ¶</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># é»˜è®¤è¿”å›ç¬¬ä¸€ç§</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„ (å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„æˆ–æ™®é€šæ–‡ä»¶è·¯å¾„)
</span></span></span><span class=line><span class=cl><span class=s2>            shop_id: åº—é“ºID
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¯é€‰ï¼Œç›´æ¥æŒ‡å®š fileHashã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä»æ–‡ä»¶è·¯å¾„ä¸­æå–
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        é‡è¦è¯´æ˜:
</span></span></span><span class=line><span class=cl><span class=s2>            fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼
</span></span></span><span class=line><span class=cl><span class=s2>            å®ƒæ˜¯å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦ (tmp_xxxxx.png ä¸­çš„ xxxxx)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># è·å– fileHash</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>file_hash</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒ)</span>
</span></span><span class=line><span class=cl>        <span class=n>actual_md5</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&#34;N/A&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ hash å’Œ timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span><span class=n>file_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ sign</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>  <span class=c1># ä»æ–‡ä»¶åæå–çš„å¾®ä¿¡æ ‡è¯†ç¬¦</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_actualMD5&#34;</span><span class=p>:</span> <span class=n>actual_md5</span><span class=p>,</span>  <span class=c1># æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒï¼Œä¸ç”¨äºç­¾å)</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_plaintext&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hash_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å°è¯•è§£å¯† hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            è§£å¯†ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hash_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸¤ç§ IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;prod&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;plaintext&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span> <span class=k>else</span> <span class=p>[</span><span class=n>decoded</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;printable&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>signer</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (é»˜è®¤): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (ç”Ÿäº§): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_PROD</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_id</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆç­¾åå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åº—é“ºID: </span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆçš„å‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è°ƒè¯•ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_fileHash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  plaintext: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨æµ‹è¯•æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> chars)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename_hash ä½œä¸º fileHash):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=nb>int</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç”Ÿæˆçš„ hash: </span><span class=si>{</span><span class=n>hash_value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŒ¹é…åŸå§‹: </span><span class=si>{</span><span class=s1>&#39;âœ“&#39;</span> <span class=k>if</span> <span class=n>hash_value</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;âœ—&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•è§£å¯†</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•è§£å¯†åŸå§‹ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_results</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>try_decrypt</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>decrypt_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> IV:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— é”™è¯¯: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— è§£å¯†å¤±è´¥&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;raw&#39;</span><span class=p>,</span> <span class=s1>&#39;N/A&#39;</span><span class=p>)[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span></span><span class=line><span class=cl><span class=s2>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04)  
</span></span></span><span class=line><span class=cl><span class=s2>- IVå¤‡é€‰: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ä½¿ç”¨æ–¹æ³•:
</span></span></span><span class=line><span class=cl><span class=s2>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HeyteaDIYSign</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_DEFAULT</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># é»˜è®¤ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_PROD</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># ç”Ÿäº§ç¯å¢ƒ IV</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>env</span> <span class=o>=</span> <span class=n>env</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span> <span class=k>if</span> <span class=n>env</span> <span class=o>==</span> <span class=s2>&#34;prod&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ (æ³¨æ„: è¿™ä¸æ˜¯ fileHash å‚æ•°!)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä»å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­æå– fileHash
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        å¾®ä¿¡å°ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„æ ¼å¼:
</span></span></span><span class=line><span class=cl><span class=s2>        - wxfile://tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - http://tmp/tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        fileHash æ˜¯ tmp_ åé¢ã€æ‰©å±•åå‰é¢çš„é‚£éƒ¨åˆ†
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è·å–æ–‡ä»¶å</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># åŒ¹é… tmp_xxxxx æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;tmp_([a-fA-F0-9]+)&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å¦‚æœæ²¡æœ‰ tmp_ å‰ç¼€ï¼Œè¿”å›æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=n>name_without_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name_without_ext</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ (ä» tmp_xxxxx.png æ–‡ä»¶åä¸­æå–çš„ xxxxx éƒ¨åˆ†)
</span></span></span><span class=line><span class=cl><span class=s2>                       æ³¨æ„ï¼šè¿™ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼Œè€Œæ˜¯å¾®ä¿¡å°ç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ï¼
</span></span></span><span class=line><span class=cl><span class=s2>                       ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc2678d4d40a297ca5490acc4d
</span></span></span><span class=line><span class=cl><span class=s2>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (hash_value, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ„é€ æ˜æ–‡: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># AES åŠ å¯†</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è½¬ä¸ºåå…­è¿›åˆ¶</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># é»˜è®¤è¿”å›ç¬¬ä¸€ç§</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„ (å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„æˆ–æ™®é€šæ–‡ä»¶è·¯å¾„)
</span></span></span><span class=line><span class=cl><span class=s2>            shop_id: åº—é“ºID
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¯é€‰ï¼Œç›´æ¥æŒ‡å®š fileHashã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä»æ–‡ä»¶è·¯å¾„ä¸­æå–
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        é‡è¦è¯´æ˜:
</span></span></span><span class=line><span class=cl><span class=s2>            fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼
</span></span></span><span class=line><span class=cl><span class=s2>            å®ƒæ˜¯å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦ (tmp_xxxxx.png ä¸­çš„ xxxxx)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># è·å– fileHash</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>file_hash</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒ)</span>
</span></span><span class=line><span class=cl>        <span class=n>actual_md5</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&#34;N/A&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ hash å’Œ timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span><span class=n>file_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ sign</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>  <span class=c1># ä»æ–‡ä»¶åæå–çš„å¾®ä¿¡æ ‡è¯†ç¬¦</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_actualMD5&#34;</span><span class=p>:</span> <span class=n>actual_md5</span><span class=p>,</span>  <span class=c1># æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒï¼Œä¸ç”¨äºç­¾å)</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_plaintext&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hash_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å°è¯•è§£å¯† hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            è§£å¯†ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hash_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸¤ç§ IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;prod&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;plaintext&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span> <span class=k>else</span> <span class=p>[</span><span class=n>decoded</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;printable&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>signer</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (é»˜è®¤): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (ç”Ÿäº§): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_PROD</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_id</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆç­¾åå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åº—é“ºID: </span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆçš„å‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è°ƒè¯•ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_fileHash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  plaintext: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨æµ‹è¯•æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> chars)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å…³é”®å‘ç°: fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;fileHash æ˜¯å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename ä¸­çš„æ ‡è¯†ç¬¦ä½œä¸º fileHash):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=nb>int</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  è¾“å…¥ fileHash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  è¾“å…¥ timestamp: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ˜æ–‡: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç”Ÿæˆçš„ hash: </span><span class=si>{</span><span class=n>hash_value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹ hash:    </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŒ¹é…åŸå§‹: </span><span class=si>{</span><span class=s1>&#39;âœ“&#39;</span> <span class=k>if</span> <span class=n>hash_value</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;âœ—&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•è§£å¯†</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•è§£å¯†åŸå§‹ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_results</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>try_decrypt</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>decrypt_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> IV:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— é”™è¯¯: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— è§£å¯†å¤±è´¥&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;raw&#39;</span><span class=p>,</span> <span class=s1>&#39;N/A&#39;</span><span class=p>)[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è§£å¯†ä»ç„¶å¤±è´¥ã€‚è®©æˆ‘æ›´æ·±å…¥åœ°åˆ†æ IDA ä¸­çš„åŠ å¯†å‡½æ•°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15B808</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v34</span><span class=p>,</span> <span class=n>v14</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>unk_535C88</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>sub_15CDF0</span><span class=p>(</span><span class=n>ptr</span><span class=p>,</span> <span class=n>v54</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v51</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v48</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘çœ‹åˆ° AES åŠ å¯†ä½¿ç”¨çš„æ˜¯æ ‡å‡† OpenSSL EVP APIã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦è¿˜æœ‰å…¶ä»–çš„å­—ç¬¦ä¸²å¤„ç†æˆ–è½¬æ¢æ­¥éª¤ï¼š</p><p>è®©æˆ‘æ£€æŸ¥å­—ç¬¦ä¸²æ‹¼æ¥å‡½æ•°ï¼Œçœ‹çœ‹æ˜æ–‡æ˜¯å¦‚ä½•æ„é€ çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>std::to_string(&amp;v43, v7);  // v43 = æ—¶é—´æˆ³å­—ç¬¦ä¸²
</span></span><span class=line><span class=cl>// ç¬¬ 95 è¡Œï¼šæ„é€  fileHash + &#34;#&#34;sub_15B6FC(&amp;v38, a1, &#34;#&#34;);  // v38 = fileHash + &#34;#&#34;
</span></span><span class=line><span class=cl>// ç¬¬ 104 è¡Œï¼šè¿½åŠ æ—¶é—´æˆ³v10 = sub_15E948((int)&amp;v38, v8, v9);  // v38 = fileHash + &#34;#&#34; + timestamp
</span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨æˆ‘ç†è§£å®Œæ•´çš„æµç¨‹äº†ã€‚è®©æˆ‘æ›´æ–°è„šæœ¬æ¥å°è¯•æ›´å¤šçš„ç»„åˆï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäº libheyteago.so é€†å‘åˆ†æ
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹:
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span></span><span class=line><span class=cl><span class=s2>3. ä½¿ç”¨ AES-128-CBC åŠ å¯†
</span></span></span><span class=line><span class=cl><span class=s2>4. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span></span><span class=line><span class=cl><span class=s2>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04)  
</span></span></span><span class=line><span class=cl><span class=s2>- IVå¤‡é€‰: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ä½¿ç”¨æ–¹æ³•:
</span></span></span><span class=line><span class=cl><span class=s2>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HeyteaDIYSign</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_DEFAULT</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># é»˜è®¤ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_PROD</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># ç”Ÿäº§ç¯å¢ƒ IV</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>env</span> <span class=o>=</span> <span class=n>env</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span> <span class=k>if</span> <span class=n>env</span> <span class=o>==</span> <span class=s2>&#34;prod&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ (æ³¨æ„: è¿™ä¸æ˜¯ fileHash å‚æ•°!)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä»å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­æå– fileHash
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        å¾®ä¿¡å°ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„æ ¼å¼:
</span></span></span><span class=line><span class=cl><span class=s2>        - wxfile://tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - http://tmp/tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        fileHash æ˜¯ tmp_ åé¢ã€æ‰©å±•åå‰é¢çš„é‚£éƒ¨åˆ†
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è·å–æ–‡ä»¶å</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># åŒ¹é… tmp_xxxxx æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;tmp_([a-fA-F0-9]+)&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å¦‚æœæ²¡æœ‰ tmp_ å‰ç¼€ï¼Œè¿”å›æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=n>name_without_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name_without_ext</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ (ä» tmp_xxxxx.png æ–‡ä»¶åä¸­æå–çš„ xxxxx éƒ¨åˆ†)
</span></span></span><span class=line><span class=cl><span class=s2>                       æ³¨æ„ï¼šè¿™ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼Œè€Œæ˜¯å¾®ä¿¡å°ç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ï¼
</span></span></span><span class=line><span class=cl><span class=s2>                       ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc2678d4d40a297ca5490acc4d
</span></span></span><span class=line><span class=cl><span class=s2>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (hash_value, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ„é€ æ˜æ–‡: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># AES åŠ å¯†</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è½¬ä¸ºåå…­è¿›åˆ¶</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># é»˜è®¤è¿”å›ç¬¬ä¸€ç§</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„ (å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„æˆ–æ™®é€šæ–‡ä»¶è·¯å¾„)
</span></span></span><span class=line><span class=cl><span class=s2>            shop_id: åº—é“ºID
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¯é€‰ï¼Œç›´æ¥æŒ‡å®š fileHashã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä»æ–‡ä»¶è·¯å¾„ä¸­æå–
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        é‡è¦è¯´æ˜:
</span></span></span><span class=line><span class=cl><span class=s2>            fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼
</span></span></span><span class=line><span class=cl><span class=s2>            å®ƒæ˜¯å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦ (tmp_xxxxx.png ä¸­çš„ xxxxx)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># è·å– fileHash</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>file_hash</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒ)</span>
</span></span><span class=line><span class=cl>        <span class=n>actual_md5</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&#34;N/A&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ hash å’Œ timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span><span class=n>file_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ sign</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>  <span class=c1># ä»æ–‡ä»¶åæå–çš„å¾®ä¿¡æ ‡è¯†ç¬¦</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_actualMD5&#34;</span><span class=p>:</span> <span class=n>actual_md5</span><span class=p>,</span>  <span class=c1># æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒï¼Œä¸ç”¨äºç­¾å)</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_plaintext&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hash_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å°è¯•è§£å¯† hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            è§£å¯†ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hash_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸¤ç§ IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;prod&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;plaintext&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span> <span class=k>else</span> <span class=p>[</span><span class=n>decoded</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;printable&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>signer</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (é»˜è®¤): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (ç”Ÿäº§): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_PROD</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_id</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆç­¾åå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åº—é“ºID: </span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆçš„å‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è°ƒè¯•ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_fileHash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  plaintext: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨æµ‹è¯•æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> chars)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å…³é”®å‘ç°: fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;fileHash æ˜¯å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename ä¸­çš„æ ‡è¯†ç¬¦ä½œä¸º fileHash):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=nb>int</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  è¾“å…¥ fileHash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  è¾“å…¥ timestamp: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ˜æ–‡: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç”Ÿæˆçš„ hash: </span><span class=si>{</span><span class=n>hash_value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹ hash:    </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŒ¹é…åŸå§‹: </span><span class=si>{</span><span class=s1>&#39;âœ“&#39;</span> <span class=k>if</span> <span class=n>hash_value</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;âœ—&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•è§£å¯†</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•è§£å¯†åŸå§‹ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_results</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>try_decrypt</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>decrypt_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> IV:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— é”™è¯¯: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— è§£å¯†å¤±è´¥&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;raw&#39;</span><span class=p>,</span> <span class=s1>&#39;N/A&#39;</span><span class=p>)[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸åŒçš„æ˜æ–‡æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•ä¸åŒçš„æ˜æ–‡æ ¼å¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_plaintexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># æ ‡å‡†æ ¼å¼</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># åå‘</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>],</span>  <span class=c1># ä»… fileHash</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># ä»… fileHash</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt</span> <span class=ow>in</span> <span class=n>test_plaintexts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ˜æ–‡: </span><span class=si>{</span><span class=n>pt</span><span class=p>[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>env</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=s2>&#34;prod&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>signer_test</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>(</span><span class=n>env</span><span class=o>=</span><span class=n>env</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>signer_test</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>pt</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>result_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“&#34;</span> <span class=k>if</span> <span class=n>result_hex</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;âœ—&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>env</span><span class=si>}</span><span class=s2> IV: </span><span class=si>{</span><span class=n>result_hex</span><span class=p>[:</span><span class=mi>40</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è®©æˆ‘æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å¯†é’¥æˆ–å¤„ç†æ­¥éª¤ï¼š</p><p>æ ¹æ®æˆ‘è¯¦ç»†çš„ IDA é€†å‘åˆ†æï¼Œè®©æˆ‘æ›´æ–°ç­¾åè„šæœ¬çš„æ–‡æ¡£è¯´æ˜ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>å–œèŒ¶DIYè´´çº¸ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>åŸºäº libheyteago.so é€†å‘åˆ†æ (IDA Pro)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>=== é‡è¦å‘ç° ===
</span></span></span><span class=line><span class=cl><span class=s2>fileHash å‚æ•°ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼
</span></span></span><span class=line><span class=cl><span class=s2>å®ƒæ˜¯å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦
</span></span></span><span class=line><span class=cl><span class=s2>ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ &#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ç®—æ³•æµç¨‹ (ä» sub_15B230 @ 0x15B230 é€†å‘):
</span></span></span><span class=line><span class=cl><span class=s2>1. è·å–å½“å‰æ¯«ç§’æ—¶é—´æˆ³ t: std::chrono::system_clock::now() / 1000
</span></span></span><span class=line><span class=cl><span class=s2>2. æ„é€ æ˜æ–‡: fileHash + &#34;#&#34; + t  
</span></span></span><span class=line><span class=cl><span class=s2>3. é€‰æ‹© IV: æ ¹æ®ç¯å¢ƒå˜é‡é€‰æ‹© (sub_15BC94 @ 0x15BC94)
</span></span></span><span class=line><span class=cl><span class=s2>4. ä½¿ç”¨ AES-128-CBC åŠ å¯† (sub_15CDF0 @ 0x15CDF0, EVP API)
</span></span></span><span class=line><span class=cl><span class=s2>5. å°†åŠ å¯†ç»“æœè½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸º hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å¯†é’¥ä¿¡æ¯ (ä» libheyteago.so æå–):
</span></span></span><span class=line><span class=cl><span class=s2>- AES Key: HEYTEA6H7J8K9M0N (16å­—èŠ‚, åœ°å€ 0x4379F4)
</span></span></span><span class=line><span class=cl><span class=s2>- IVé»˜è®¤: AN1wedUvOJblfD8Z (16å­—èŠ‚, åœ°å€ 0x437A04, ç”¨äºé prod ç¯å¢ƒ)
</span></span></span><span class=line><span class=cl><span class=s2>- IVç”Ÿäº§: 2lJuL8jdH03oNIq5 (16å­—èŠ‚, åœ°å€ 0x437A15, å½“ç¯å¢ƒ=&#34;prod&#34;æ—¶ä½¿ç”¨)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>IV é€‰æ‹©é€»è¾‘ (sub_15BC94):
</span></span></span><span class=line><span class=cl><span class=s2>- æ£€æŸ¥ç¯å¢ƒå­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º 4
</span></span></span><span class=line><span class=cl><span class=s2>- å¦‚æœå€¼ç­‰äº 0x64706970 (&#34;prod&#34; çš„å°ç«¯åº)ï¼Œä½¿ç”¨ IVç”Ÿäº§
</span></span></span><span class=line><span class=cl><span class=s2>- å¦åˆ™ä½¿ç”¨ IVé»˜è®¤
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>å½“å‰çŠ¶æ€: ç”Ÿæˆçš„ hash ä¸å®é™…æŠ“åŒ…ä¸åŒ¹é…ï¼Œå¯èƒ½åŸå› ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>1. fileHash çš„æ¥æº/æ ¼å¼ä¸å®Œå…¨æ­£ç¡®
</span></span></span><span class=line><span class=cl><span class=s2>2. è¿˜æœ‰å…¶ä»–æœªå‘ç°çš„å¤„ç†æ­¥éª¤
</span></span></span><span class=line><span class=cl><span class=s2>3. éœ€è¦æ›´å¤šæ ·æœ¬è¿›è¡ŒéªŒè¯
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>ä½¿ç”¨æ–¹æ³•:
</span></span></span><span class=line><span class=cl><span class=s2>    python heytea_diy_sign.py &lt;image_path&gt; [shop_id]
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span><span class=p>,</span> <span class=n>unpad</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è¯·å…ˆå®‰è£… pycryptodome: pip install pycryptodome&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HeyteaDIYSign</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å–œèŒ¶DIYç­¾åç”Ÿæˆå™¨&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä» libheyteago.so é€†å‘æå–çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>AES_KEY</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HEYTEA6H7J8K9M0N&#34;</span>  <span class=c1># 16 bytes = AES-128</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_DEFAULT</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;AN1wedUvOJblfD8Z&#34;</span>  <span class=c1># é»˜è®¤ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>IV_PROD</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;2lJuL8jdH03oNIq5&#34;</span>  <span class=c1># ç”Ÿäº§ç¯å¢ƒ IV</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;default&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ–ç­¾åç”Ÿæˆå™¨
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            env: ç¯å¢ƒé…ç½®, &#34;default&#34; æˆ– &#34;prod&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>env</span> <span class=o>=</span> <span class=n>env</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>iv</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span> <span class=k>if</span> <span class=n>env</span> <span class=o>==</span> <span class=s2>&#34;prod&#34;</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;è®¡ç®—æ–‡ä»¶çš„ MD5 å“ˆå¸Œå€¼ (æ³¨æ„: è¿™ä¸æ˜¯ fileHash å‚æ•°!)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä»å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­æå– fileHash
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        å¾®ä¿¡å°ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„æ ¼å¼:
</span></span></span><span class=line><span class=cl><span class=s2>        - wxfile://tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - http://tmp/tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        - tmp_32e6dbcc2678d4d40a297ca5490acc4d.png
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        fileHash æ˜¯ tmp_ åé¢ã€æ‰©å±•åå‰é¢çš„é‚£éƒ¨åˆ†
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è·å–æ–‡ä»¶å</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># åŒ¹é… tmp_xxxxx æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=k>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;tmp_([a-fA-F0-9]+)&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å¦‚æœæ²¡æœ‰ tmp_ å‰ç¼€ï¼Œè¿”å›æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰</span>
</span></span><span class=line><span class=cl>        <span class=n>name_without_ext</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>filename</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name_without_ext</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC åŠ å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;AES-128-CBC è§£å¯†&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>decrypted</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ (ä» tmp_xxxxx.png æ–‡ä»¶åä¸­æå–çš„ xxxxx éƒ¨åˆ†)
</span></span></span><span class=line><span class=cl><span class=s2>                       æ³¨æ„ï¼šè¿™ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼Œè€Œæ˜¯å¾®ä¿¡å°ç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶æ ‡è¯†ç¬¦ï¼
</span></span></span><span class=line><span class=cl><span class=s2>                       ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc2678d4d40a297ca5490acc4d
</span></span></span><span class=line><span class=cl><span class=s2>            timestamp: æ—¶é—´æˆ³(æ¯«ç§’), é»˜è®¤å½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            (hash_value, timestamp)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>timestamp</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>timestamp</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># æ„é€ æ˜æ–‡: fileHash#timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># AES åŠ å¯†</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è½¬ä¸ºåå…­è¿›åˆ¶</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆ sign å‚æ•° (å°è¯•å¤šç§ç»„åˆ)
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        æ³¨æ„: sign çš„ç¡®åˆ‡ç®—æ³•å°šæœªå®Œå…¨ç¡®è®¤
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># å¯èƒ½çš„ç»„åˆ</span>
</span></span><span class=line><span class=cl>        <span class=n>candidates</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>shop_id</span><span class=si>}{</span><span class=n>timestamp</span><span class=si>}{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># é»˜è®¤è¿”å›ç¬¬ä¸€ç§</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span> <span class=n>file_hash</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆå®Œæ•´çš„è¯·æ±‚å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            file_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„ (å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„æˆ–æ™®é€šæ–‡ä»¶è·¯å¾„)
</span></span></span><span class=line><span class=cl><span class=s2>            shop_id: åº—é“ºID
</span></span></span><span class=line><span class=cl><span class=s2>            file_hash: å¯é€‰ï¼Œç›´æ¥æŒ‡å®š fileHashã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ä»æ–‡ä»¶è·¯å¾„ä¸­æå–
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            åŒ…å« sign, t, hash, shopId çš„å­—å…¸
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        é‡è¦è¯´æ˜:
</span></span></span><span class=line><span class=cl><span class=s2>            fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼
</span></span></span><span class=line><span class=cl><span class=s2>            å®ƒæ˜¯å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦ (tmp_xxxxx.png ä¸­çš„ xxxxx)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># è·å– fileHash</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>file_hash</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file_hash</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_file_hash_from_path</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒ)</span>
</span></span><span class=line><span class=cl>        <span class=n>actual_md5</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>calculate_file_md5</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&#34;N/A&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ hash å’Œ timestamp</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span><span class=n>file_hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆ sign</span>
</span></span><span class=line><span class=cl>        <span class=n>sign</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_sign</span><span class=p>(</span><span class=n>file_hash</span><span class=p>,</span> <span class=n>timestamp</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=n>sign</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=n>hash_value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=n>shop_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_fileHash&#34;</span><span class=p>:</span> <span class=n>file_hash</span><span class=p>,</span>  <span class=c1># ä»æ–‡ä»¶åæå–çš„å¾®ä¿¡æ ‡è¯†ç¬¦</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_actualMD5&#34;</span><span class=p>:</span> <span class=n>actual_md5</span><span class=p>,</span>  <span class=c1># æ–‡ä»¶å®é™… MD5 (ä»…ä¾›å‚è€ƒï¼Œä¸ç”¨äºç­¾å)</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;_plaintext&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>file_hash</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># è°ƒè¯•ç”¨</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>try_decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hash_hex</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å°è¯•è§£å¯† hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            hash_hex: åå…­è¿›åˆ¶ç¼–ç çš„ hash å‚æ•°
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        Returns:
</span></span></span><span class=line><span class=cl><span class=s2>            è§£å¯†ç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>hash_hex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸¤ç§ IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>iv</span> <span class=ow>in</span> <span class=p>[(</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=p>),</span> <span class=p>(</span><span class=s2>&#34;prod&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>IV_PROD</span><span class=p>)]:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>AES_KEY</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>decrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>unpadded</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>decrypted</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>decoded</span> <span class=o>=</span> <span class=n>unpadded</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;plaintext&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;parts&#34;</span><span class=p>:</span> <span class=n>decoded</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;#&#39;</span><span class=p>)</span> <span class=k>if</span> <span class=s1>&#39;#&#39;</span> <span class=ow>in</span> <span class=n>decoded</span> <span class=k>else</span> <span class=p>[</span><span class=n>decoded</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;success&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;raw&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;printable&#34;</span><span class=p>:</span> <span class=n>decrypted</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;replace&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span><span class=p>[</span><span class=n>iv_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;ä¸»å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å–œèŒ¶ DIY è´´çº¸ç­¾åç”Ÿæˆå™¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸºäº libheyteago.so é€†å‘åˆ†æ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ˜¾ç¤ºå¯†é’¥ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>signer</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å¯†é’¥ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  AES Key: </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>AES_KEY</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (é»˜è®¤): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_DEFAULT</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  IV (ç”Ÿäº§): </span><span class=si>{</span><span class=n>signer</span><span class=o>.</span><span class=n>IV_PROD</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_id</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>&#34;4216&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>é”™è¯¯: æ–‡ä»¶ä¸å­˜åœ¨ - </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆç­¾åå‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ–‡ä»¶: </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åº—é“ºID: </span><span class=si>{</span><span class=n>shop_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_params</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>shop_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ç”Ÿæˆçš„å‚æ•°:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>è°ƒè¯•ä¿¡æ¯:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  fileHash: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_fileHash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  plaintext: </span><span class=si>{</span><span class=n>params</span><span class=p>[</span><span class=s1>&#39;_plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨æµ‹è¯•æ•°æ®</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ HAR åŒ…ä¸­çš„æµ‹è¯•æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sign&#34;</span><span class=p>:</span> <span class=s2>&#34;805f30f5c3cb85e1779ae3daacf8dce5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;t&#34;</span><span class=p>:</span> <span class=s2>&#34;1764833231217&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;hash&#34;</span><span class=p>:</span> <span class=s2>&#34;fc8aad8184823f1352f85228236f625c679f39c8d5ac4d86359af0572dc9c621c7b976db4c13fd219d28193536058f304031ff6d446277cd40009e4998ee8e1d31cd1c79e4075c5b1cba897d42d81451&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;shopId&#34;</span><span class=p>:</span> <span class=s2>&#34;4216&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;filename_hash&#34;</span><span class=p>:</span> <span class=s2>&#34;32e6dbcc2678d4d40a297ca5490acc4d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>åŸå§‹æ•°æ®:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  sign: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;sign&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  t: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>... (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>])</span><span class=si>}</span><span class=s2> chars)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  shopId: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;shopId&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  filename hash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ç”Ÿæˆç›¸åŒçš„å‚æ•°</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å…³é”®å‘ç°: fileHash ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;fileHash æ˜¯å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ä¾‹å¦‚: tmp_32e6dbcc2678d4d40a297ca5490acc4d.png ä¸­çš„ 32e6dbcc...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•é‡æ–°ç”Ÿæˆ (ä½¿ç”¨ filename ä¸­çš„æ ‡è¯†ç¬¦ä½œä¸º fileHash):&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_value</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>generate_hash</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;filename_hash&#34;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=nb>int</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;t&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  è¾“å…¥ fileHash: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  è¾“å…¥ timestamp: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  æ˜æ–‡: </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  ç”Ÿæˆçš„ hash: </span><span class=si>{</span><span class=n>hash_value</span><span class=p>[:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŸå§‹ hash:    </span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>][:</span><span class=mi>50</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  åŒ¹é…åŸå§‹: </span><span class=si>{</span><span class=s1>&#39;âœ“&#39;</span> <span class=k>if</span> <span class=n>hash_value</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;hash&#39;</span><span class=p>]</span> <span class=k>else</span> <span class=s1>&#39;âœ—&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•è§£å¯†</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å°è¯•è§£å¯†åŸå§‹ hash:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_results</span> <span class=o>=</span> <span class=n>signer</span><span class=o>.</span><span class=n>try_decrypt</span><span class=p>(</span><span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>iv_name</span><span class=p>,</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>decrypt_results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>  ä½¿ç”¨ </span><span class=si>{</span><span class=n>iv_name</span><span class=si>}</span><span class=s2> IV:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;success&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ“ è§£å¯†æˆåŠŸ: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;plaintext&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    fileHash: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    timestamp: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;parts&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s2>&#34;error&#34;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— é”™è¯¯: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;error&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    âœ— è§£å¯†å¤±è´¥&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    åŸå§‹å­—èŠ‚: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;raw&#39;</span><span class=p>,</span> <span class=s1>&#39;N/A&#39;</span><span class=p>)[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># å°è¯•ä¸åŒçš„æ˜æ–‡æ ¼å¼</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å°è¯•ä¸åŒçš„æ˜æ–‡æ ¼å¼:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>test_plaintexts</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># æ ‡å‡†æ ¼å¼</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># åå‘</span>
</span></span><span class=line><span class=cl>            <span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>],</span>  <span class=c1># ä»… fileHash</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>test_data</span><span class=p>[</span><span class=s1>&#39;filename_hash&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>  <span class=c1># ä»… fileHash</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>pt</span> <span class=ow>in</span> <span class=n>test_plaintexts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ˜æ–‡: </span><span class=si>{</span><span class=n>pt</span><span class=p>[:</span><span class=mi>60</span><span class=p>]</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>env</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>,</span> <span class=s2>&#34;prod&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>signer_test</span> <span class=o>=</span> <span class=n>HeyteaDIYSign</span><span class=p>(</span><span class=n>env</span><span class=o>=</span><span class=n>env</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>encrypted</span> <span class=o>=</span> <span class=n>signer_test</span><span class=o>.</span><span class=n>aes_encrypt</span><span class=p>(</span><span class=n>pt</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>result_hex</span> <span class=o>=</span> <span class=n>encrypted</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>match</span> <span class=o>=</span> <span class=s2>&#34;âœ“&#34;</span> <span class=k>if</span> <span class=n>result_hex</span> <span class=o>==</span> <span class=n>test_data</span><span class=p>[</span><span class=s2>&#34;hash&#34;</span><span class=p>]</span> <span class=k>else</span> <span class=s2>&#34;âœ—&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  </span><span class=si>{</span><span class=n>env</span><span class=si>}</span><span class=s2> IV: </span><span class=si>{</span><span class=n>result_hex</span><span class=p>[:</span><span class=mi>40</span><span class=p>]</span><span class=si>}</span><span class=s2>... </span><span class=si>{</span><span class=n>match</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç”¨æ³•: python heytea_diy_sign.py &lt;image_path&gt; [shop_id]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;=&#34;</span> <span class=o>*</span> <span class=mi>60</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=åˆ†ææ€»ç»“><a href=#%e5%88%86%e6%9e%90%e6%80%bb%e7%bb%93 class=header-anchor></a>åˆ†ææ€»ç»“</h2><p>ä½ è¯´å¾—å¯¹ï¼<strong><code>fileHash</code> å‚æ•°ä¸æ˜¯æ–‡ä»¶å†…å®¹çš„ MD5ï¼</strong></p><h3 id=-å…³é”®å‘ç°><a href=#-%e5%85%b3%e9%94%ae%e5%8f%91%e7%8e%b0 class=header-anchor></a>ğŸ” å…³é”®å‘ç°</h3><p>ä» IDA é€†å‘åˆ†æ <code>libheyteago.so</code> ä¸­çš„ <code>calDIYSign</code> å‡½æ•°ï¼š</p><ol><li><p><strong>fileHash æ¥æº</strong>: æ˜¯å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ä¸­çš„æ ‡è¯†ç¬¦</p><ul><li>ä¾‹å¦‚ï¼š<code>tmp_32e6dbcc2678d4d40a297ca5490acc4d.png</code> ä¸­çš„ <code>32e6dbcc2678d4d40a297ca5490acc4d</code></li><li><strong>ä¸æ˜¯</strong> æ–‡ä»¶å†…å®¹çš„ MD5ï¼ˆéªŒè¯ï¼šæ–‡ä»¶å®é™… MD5 æ˜¯ <code>d4772ba955cb458a571e72bfb6d8d25c</code>ï¼‰</li></ul></li><li><p><strong>ç®—æ³•æµç¨‹</strong>ï¼ˆåœ°å€ <code>0x15B230</code>ï¼‰:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. è·å–æ—¶é—´æˆ³: t = std::chrono::system_clock::now() / 1000
</span></span><span class=line><span class=cl>2. æ‹¼æ¥æ˜æ–‡: plaintext = fileHash + &#34;#&#34; + t
</span></span><span class=line><span class=cl>3. é€‰æ‹© IV (æ ¹æ®ç¯å¢ƒ)
</span></span><span class=line><span class=cl>4. AES-128-CBC åŠ å¯†
</span></span><span class=line><span class=cl>5. è½¬åå…­è¿›åˆ¶è¾“å‡º
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>ä¸ºä»€ä¹ˆè§£å¯†å¤±è´¥</strong>ï¼š</p><ul><li>æˆ‘ä»¬æå–çš„å¯†é’¥å’Œ IV åœ¨ä»£ç ä¸­æ˜¯æ­£ç¡®çš„</li><li>ä½†ç”Ÿæˆçš„ hash ä¸åŸå§‹æ•°æ®ä¸åŒ¹é…</li><li>å¯èƒ½åŸå› ï¼š<ul><li><code>fileHash</code> ä¸æ˜¯ç›´æ¥ä»æ–‡ä»¶åæå–ï¼ˆå¾®ä¿¡å¯èƒ½æœ‰å…¶ä»–å¤„ç†ï¼‰</li><li>å­˜åœ¨å…¶ä»–ç¯å¢ƒç›¸å…³çš„å¯†é’¥/IV å˜ä½“</li><li>éœ€è¦æ›´å¤šæŠ“åŒ…æ ·æœ¬æ¥éªŒè¯</li></ul></li></ul></li></ol><h3 id=-ä¸‹ä¸€æ­¥å»ºè®®><a href=#-%e4%b8%8b%e4%b8%80%e6%ad%a5%e5%bb%ba%e8%ae%ae class=header-anchor></a>ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®</h3><ol><li><strong>è·å–æ›´å¤šæ ·æœ¬</strong>: æŠ“å–å¤šä¸ªè¯·æ±‚ï¼Œå¯¹æ¯” <code>fileHash</code>ã€<code>t</code>ã€<code>hash</code> çš„å…³ç³»</li><li><strong>Frida Hook</strong>: åŠ¨æ€æ‹¦æˆª <code>calDIYSign</code> å‡½æ•°ï¼Œæ•è·çœŸå®çš„è¾“å…¥å’Œè¾“å‡º</li><li><strong>æ£€æŸ¥ JavaScript</strong>: æŸ¥æ‰¾ <code>calculateDiySign</code> çš„è°ƒç”¨å¤„ï¼Œç¡®è®¤ <code>fileHash</code> å‚æ•°çš„ç¡®åˆ‡æ¥æº</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>   1. è·å–æ—¶é—´æˆ³: t = std::chrono::system_clock::now() / 1000
</span></span><span class=line><span class=cl>   2. æ‹¼æ¥æ˜æ–‡: plaintext = fileHash + &#34;#&#34; + t
</span></span><span class=line><span class=cl>   3. é€‰æ‹© IV (æ ¹æ®ç¯å¢ƒ)
</span></span><span class=line><span class=cl>   4. AES-128-CBC åŠ å¯†
</span></span><span class=line><span class=cl>   5. è½¬åå…­è¿›åˆ¶è¾“å‡º
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>   1. è·å–æ—¶é—´æˆ³: t = std::chrono::system_clock::now() / 1000
</span></span><span class=line><span class=cl>   2. æ‹¼æ¥æ˜æ–‡: plaintext = fileHash + &#34;#&#34; + t
</span></span><span class=line><span class=cl>   3. é€‰æ‹© IV (æ ¹æ®ç¯å¢ƒ)
</span></span><span class=line><span class=cl>   4. AES-128-CBC åŠ å¯†
</span></span><span class=line><span class=cl>   5. è½¬åå…­è¿›åˆ¶è¾“å‡º
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Edited Photo by <a class=link href=https://x.com/Kei_Fukamiki48 target=_blank rel=noopener>æ·±å¹¹ã‚±ã‚¤</a></p></blockquote></section><footer class=article-footer></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/gpt-1/><div class=article-image><img src=/p/gpt-1/cover.9cada478b412b829299921ef865f55bb_hu_5a49123dbefb499e.jpg width=250 height=150 loading=lazy alt="Featured image of post ChatGPT çš„å°å°éšç¬” '1" data-key=gpt-1 data-hash="md5-nK2keLQSuCkpmSHvhl9Vuw=="></div><div class=article-details><h2 class=article-title>ChatGPT çš„å°å°éšç¬” '1</h2></div></a></article><article class=has-image><a href=/categories/gpt/><div class=article-image><img src=/categories/gpt/ChatGPT%28forsure%29.44b685da681fe94ad3703d7cfdb1988b_hu_c826bd59dbaf960b.png width=250 height=150 loading=lazy alt="Featured image of post ChatGPT çš„å°å°éšç¬”" data-hash="md5-RLaF2mgf6UrTcD18/bGYiw=="></div><div class=article-details><h2 class=article-title>ChatGPT çš„å°å°éšç¬”</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=C9QuaRtz/C9QuaRtz.github.io issue-term=pathname label=blog_comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 C9QuaRtz Hos7llo's Stack</section><section class=powerby>è¿™æ®µæ–‡å­—ä¼šå‡ºç°åœ¨å“ªé‡Œå‘¢~<br>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>